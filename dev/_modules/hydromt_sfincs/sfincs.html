

<!DOCTYPE html>


<html lang="en" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydromt_sfincs.sfincs &#8212; HydroMT SFINCS  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/theme-deltares.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/hydromt_sfincs/sfincs';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    
    
    
    <img src="../../_static/hydromt-icon.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/hydromt-icon.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
    <p class="title logo__title">HydroMT SFINCS</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started/intro.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user_guide/intro.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../dev_guide/intro.html">
                        Developments
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://deltares.github.io/hydromt/latest/index.html">
                    HydroMT core
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Deltares/hydromt_sfincs" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" class="icon-link-image" alt="GitHub"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://sfincs.readthedocs.io/" title="SFINCS" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/sfincs_logo_mHv_icon.ico" class="icon-link-image" alt="SFINCS"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.deltares.nl/en/" title="Deltares" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/deltares-blue.svg" class="icon-link-image" alt="Deltares"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started/intro.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user_guide/intro.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../dev_guide/intro.html">
                        Developments
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://deltares.github.io/hydromt/latest/index.html">
                    HydroMT core
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Deltares/hydromt_sfincs" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" class="icon-link-image" alt="GitHub"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://sfincs.readthedocs.io/" title="SFINCS" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/sfincs_logo_mHv_icon.ico" class="icon-link-image" alt="SFINCS"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.deltares.nl/en/" title="Deltares" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/deltares-blue.svg" class="icon-link-image" alt="Deltares"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">hydromt_sfincs.sfincs</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for hydromt_sfincs.sfincs</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SfincsModel class</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">isabs</span><span class="p">,</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">hydromt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">hydromt.models.model_grid</span> <span class="kn">import</span> <span class="n">GridModel</span>
<span class="kn">from</span> <span class="nn">hydromt.raster</span> <span class="kn">import</span> <span class="n">RasterDataArray</span>
<span class="kn">from</span> <span class="nn">hydromt.vector</span> <span class="kn">import</span> <span class="n">GeoDataArray</span><span class="p">,</span> <span class="n">GeoDataset</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">CRS</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">box</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">DATADIR</span><span class="p">,</span> <span class="n">plots</span><span class="p">,</span> <span class="n">utils</span><span class="p">,</span> <span class="n">workflows</span>
<span class="kn">from</span> <span class="nn">.regulargrid</span> <span class="kn">import</span> <span class="n">RegularGrid</span>
<span class="kn">from</span> <span class="nn">.sfincs_input</span> <span class="kn">import</span> <span class="n">SfincsInput</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SfincsModel&quot;</span><span class="p">]</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="SfincsModel"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.html#hydromt_sfincs.SfincsModel">[docs]</a><span class="k">class</span> <span class="nc">SfincsModel</span><span class="p">(</span><span class="n">GridModel</span><span class="p">):</span>
    <span class="c1"># GLOBAL Static class variables that can be used by all methods within</span>
    <span class="c1"># SfincsModel class. Typically list of variables (e.g. _MAPS) or</span>
    <span class="c1"># dict with varname - filename pairs (e.g. thin_dams : thd)</span>
    <span class="n">_NAME</span> <span class="o">=</span> <span class="s2">&quot;sfincs&quot;</span>
    <span class="n">_GEOMS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;observation_points&quot;</span><span class="p">:</span> <span class="s2">&quot;obs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;weirs&quot;</span><span class="p">:</span> <span class="s2">&quot;weir&quot;</span><span class="p">,</span>
        <span class="s2">&quot;thin_dams&quot;</span><span class="p">:</span> <span class="s2">&quot;thd&quot;</span><span class="p">,</span>
    <span class="p">}</span>  <span class="c1"># parsed to dict of geopandas.GeoDataFrame</span>
    <span class="n">_FORCING_1D</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># timeseries (can be multiple), locations tuple</span>
        <span class="s2">&quot;waterlevel&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;bzs&quot;</span><span class="p">],</span> <span class="s2">&quot;bnd&quot;</span><span class="p">),</span>
        <span class="s2">&quot;waves&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;bzi&quot;</span><span class="p">],</span> <span class="s2">&quot;bnd&quot;</span><span class="p">),</span>
        <span class="s2">&quot;discharge&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;dis&quot;</span><span class="p">],</span> <span class="s2">&quot;src&quot;</span><span class="p">),</span>
        <span class="s2">&quot;precip&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;precip&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">),</span>
        <span class="s2">&quot;wavespectra&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;bhs&quot;</span><span class="p">,</span> <span class="s2">&quot;btp&quot;</span><span class="p">,</span> <span class="s2">&quot;bwd&quot;</span><span class="p">,</span> <span class="s2">&quot;bds&quot;</span><span class="p">],</span> <span class="s2">&quot;bwv&quot;</span><span class="p">),</span>
        <span class="s2">&quot;wavemaker&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;whi&quot;</span><span class="p">,</span> <span class="s2">&quot;wti&quot;</span><span class="p">,</span> <span class="s2">&quot;wst&quot;</span><span class="p">],</span> <span class="s2">&quot;wvp&quot;</span><span class="p">),</span>  <span class="c1"># TODO check names and test</span>
    <span class="p">}</span>
    <span class="n">_FORCING_NET</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># 2D forcing sfincs name, rename tuple</span>
        <span class="s2">&quot;waterlevel&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;netbndbzsbzi&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;zs&quot;</span><span class="p">:</span> <span class="s2">&quot;bzs&quot;</span><span class="p">,</span> <span class="s2">&quot;zi&quot;</span><span class="p">:</span> <span class="s2">&quot;bzi&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;discharge&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;netsrcdis&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;discharge&quot;</span><span class="p">:</span> <span class="s2">&quot;dis&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;precip&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;netampr&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Precipitation&quot;</span><span class="p">:</span> <span class="s2">&quot;precip&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;press&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;netamp&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;barometric_pressure&quot;</span><span class="p">:</span> <span class="s2">&quot;press&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;wind&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;netamuamv&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;eastward_wind&quot;</span><span class="p">:</span> <span class="s2">&quot;wind_u&quot;</span><span class="p">,</span> <span class="s2">&quot;northward_wind&quot;</span><span class="p">:</span> <span class="s2">&quot;wind_v&quot;</span><span class="p">}),</span>
    <span class="p">}</span>
    <span class="n">_FORCING_SPW</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;spiderweb&quot;</span><span class="p">:</span> <span class="s2">&quot;spw&quot;</span><span class="p">}</span>  <span class="c1"># TODO add read and write functions</span>
    <span class="n">_MAPS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;msk&quot;</span><span class="p">,</span> <span class="s2">&quot;dep&quot;</span><span class="p">,</span> <span class="s2">&quot;scs&quot;</span><span class="p">,</span> <span class="s2">&quot;manning&quot;</span><span class="p">,</span> <span class="s2">&quot;qinf&quot;</span><span class="p">]</span>
    <span class="n">_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rst&quot;</span><span class="p">,</span> <span class="s2">&quot;ini&quot;</span><span class="p">]</span>
    <span class="n">_FOLDERS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_CLI_ARGS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;setup_grid_from_region&quot;</span><span class="p">,</span> <span class="s2">&quot;res&quot;</span><span class="p">:</span> <span class="s2">&quot;setup_grid_from_region&quot;</span><span class="p">}</span>
    <span class="n">_CONF</span> <span class="o">=</span> <span class="s2">&quot;sfincs.inp&quot;</span>
    <span class="n">_DATADIR</span> <span class="o">=</span> <span class="n">DATADIR</span>
    <span class="n">_ATTRS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;dep&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;elevation&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m+ref&quot;</span><span class="p">},</span>
        <span class="s2">&quot;msk&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">},</span>
        <span class="s2">&quot;scs&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;potential maximum soil moisture retention&quot;</span><span class="p">,</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;qinf&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;infiltration rate&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;mm.hr-1&quot;</span><span class="p">},</span>
        <span class="s2">&quot;manning&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;manning roughness&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;s.m-1/3&quot;</span><span class="p">},</span>
        <span class="s2">&quot;bzs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;waterlevel&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m+ref&quot;</span><span class="p">},</span>
        <span class="s2">&quot;bzi&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;wave height&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">},</span>
        <span class="s2">&quot;dis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;discharge&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m3.s-1&quot;</span><span class="p">},</span>
        <span class="s2">&quot;precip&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;mm.hr-1&quot;</span><span class="p">},</span>
    <span class="p">}</span>

<div class="viewcode-block" id="SfincsModel.__init__"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.html#hydromt_sfincs.SfincsModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">root</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="n">config_fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sfincs.inp&quot;</span><span class="p">,</span>
        <span class="n">write_gis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">data_libs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The SFINCS model class (SfincsModel) contains methods to read, write, setup and edit</span>
<span class="sd">        `SFINCS &lt;https://sfincs.readthedocs.io/en/latest/&gt;`_ models.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root: str, Path, optional</span>
<span class="sd">            Path to model folder</span>
<span class="sd">        mode: {&#39;w&#39;, &#39;r+&#39;, &#39;r&#39;}</span>
<span class="sd">            Open model in write, append or reading mode, by default &#39;w&#39;</span>
<span class="sd">        config_fn: str, Path, optional</span>
<span class="sd">            Filename of model config file, by default &quot;sfincs.inp&quot;</span>
<span class="sd">        write_gis: bool</span>
<span class="sd">            Write model files additionally to geotiff and geojson, by default True</span>
<span class="sd">        data_libs: List, str</span>
<span class="sd">            List of data catalog yaml files, by default None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># model folders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span> <span class="o">=</span> <span class="n">write_gis</span>
        <span class="k">if</span> <span class="n">write_gis</span> <span class="ow">and</span> <span class="s2">&quot;gis&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FOLDERS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_FOLDERS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;gis&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">config_fn</span><span class="o">=</span><span class="n">config_fn</span><span class="p">,</span>
            <span class="n">data_libs</span><span class="o">=</span><span class="n">data_libs</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># placeholder grid classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quadtree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subgrid</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns model mask&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;regular&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;msk&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;msk&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">empty_mask</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">region</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the geometry of the active model cells.&quot;&quot;&quot;</span>
        <span class="c1"># NOTE overwrites property in GridModel</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;region&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;msk&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;msk&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
            <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_nodata</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">vectorize</span><span class="p">()</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">empty_mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">box</span>
        <span class="k">return</span> <span class="n">region</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CRS</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the model crs&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;regular&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">crs</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;quadtree&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quadtree</span><span class="o">.</span><span class="n">crs</span>

    <span class="k">def</span> <span class="nf">set_crs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the model crs&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;regular&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_user_input</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;quadtree&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quadtree</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_user_input</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>

<div class="viewcode-block" id="SfincsModel.setup_grid"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_grid.html#hydromt_sfincs.SfincsModel.setup_grid">[docs]</a>    <span class="k">def</span> <span class="nf">setup_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">y0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">dy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">nmax</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">mmax</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">rotation</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">epsg</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup a regular or quadtree grid.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0, y0 : float</span>
<span class="sd">            x,y coordinates of the origin of the grid</span>
<span class="sd">        dx, dy : float</span>
<span class="sd">            grid cell size in x and y direction</span>
<span class="sd">        mmax, nmax : int</span>
<span class="sd">            number of grid cells in x and y direction</span>
<span class="sd">        rotation : float, optional</span>
<span class="sd">            rotation of grid [degree angle], by default None</span>
<span class="sd">        epsg : int, optional</span>
<span class="sd">            epsg-code of the coordinate reference system, by default None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO gdf_refinement for quadtree</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span>
            <span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span>
            <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span>
            <span class="n">dy</span><span class="o">=</span><span class="n">dy</span><span class="p">,</span>
            <span class="n">nmax</span><span class="o">=</span><span class="n">nmax</span><span class="p">,</span>
            <span class="n">mmax</span><span class="o">=</span><span class="n">mmax</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span>
            <span class="n">epsg</span><span class="o">=</span><span class="n">epsg</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_grid_from_config</span><span class="p">()</span></div>

<div class="viewcode-block" id="SfincsModel.setup_grid_from_region"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_grid_from_region.html#hydromt_sfincs.SfincsModel.setup_grid_from_region">[docs]</a>    <span class="k">def</span> <span class="nf">setup_grid_from_region</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">region</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">res</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;utm&quot;</span><span class="p">,</span>
        <span class="n">rotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hydrography_fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">basin_index_fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dec_origin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">dec_rotation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup a regular or quadtree grid from a region.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        region : dict</span>
<span class="sd">            Dictionary describing region of interest, e.g.:</span>
<span class="sd">            </span>
<span class="sd">            * {&#39;bbox&#39;: [xmin, ymin, xmax, ymax]}</span>
<span class="sd">            * {&#39;geom&#39;: &#39;path/to/polygon_geometry&#39;}</span>

<span class="sd">            For a complete overview of all region options,</span>
<span class="sd">            see :py:function:~hydromt.workflows.basin_mask.parse_region</span>
<span class="sd">        res : float, optional</span>
<span class="sd">            grid resolution, by default 100 m</span>
<span class="sd">        crs : Union[str, int], optional</span>
<span class="sd">            coordinate reference system of the grid</span>
<span class="sd">            if &quot;utm&quot; (default) the best UTM zone is selected</span>
<span class="sd">            else a pyproj crs string or epsg code (int) can be provided</span>
<span class="sd">        grid_type : str, optional</span>
<span class="sd">            grid type, &quot;regular&quot; (default) or &quot;quadtree&quot;</span>
<span class="sd">        rotated : bool, optional</span>
<span class="sd">            if True, a minimum rotated rectangular grid is fitted around the region, by default False</span>
<span class="sd">        hydrography_fn : str</span>
<span class="sd">            Name of data source for hydrography data.</span>
<span class="sd">        basin_index_fn : str</span>
<span class="sd">            Name of data source with basin (bounding box) geometries associated with</span>
<span class="sd">            the &#39;basins&#39; layer of `hydrography_fn`. Only required if the `region` is</span>
<span class="sd">            based on a (sub)(inter)basins without a &#39;bounds&#39; argument.</span>
<span class="sd">        dec_origin : int, optional</span>
<span class="sd">            number of decimals to round the origin coordinates, by default 0</span>
<span class="sd">        dec_rotation : int, optional</span>
<span class="sd">            number of decimals to round the rotation angle, by default 3</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        hydromt.workflows.basin_mask.parse_region</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># setup `region` of interest of the model.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_region</span><span class="p">(</span>
            <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
            <span class="n">hydrography_fn</span><span class="o">=</span><span class="n">hydrography_fn</span><span class="p">,</span>
            <span class="n">basin_index_fn</span><span class="o">=</span><span class="n">basin_index_fn</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># get pyproj crs of best UTM zone if crs=utm</span>
        <span class="n">pyproj_crs</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">gis_utils</span><span class="o">.</span><span class="n">parse_crs</span><span class="p">(</span>
            <span class="n">crs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span><span class="o">.</span><span class="n">total_bounds</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">crs</span> <span class="o">!=</span> <span class="n">pyproj_crs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">pyproj_crs</span><span class="p">)</span>

        <span class="c1"># create grid from region</span>
        <span class="c1"># NOTE keyword rotated is added to still have the possibility to create unrotated grids if needed (e.g. for FEWS?)</span>
        <span class="k">if</span> <span class="n">rotated</span><span class="p">:</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unary_union</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">nmax</span><span class="p">,</span> <span class="n">rot</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">rotated_grid</span><span class="p">(</span>
                <span class="n">geom</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">dec_origin</span><span class="o">=</span><span class="n">dec_origin</span><span class="p">,</span> <span class="n">dec_rotation</span><span class="o">=</span><span class="n">dec_rotation</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">total_bounds</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">dec_origin</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">dec_origin</span><span class="p">)</span>
            <span class="n">mmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="n">res</span><span class="p">))</span>
            <span class="n">nmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="n">res</span><span class="p">))</span>
            <span class="n">rot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_grid</span><span class="p">(</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span>
            <span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span>
            <span class="n">dx</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>
            <span class="n">dy</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>
            <span class="n">nmax</span><span class="o">=</span><span class="n">nmax</span><span class="p">,</span>
            <span class="n">mmax</span><span class="o">=</span><span class="n">mmax</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span>
            <span class="n">epsg</span><span class="o">=</span><span class="n">pyproj_crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">(),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_dep"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_dep.html#hydromt_sfincs.SfincsModel.setup_dep">[docs]</a>    <span class="k">def</span> <span class="nf">setup_dep</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">datasets_dep</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
        <span class="n">buffer_cells</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># not in list</span>
        <span class="n">interp_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>  <span class="c1"># used for buffer cells only</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Interpolate topobathy (dep) data to the model grid.</span>

<span class="sd">        Adds model grid layers:</span>

<span class="sd">        * **dep**: combined elevation/bathymetry [m+ref]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        datasets_dep : List[dict]</span>
<span class="sd">            List of dictionaries with topobathy data, each containing a dataset name or Path (elevtn) and optional merge arguments e.g.:</span>
<span class="sd">            [{&#39;elevtn&#39;: merit_hydro, &#39;zmin&#39;: 0.01}, {&#39;elevtn&#39;: gebco, &#39;offset&#39;: 0, &#39;merge_method&#39;: &#39;first&#39;, reproj_method: &#39;bilinear&#39;}]</span>
<span class="sd">            For a complete overview of all merge options, see :py:function:~hydromt.workflows.merge_multi_dataarrays</span>
<span class="sd">        buffer_cells : int, optional</span>
<span class="sd">            Number of cells between datasets to ensure smooth transition of bed levels, by default 0</span>
<span class="sd">        interp_method : str, optional</span>
<span class="sd">            Interpolation method used to fill the buffer cells , by default &quot;linear&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># retrieve model resolution to determine zoom level for xyz-datasets</span>
        <span class="c1"># TODO fix for quadtree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">is_geographic</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">111111.0</span>

        <span class="n">datasets_dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_datasets_dep</span><span class="p">(</span><span class="n">datasets_dep</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;regular&quot;</span><span class="p">:</span>
            <span class="n">da_dep</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">merge_multi_dataarrays</span><span class="p">(</span>
                <span class="n">da_list</span><span class="o">=</span><span class="n">datasets_dep</span><span class="p">,</span>
                <span class="n">da_like</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
                <span class="n">buffer_cells</span><span class="o">=</span><span class="n">buffer_cells</span><span class="p">,</span>
                <span class="n">interp_method</span><span class="o">=</span><span class="n">interp_method</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># check if no nan data is present in the bed levels</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">da_dep</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Interpolate data at </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">da_dep</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span><span class="si">}</span><span class="s2"> cells&quot;</span>
                <span class="p">)</span>
                <span class="n">da_dep</span> <span class="o">=</span> <span class="n">da_dep</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">interpolate_na</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;rio_idw&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid</span><span class="p">(</span><span class="n">da_dep</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dep&quot;</span><span class="p">)</span>
            <span class="c1"># FIXME this shouldn&#39;t be necessary, since da_dep should already have the crs</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;depfile&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;depfile&quot;</span><span class="p">:</span> <span class="s2">&quot;sfincs.dep&quot;</span><span class="p">})</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;quadtree&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Create dep not yet implemented for quadtree grids.&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_mask_active"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_mask_active.html#hydromt_sfincs.SfincsModel.setup_mask_active">[docs]</a>    <span class="k">def</span> <span class="nf">setup_mask_active</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mask</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_mask</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude_mask</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_buffer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">zmin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fill_area</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="n">drop_area</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">connectivity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
        <span class="n">all_touched</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">reset_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup active model cells.</span>

<span class="sd">        The SFINCS model mask defines inactive (msk=0), active (msk=1), and waterlevel boundary (msk=2)</span>
<span class="sd">        and outflow boundary (msk=3) cells. This method sets the active and inactive cells.</span>

<span class="sd">        Active model cells are based on a region and cells with valid elevation (i.e. not nodata),</span>
<span class="sd">        optionally bounded by areas inside the include geomtries, outside the exclude geomtries,</span>
<span class="sd">        larger or equal than a minimum elevation threshhold and smaller or equal than a</span>
<span class="sd">        maximum elevation threshhold.</span>
<span class="sd">        All conditions are combined using a logical AND operation.</span>

<span class="sd">        Sets model layers:</span>

<span class="sd">        * **msk** map: model mask [-]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mask: str, Path, gpd.GeoDataFrame, optional</span>
<span class="sd">            Path or data source name of polygons to initiliaze active mask with; proceding arguments can be used to include/exclude cells</span>
<span class="sd">            If not given, existing mask (if present) used, else mask is initialized empty.</span>
<span class="sd">        include_mask, exclude_mask: str, Path, gpd.GeoDataFrame, optional</span>
<span class="sd">            Path or data source name of polygons to include/exclude from the active model domain.</span>
<span class="sd">            Note that include (second last) and exclude (last) areas are processed after other critera,</span>
<span class="sd">            i.e. `zmin`, `zmax` and `drop_area`, and thus overrule these criteria for active model cells.</span>
<span class="sd">        mask_buffer: float, optional</span>
<span class="sd">            If larger than zero, extend the `include_mask` geometry with a buffer [m],</span>
<span class="sd">            by default 0.</span>
<span class="sd">        zmin, zmax : float, optional</span>
<span class="sd">            Minimum and maximum elevation thresholds for active model cells.</span>
<span class="sd">        fill_area : float, optional</span>
<span class="sd">            Maximum area [km2] of contiguous cells below `zmin` or above `zmax` but surrounded</span>
<span class="sd">            by cells within the valid elevation range to be kept as active cells, by default 10 km2.</span>
<span class="sd">        drop_area : float, optional</span>
<span class="sd">            Maximum area [km2] of contiguous cells to be set as inactive cells, by default 0 km2.</span>
<span class="sd">        connectivity, {4, 8}:</span>
<span class="sd">            The connectivity used to define contiguous cells, if 4 only horizontal and vertical</span>
<span class="sd">            connections are used, if 8 (default) also diagonal connections.</span>
<span class="sd">        all_touched: bool, optional</span>
<span class="sd">            if True (default) include (or exclude) a cell in the mask if it touches any of the</span>
<span class="sd">            include (or exclude) geometries. If False, include a cell only if its center is</span>
<span class="sd">            within one of the shapes, or if it is selected by Bresenham&#39;s line algorithm.</span>
<span class="sd">        reset_mask: bool, optional</span>
<span class="sd">            If True, reset existing mask layer. If False (default) updating existing mask.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># read geometries</span>
        <span class="n">gdf_mask</span><span class="p">,</span> <span class="n">gdf_include</span><span class="p">,</span> <span class="n">gdf_exclude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span><span class="o">.</span><span class="n">total_bounds</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pol&quot;</span><span class="p">):</span>
                <span class="c1"># NOTE polygons should be in same CRS as model</span>
                <span class="n">gdf_mask</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">polygon2gdf</span><span class="p">(</span>
                    <span class="n">feats</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">read_geoms</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">mask</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">crs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gdf_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mask_buffer</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># NOTE assumes model in projected CRS!</span>
                <span class="n">gdf_mask</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_mask</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">mask_buffer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">include_mask</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">include_mask</span>
            <span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pol&quot;</span><span class="p">):</span>
                <span class="c1"># NOTE polygons should be in same CRS as model</span>
                <span class="n">gdf_include</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">polygon2gdf</span><span class="p">(</span>
                    <span class="n">feats</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">read_geoms</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">include_mask</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">crs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gdf_include</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                    <span class="n">include_mask</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">exclude_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exclude_mask</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">exclude_mask</span>
            <span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pol&quot;</span><span class="p">):</span>
                <span class="n">gdf_exclude</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">polygon2gdf</span><span class="p">(</span>
                    <span class="n">feats</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">read_geoms</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">exclude_mask</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">crs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gdf_exclude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                    <span class="n">exclude_mask</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span>
                <span class="p">)</span>

        <span class="c1"># get mask</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;regular&quot;</span><span class="p">:</span>
            <span class="n">da_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">create_mask_active</span><span class="p">(</span>
                <span class="n">da_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;msk&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;msk&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">da_dep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;dep&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;dep&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">gdf_mask</span><span class="o">=</span><span class="n">gdf_mask</span><span class="p">,</span>
                <span class="n">gdf_include</span><span class="o">=</span><span class="n">gdf_include</span><span class="p">,</span>
                <span class="n">gdf_exclude</span><span class="o">=</span><span class="n">gdf_exclude</span><span class="p">,</span>
                <span class="n">zmin</span><span class="o">=</span><span class="n">zmin</span><span class="p">,</span>
                <span class="n">zmax</span><span class="o">=</span><span class="n">zmax</span><span class="p">,</span>
                <span class="n">fill_area</span><span class="o">=</span><span class="n">fill_area</span><span class="p">,</span>
                <span class="n">drop_area</span><span class="o">=</span><span class="n">drop_area</span><span class="p">,</span>
                <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span>
                <span class="n">all_touched</span><span class="o">=</span><span class="n">all_touched</span><span class="p">,</span>
                <span class="n">reset_mask</span><span class="o">=</span><span class="n">reset_mask</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid</span><span class="p">(</span><span class="n">da_mask</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;msk&quot;</span><span class="p">)</span>
            <span class="c1"># update config</span>
            <span class="k">if</span> <span class="s2">&quot;mskfile&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;mskfile&quot;</span><span class="p">:</span> <span class="s2">&quot;sfincs.msk&quot;</span><span class="p">})</span>
            <span class="k">if</span> <span class="s2">&quot;indexfile&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;indexfile&quot;</span><span class="p">:</span> <span class="s2">&quot;sfincs.ind&quot;</span><span class="p">})</span>
            <span class="c1"># update region</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Derive region geometry based on active cells.&quot;</span><span class="p">)</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">da_mask</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">da_mask</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">vectorize</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_geoms</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_mask_bounds"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_mask_bounds.html#hydromt_sfincs.SfincsModel.setup_mask_bounds">[docs]</a>    <span class="k">def</span> <span class="nf">setup_mask_bounds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">btype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;waterlevel&quot;</span><span class="p">,</span>
        <span class="n">include_mask</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude_mask</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zmin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">connectivity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
        <span class="n">all_touched</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">reset_bounds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set boundary cells in the model mask.</span>

<span class="sd">        The SFINCS model mask defines inactive (msk=0), active (msk=1), and waterlevel boundary (msk=2)</span>
<span class="sd">        and outflow boundary (msk=3) cells. Active cells set using the `setup_mask` method,</span>
<span class="sd">        while this method sets both types of boundary cells, see `btype` argument.</span>

<span class="sd">        Boundary cells at the edge of the active model domain,</span>
<span class="sd">        optionally bounded by areas inside the include geomtries, outside the exclude geomtries,</span>
<span class="sd">        larger or equal than a minimum elevation threshhold and smaller or equal than a</span>
<span class="sd">        maximum elevation threshhold.</span>
<span class="sd">        All conditions are combined using a logical AND operation.</span>

<span class="sd">        Updates model layers:</span>

<span class="sd">        * **msk** map: model mask [-]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        btype: {&#39;waterlevel&#39;, &#39;outflow&#39;}</span>
<span class="sd">            Boundary type</span>
<span class="sd">        include_mask, exclude_mask: str, Path, gpd.GeoDataFrame, optional</span>
<span class="sd">            Path or data source name for geometries with areas to include/exclude from the model boundary.</span>
<span class="sd">        zmin, zmax : float, optional</span>
<span class="sd">            Minimum and maximum elevation thresholds for boundary cells.</span>
<span class="sd">            Note that when include and exclude areas are used, the elevation range is only applied</span>
<span class="sd">            on cells within the include area and outside the exclude area.</span>
<span class="sd">        reset_bounds: bool, optional</span>
<span class="sd">            If True, reset existing boundary cells of the selected boundary</span>
<span class="sd">            type (`btype`) before setting new boundary cells, by default False.</span>
<span class="sd">        all_touched: bool, optional</span>
<span class="sd">            if True (default) include (or exclude) a cell in the mask if it touches any of the</span>
<span class="sd">            include (or exclude) geometries. If False, include a cell only if its center is</span>
<span class="sd">            within one of the shapes, or if it is selected by Bresenham&#39;s line algorithm.</span>
<span class="sd">        connectivity, {4, 8}:</span>
<span class="sd">            The connectivity used to detect the model edge, if 4 only horizontal and vertical</span>
<span class="sd">            connections are used, if 8 (default) also diagonal connections.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get include / exclude geometries</span>
        <span class="n">gdf_include</span><span class="p">,</span> <span class="n">gdf_exclude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span><span class="o">.</span><span class="n">total_bounds</span>
        <span class="k">if</span> <span class="n">include_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">include_mask</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">include_mask</span>
            <span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pol&quot;</span><span class="p">):</span>
                <span class="c1"># NOTE polygons should be in same CRS as model</span>
                <span class="n">gdf_include</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">polygon2gdf</span><span class="p">(</span>
                    <span class="n">feats</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">read_geoms</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">include_mask</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">crs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gdf_include</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                    <span class="n">include_mask</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">exclude_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exclude_mask</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">exclude_mask</span>
            <span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pol&quot;</span><span class="p">):</span>
                <span class="n">gdf_exclude</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">polygon2gdf</span><span class="p">(</span>
                    <span class="n">feats</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">read_geoms</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">exclude_mask</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">crs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gdf_exclude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                    <span class="n">exclude_mask</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span>
                <span class="p">)</span>

        <span class="c1"># mask values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;regular&quot;</span><span class="p">:</span>
            <span class="n">da_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">create_mask_bounds</span><span class="p">(</span>
                <span class="n">da_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;msk&quot;</span><span class="p">],</span>
                <span class="n">btype</span><span class="o">=</span><span class="n">btype</span><span class="p">,</span>
                <span class="n">gdf_include</span><span class="o">=</span><span class="n">gdf_include</span><span class="p">,</span>
                <span class="n">gdf_exclude</span><span class="o">=</span><span class="n">gdf_exclude</span><span class="p">,</span>
                <span class="n">da_dep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;dep&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;dep&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">zmin</span><span class="o">=</span><span class="n">zmin</span><span class="p">,</span>
                <span class="n">zmax</span><span class="o">=</span><span class="n">zmax</span><span class="p">,</span>
                <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span>
                <span class="n">all_touched</span><span class="o">=</span><span class="n">all_touched</span><span class="p">,</span>
                <span class="n">reset_bounds</span><span class="o">=</span><span class="n">reset_bounds</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid</span><span class="p">(</span><span class="n">da_mask</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;msk&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_subgrid"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_subgrid.html#hydromt_sfincs.SfincsModel.setup_subgrid">[docs]</a>    <span class="k">def</span> <span class="nf">setup_subgrid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">datasets_dep</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
        <span class="n">datasets_rgh</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">buffer_cells</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">nr_subgrid_pixels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">nrmax</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>  <span class="c1"># blocksize</span>
        <span class="n">max_gradient</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="n">z_minimum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99999.0</span><span class="p">,</span>
        <span class="n">manning_land</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span>
        <span class="n">manning_sea</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span>
        <span class="n">rgh_lev_land</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">write_dep_tif</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">write_man_tif</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup method for subgrid tables based on a list of</span>
<span class="sd">        elevation and Manning&#39;s roughness datasets.</span>

<span class="sd">        These datasets are used to derive relations between the water level</span>
<span class="sd">        and the volume in a cell to do the continuity update,</span>
<span class="sd">        and a representative water depth used to calculate momentum fluxes.</span>

<span class="sd">        This allows that one can compute on a coarser computational grid,</span>
<span class="sd">        while still accounting for the local topography and roughness.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        datasets_dep : List[dict]</span>
<span class="sd">            List of dictionaries with topobathy data.</span>
<span class="sd">            Each should minimally contain a data catalog source name, data file path, or xarray raster object (&#39;elevtn&#39;)</span>
<span class="sd">            Optional merge arguments include &#39;zmin&#39;, &#39;zmax&#39;, &#39;mask&#39;, &#39;offset&#39;, &#39;reproj_method&#39;, and &#39;merge_method&#39;.</span>
<span class="sd">            e.g.: [{&#39;elevtn&#39;: merit_hydro, &#39;zmin&#39;: 0.01}, {&#39;elevtn&#39;: gebco, &#39;offset&#39;: 0, &#39;merge_method&#39;: &#39;first&#39;, reproj_method: &#39;bilinear&#39;}]</span>
<span class="sd">            For a complete overview of all merge options, see :py:function:~hydromt.workflows.merge_multi_dataarrays</span>
<span class="sd">        datasets_rgh : List[dict], optional</span>
<span class="sd">            List of dictionaries with Manning&#39;s n datasets. Each dictionary should at least contain one of the following:</span>
<span class="sd">            * (1) manning: filename (or Path) of gridded data with manning values</span>
<span class="sd">            * (2) lulc (and reclass_table) :a combination of a filename of gridded landuse/landcover and a mapping table.</span>
<span class="sd">            In additon, optional merge arguments can be provided e.g.: merge_method, gdf_valid_fn</span>
<span class="sd">        buffer_cells : int, optional</span>
<span class="sd">            Number of cells between datasets to ensure smooth transition of bed levels, by default 0</span>
<span class="sd">        nbins : int, optional</span>
<span class="sd">            Number of bins in the subgrid tables, by default 10</span>
<span class="sd">        nr_subgrid_pixels : int, optional</span>
<span class="sd">            Number of subgrid pixels per computational cell, by default 20</span>
<span class="sd">        nrmax : int, optional</span>
<span class="sd">            Maximum number of cells per subgrid-block, by default 2000</span>
<span class="sd">            These blocks are used to prevent memory issues while working with large datasets</span>
<span class="sd">        max_gradient : float, optional</span>
<span class="sd">            Maximum gradient in the subgrid tables, by default 5.0</span>
<span class="sd">        z_minimum : float, optional</span>
<span class="sd">            Minimum depth in the subgrid tables, by default -99999.0</span>
<span class="sd">        manning_land, manning_sea : float, optional</span>
<span class="sd">            Constant manning roughness values for land and sea, by default 0.04 and 0.02 s.m-1/3</span>
<span class="sd">            Note that these values are only used when no Manning&#39;s n datasets are provided, or to fill the nodata values</span>
<span class="sd">        rgh_lev_land : float, optional</span>
<span class="sd">            Elevation level to distinguish land and sea roughness (when using manning_land and manning_sea), by default 0.0</span>
<span class="sd">        write_dep_tif : bool, optional</span>
<span class="sd">            Create geotiff of the merged topobathy on the subgrid resolution, by default False</span>
<span class="sd">        write_man_tif : bool, optional</span>
<span class="sd">            Create geotiff of the merged roughness on the subgrid resolution, by default False</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># retrieve model resolution</span>
        <span class="c1"># TODO fix for quadtree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">is_geographic</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">nr_subgrid_pixels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">111111.0</span> <span class="o">/</span> <span class="n">nr_subgrid_pixels</span>

        <span class="n">datasets_dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_datasets_dep</span><span class="p">(</span><span class="n">datasets_dep</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasets_rgh</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># NOTE conversion from landuse/landcover to manning happens here</span>
            <span class="n">datasets_rgh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_datasets_rgh</span><span class="p">(</span><span class="n">datasets_rgh</span><span class="p">)</span>

        <span class="c1"># folder where high-resolution topobathy and manning geotiffs are stored</span>
        <span class="k">if</span> <span class="n">write_dep_tif</span> <span class="ow">or</span> <span class="n">write_man_tif</span><span class="p">:</span>
            <span class="n">highres_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;subgrid&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">highres_dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">highres_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">highres_dir</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;regular&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">subgrid</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
                <span class="n">da_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
                <span class="n">datasets_dep</span><span class="o">=</span><span class="n">datasets_dep</span><span class="p">,</span>
                <span class="n">datasets_rgh</span><span class="o">=</span><span class="n">datasets_rgh</span><span class="p">,</span>
                <span class="n">buffer_cells</span><span class="o">=</span><span class="n">buffer_cells</span><span class="p">,</span>
                <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span>
                <span class="n">nr_subgrid_pixels</span><span class="o">=</span><span class="n">nr_subgrid_pixels</span><span class="p">,</span>
                <span class="n">nrmax</span><span class="o">=</span><span class="n">nrmax</span><span class="p">,</span>
                <span class="n">max_gradient</span><span class="o">=</span><span class="n">max_gradient</span><span class="p">,</span>
                <span class="n">z_minimum</span><span class="o">=</span><span class="n">z_minimum</span><span class="p">,</span>
                <span class="n">manning_land</span><span class="o">=</span><span class="n">manning_land</span><span class="p">,</span>
                <span class="n">manning_sea</span><span class="o">=</span><span class="n">manning_sea</span><span class="p">,</span>
                <span class="n">rgh_lev_land</span><span class="o">=</span><span class="n">rgh_lev_land</span><span class="p">,</span>
                <span class="n">write_dep_tif</span><span class="o">=</span><span class="n">write_dep_tif</span><span class="p">,</span>
                <span class="n">write_man_tif</span><span class="o">=</span><span class="n">write_man_tif</span><span class="p">,</span>
                <span class="n">highres_dir</span><span class="o">=</span><span class="n">highres_dir</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subgrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">subgrid</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">(</span>
                <span class="n">dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">coords</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;quadtree&quot;</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="s2">&quot;sbgfile&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>  <span class="c1"># only add sbgfile if not already present</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;sbgfile&quot;</span><span class="p">:</span> <span class="s2">&quot;sfincs.sbg&quot;</span><span class="p">})</span>
        <span class="c1"># subgrid is used so no depfile or manningfile needed</span>
        <span class="k">if</span> <span class="s2">&quot;depfile&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;depfile&quot;</span><span class="p">)</span>  <span class="c1"># remove depfile from config</span>
        <span class="k">if</span> <span class="s2">&quot;manningfile&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;manningfile&quot;</span><span class="p">)</span>  <span class="c1"># remove manningfile from config</span></div>

<div class="viewcode-block" id="SfincsModel.setup_river_inflow"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_river_inflow.html#hydromt_sfincs.SfincsModel.setup_river_inflow">[docs]</a>    <span class="k">def</span> <span class="nf">setup_river_inflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rivers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hydrography</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">river_upa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="n">river_len</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e3</span><span class="p">,</span>
        <span class="n">river_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
        <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">first_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">keep_rivers_geom</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup discharge (src) points where a river enters the model domain.</span>

<span class="sd">        If `rivers` is not provided, river centerlines are extracted from the</span>
<span class="sd">        `hydrography` dataset based on the `river_upa` threshold.</span>

<span class="sd">        Waterlevel or outflow boundary cells intersecting with the river</span>
<span class="sd">        are removed from the model mask.</span>

<span class="sd">        Note: this method assumes the rivers are directed from up- to downstream.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **dis** forcing: discharge forcing</span>
<span class="sd">        * **mask** map: SFINCS mask layer (only if `river_width` &gt; 0)</span>
<span class="sd">        * **rivers_inflow** geoms: river centerline (if `keep_rivers_geom`; not used by SFINCS)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rivers : str, Path, gpd.GeoDataFrame, optional</span>
<span class="sd">            Path, data source name, or geopandas object for river centerline data.</span>
<span class="sd">            If present, the &#39;uparea&#39; and &#39;rivlen&#39; attributes are used.</span>
<span class="sd">        hydrography: str, Path, xr.Dataset optional</span>
<span class="sd">            Path, data source name, or a xarray raster object for hydrography data.</span>

<span class="sd">            * Required layers: [&#39;uparea&#39;, &#39;flwdir&#39;].</span>
<span class="sd">        river_upa : float, optional</span>
<span class="sd">            Minimum upstream area threshold for rivers [km2], by default 10.0</span>
<span class="sd">        river_len: float, optional</span>
<span class="sd">            Mimimum river length within the model domain threshhold [m], by default 1 km.</span>
<span class="sd">        river_width: float, optional</span>
<span class="sd">            Estimated constant width [m] of the inflowing river. Boundary cells within</span>
<span class="sd">            half the width are forced to be closed (mask = 1) to avoid instabilities with</span>
<span class="sd">            nearby open or waterlevel boundary cells, by default 500 m.</span>
<span class="sd">        merge: bool, optional</span>
<span class="sd">            If True, merge rivers source points with existing points, by default False.</span>
<span class="sd">        first_index: int, optional</span>
<span class="sd">            First index for the river source points, by default 1.</span>
<span class="sd">        keep_rivers_geom: bool, optional</span>
<span class="sd">            If True, keep a geometry of the rivers &quot;rivers_inflow&quot; in geoms. By default False.</span>
<span class="sd">        buffer: int, optional</span>
<span class="sd">            Buffer [no. of cells] around model domain, by default 10.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">da_flwdir</span><span class="p">,</span> <span class="n">da_uparea</span><span class="p">,</span> <span class="n">gdf_riv</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">hydrography</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                <span class="n">hydrography</span><span class="p">,</span>
                <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">,</span> <span class="s2">&quot;flwdir&quot;</span><span class="p">],</span>
                <span class="n">buffer</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">da_flwdir</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;flwdir&quot;</span><span class="p">]</span>
            <span class="n">da_uparea</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">rivers</span> <span class="o">==</span> <span class="s2">&quot;rivers_outflow&quot;</span> <span class="ow">and</span> <span class="n">rivers</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="c1"># reuse rivers from setup_river_in/outflow</span>
            <span class="n">gdf_riv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="n">rivers</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">rivers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf_riv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                <span class="n">rivers</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either hydrography or rivers must be provided.&quot;</span><span class="p">)</span>

        <span class="n">gdf_src</span><span class="p">,</span> <span class="n">gdf_riv</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">river_boundary_points</span><span class="p">(</span>
            <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="n">res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span>
            <span class="n">gdf_riv</span><span class="o">=</span><span class="n">gdf_riv</span><span class="p">,</span>
            <span class="n">da_flwdir</span><span class="o">=</span><span class="n">da_flwdir</span><span class="p">,</span>
            <span class="n">da_uparea</span><span class="o">=</span><span class="n">da_uparea</span><span class="p">,</span>
            <span class="n">river_len</span><span class="o">=</span><span class="n">river_len</span><span class="p">,</span>
            <span class="n">river_upa</span><span class="o">=</span><span class="n">river_upa</span><span class="p">,</span>
            <span class="n">inflow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_src</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> river inflow points.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># set forcing src pnts</span>
        <span class="n">gdf_src</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">gdf_src</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">first_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">gdf_locs</span><span class="o">=</span><span class="n">gdf_src</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dis&quot;</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="n">merge</span><span class="p">)</span>

        <span class="c1"># set river</span>
        <span class="k">if</span> <span class="n">keep_rivers_geom</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_geoms</span><span class="p">(</span><span class="n">gdf_riv</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rivers_inflow&quot;</span><span class="p">)</span>

        <span class="c1"># update mask if river_width &gt; 0</span>
        <span class="k">if</span> <span class="s2">&quot;rivwth&quot;</span> <span class="ow">in</span> <span class="n">gdf_src</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">river_width</span> <span class="o">=</span> <span class="n">gdf_src</span><span class="p">[</span><span class="s2">&quot;rivwth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">river_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">river_width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># apply buffer</span>
            <span class="n">gdf_src</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_src</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">river_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># find intersect of buffer and model grid</span>
            <span class="n">tmp_msk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">create_mask_bounds</span><span class="p">(</span>
                <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">gdf_include</span><span class="o">=</span><span class="n">gdf_src</span>
            <span class="p">)</span>
            <span class="n">reset_msk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">tmp_msk</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># update model mask</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">reset_msk</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">da_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">reset_msk</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_grid</span><span class="p">(</span><span class="n">da_mask</span><span class="p">,</span> <span class="s2">&quot;msk&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Boundary cells (n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">) updated around src points.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_river_outflow"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_river_outflow.html#hydromt_sfincs.SfincsModel.setup_river_outflow">[docs]</a>    <span class="k">def</span> <span class="nf">setup_river_outflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rivers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hydrography</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">river_upa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="n">river_len</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e3</span><span class="p">,</span>
        <span class="n">river_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
        <span class="n">keep_rivers_geom</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">reset_bounds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">btype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;outflow&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup open boundary cells (mask=3) where a river flows</span>
<span class="sd">        out of the model domain.</span>

<span class="sd">        If `rivers` is not provided, river centerlines are extracted from the</span>
<span class="sd">        `hydrography` dataset based on the `river_upa` threshold.</span>

<span class="sd">        River outflows that intersect with discharge source point or waterlevel</span>
<span class="sd">        boundary cells are omitted.</span>

<span class="sd">        Note: this method assumes the rivers are directed from up- to downstream.</span>

<span class="sd">        Adds / edits model layers:</span>

<span class="sd">        * **msk** map: edited by adding outflow points (msk=3)</span>
<span class="sd">        * **rivers_outflow** geoms: river centerline (if `keep_rivers_geom`; not used by SFINCS)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rivers : str, Path, gpd.GeoDataFrame, optional</span>
<span class="sd">            Path, data source name, or geopandas object for river centerline data.</span>
<span class="sd">            If present, the &#39;uparea&#39; and &#39;rivlen&#39; attributes are used.</span>
<span class="sd">        hydrography: str, Path, xr.Dataset optional</span>
<span class="sd">            Path, data source name, or a xarray raster object for hydrography data.</span>

<span class="sd">            * Required layers: [&#39;uparea&#39;, &#39;flwdir&#39;].</span>
<span class="sd">        river_upa : float, optional</span>
<span class="sd">            Minimum upstream area threshold for rivers [km2], by default 10.0</span>
<span class="sd">        river_len: float, optional</span>
<span class="sd">            Mimimum river length within the model domain threshhold [m], by default 1000 m.</span>
<span class="sd">        river_width: int, optional</span>
<span class="sd">            The width [m] of the open boundary cells in the SFINCS msk file.</span>
<span class="sd">            By default 500m, i.e.: 250m to each side of the outflow location.</span>
<span class="sd">        append_bounds: bool, optional</span>
<span class="sd">            If True, write new outflow boundary cells on top of existing. If False (default),</span>
<span class="sd">            first reset existing outflow boundary cells to normal active cells.</span>
<span class="sd">        keep_rivers_geom: bool, optional</span>
<span class="sd">            If True, keep a geometry of the rivers &quot;rivers_outflow&quot; in geoms. By default False.</span>
<span class="sd">        reset_bounds: bool, optional</span>
<span class="sd">            If True, reset existing outlfow boundary cells before setting new boundary cells,</span>
<span class="sd">            by default False.</span>
<span class="sd">        btype: {&#39;waterlevel&#39;, &#39;outflow&#39;}</span>
<span class="sd">            Boundary type</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        setup_mask_bounds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">da_flwdir</span><span class="p">,</span> <span class="n">da_uparea</span><span class="p">,</span> <span class="n">gdf_riv</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">hydrography</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                <span class="n">hydrography</span><span class="p">,</span>
                <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">,</span> <span class="s2">&quot;flwdir&quot;</span><span class="p">],</span>
                <span class="n">buffer</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">da_flwdir</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;flwdir&quot;</span><span class="p">]</span>
            <span class="n">da_uparea</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">rivers</span> <span class="o">==</span> <span class="s2">&quot;rivers_inflow&quot;</span> <span class="ow">and</span> <span class="n">rivers</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="c1"># reuse rivers from setup_river_in/outflow</span>
            <span class="n">gdf_riv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="n">rivers</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">rivers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf_riv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                <span class="n">rivers</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either hydrography or rivers must be provided.&quot;</span><span class="p">)</span>

        <span class="c1"># TODO reproject region and gdf_riv to utm zone if model crs is geographic</span>
        <span class="n">gdf_out</span><span class="p">,</span> <span class="n">gdf_riv</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">river_boundary_points</span><span class="p">(</span>
            <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="n">res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span>
            <span class="n">gdf_riv</span><span class="o">=</span><span class="n">gdf_riv</span><span class="p">,</span>
            <span class="n">da_flwdir</span><span class="o">=</span><span class="n">da_flwdir</span><span class="p">,</span>
            <span class="n">da_uparea</span><span class="o">=</span><span class="n">da_uparea</span><span class="p">,</span>
            <span class="n">river_len</span><span class="o">=</span><span class="n">river_len</span><span class="p">,</span>
            <span class="n">river_upa</span><span class="o">=</span><span class="n">river_upa</span><span class="p">,</span>
            <span class="n">inflow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;rivwth&quot;</span> <span class="ow">in</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">river_width</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="p">[</span><span class="s2">&quot;rivwth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">river_width</span><span class="p">)</span>
            <span class="n">gdf_out</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">river_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># remove points near waterlevel boundary cells</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">btype</span> <span class="o">==</span> <span class="s2">&quot;outflow&quot;</span><span class="p">:</span>
                <span class="n">gdf_msk2</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_bounds_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
                <span class="c1"># NOTE: this should be a single geom</span>
                <span class="n">geom</span> <span class="o">=</span> <span class="n">gdf_msk2</span><span class="p">[</span><span class="n">gdf_msk2</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">unary_union</span>
                <span class="n">gdf_out</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="p">[</span><span class="o">~</span><span class="n">gdf_out</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">geom</span><span class="p">)]</span>
            <span class="c1"># remove outflow points near source points</span>
            <span class="k">if</span> <span class="s2">&quot;dis&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="s2">&quot;dis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span><span class="o">.</span><span class="n">unary_union</span>
                <span class="n">gdf_out</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="p">[</span><span class="o">~</span><span class="n">gdf_out</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">geom</span><span class="p">)]</span>

        <span class="c1"># update mask</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_out</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> valid river outflow points.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_mask_bounds</span><span class="p">(</span>
                <span class="n">btype</span><span class="o">=</span><span class="n">btype</span><span class="p">,</span> <span class="n">include_mask</span><span class="o">=</span><span class="n">gdf_out</span><span class="p">,</span> <span class="n">reset_bounds</span><span class="o">=</span><span class="n">reset_bounds</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">reset_bounds</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_mask_bounds</span><span class="p">(</span><span class="n">btype</span><span class="o">=</span><span class="n">btype</span><span class="p">,</span> <span class="n">reset_bounds</span><span class="o">=</span><span class="n">reset_bounds</span><span class="p">)</span>

        <span class="c1"># keep river centerlines</span>
        <span class="k">if</span> <span class="n">keep_rivers_geom</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_riv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_geoms</span><span class="p">(</span><span class="n">gdf_riv</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rivers_outflow&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_constant_infiltration"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_constant_infiltration.html#hydromt_sfincs.SfincsModel.setup_constant_infiltration">[docs]</a>    <span class="k">def</span> <span class="nf">setup_constant_infiltration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qinf</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup spatially varying constant infiltration rate (qinffile).</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **qinf** map: constant infiltration rate [mm/hr]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qinf : str, Path, or RasterDataset</span>
<span class="sd">            Spatially varying infiltration rates [mm/hr]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get infiltration data</span>
        <span class="n">da_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span><span class="n">qinf</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        
        <span class="c1"># reproject infiltration data to model grid</span>
        <span class="c1"># this workflow automatically determines the best resampling method (bilinear or average) </span>
        <span class="n">da_inf</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">merge_multi_dataarrays</span><span class="p">(</span>
            <span class="n">da_list</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;da&quot;</span><span class="p">:</span><span class="n">da_inf</span><span class="p">}],</span>
            <span class="n">da_like</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># check on nan values</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">da_inf</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;NaN values found in infiltration data; filled with 0&quot;</span><span class="p">)</span>
            <span class="n">da_inf</span> <span class="o">=</span> <span class="n">da_inf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># add to sfincs model </span>
        <span class="n">da_inf</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_nodata</span><span class="p">(</span><span class="o">-</span><span class="mf">9999.0</span><span class="p">)</span>

        <span class="c1"># set grid</span>
        <span class="n">mname</span> <span class="o">=</span> <span class="s2">&quot;qinf&quot;</span>
        <span class="n">da_inf</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">sf</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">set_grid</span><span class="p">(</span><span class="n">da_inf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">mname</span><span class="p">)</span>

        <span class="c1"># update config: remove scs infiltration values and set qinf map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;scs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_cn_infiltration"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_cn_infiltration.html#hydromt_sfincs.SfincsModel.setup_cn_infiltration">[docs]</a>    <span class="k">def</span> <span class="nf">setup_cn_infiltration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cn</span><span class="p">,</span> <span class="n">antecedent_moisture</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup model potential maximum soil moisture retention map (scsfile)</span>
<span class="sd">        from gridded curve number map.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **scs** map: potential maximum soil moisture retention [inch]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        cn: str, Path, or RasterDataset</span>
<span class="sd">            Name of gridded curve number map.</span>

<span class="sd">            * Required layers without antecedent runoff conditions: [&#39;cn&#39;]</span>
<span class="sd">            * Required layers with antecedent runoff conditions: [&#39;cn_dry&#39;, &#39;cn_avg&#39;, &#39;cn_wet&#39;]</span>
<span class="sd">        antecedent_moisture: {&#39;dry&#39;, &#39;avg&#39;, &#39;wet&#39;}, optional</span>
<span class="sd">            Antecedent runoff conditions.</span>
<span class="sd">            None if data has no antecedent runoff conditions.</span>
<span class="sd">            By default `avg`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get data</span>
        <span class="n">v</span> <span class="o">=</span> <span class="s2">&quot;cn&quot;</span>
        <span class="k">if</span> <span class="n">antecedent_moisture</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cn_</span><span class="si">{</span><span class="n">antecedent_moisture</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">da_org</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">cn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># reproject using median</span>
        <span class="n">da_cn</span> <span class="o">=</span> <span class="n">da_org</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reproject_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;med&quot;</span><span class="p">)</span>
        <span class="c1"># CN=100 based on water mask</span>
        <span class="k">if</span> <span class="s2">&quot;rivmsk&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Updating CN map based on &quot;rivmsk&quot; from setup_river_hydrography method.&#39;</span>
            <span class="p">)</span>
            <span class="n">da_cn</span> <span class="o">=</span> <span class="n">da_cn</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;rivmsk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="c1"># convert to potential maximum soil moisture retention S (1000/CN - 10) [inch]</span>
        <span class="n">da_scs</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">cn_to_s</span><span class="p">(</span><span class="n">da_cn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1"># set grid</span>
        <span class="n">mname</span> <span class="o">=</span> <span class="s2">&quot;scs&quot;</span>
        <span class="n">da_scs</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_grid</span><span class="p">(</span><span class="n">da_scs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">mname</span><span class="p">)</span>
        <span class="c1"># update config: remove default infiltration values and set scs map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;qinf&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_manning_roughness"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_manning_roughness.html#hydromt_sfincs.SfincsModel.setup_manning_roughness">[docs]</a>    <span class="k">def</span> <span class="nf">setup_manning_roughness</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">datasets_rgh</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">manning_land</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span>
        <span class="n">manning_sea</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
        <span class="n">rgh_lev_land</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup model manning roughness map (manningfile) from gridded manning data or a combinataion of gridded</span>
<span class="sd">        land-use/land-cover map and manning roughness mapping table.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **man** map: manning roughness coefficient [s.m-1/3]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        datasets_rgh : List[dict], optional</span>
<span class="sd">            List of dictionaries with Manning&#39;s n datasets. Each dictionary should at least contain one of the following:</span>
<span class="sd">            * (1) manning: filename (or Path) of gridded data with manning values</span>
<span class="sd">            * (2) lulc (and reclass_table) :a combination of a filename of gridded landuse/landcover and a mapping table.</span>
<span class="sd">            In additon, optional merge arguments can be provided e.g.: merge_method, gdf_valid_fn</span>
<span class="sd">        manning_land, manning_sea : float, optional</span>
<span class="sd">            Constant manning roughness values for land and sea, by default 0.04 and 0.02 s.m-1/3</span>
<span class="sd">            Note that these values are only used when no Manning&#39;s n datasets are provided, or to fill the nodata values</span>
<span class="sd">        rgh_lev_land : float, optional</span>
<span class="sd">            Elevation level to distinguish land and sea roughness (when using manning_land and manning_sea), by default 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasets_rgh</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">datasets_rgh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_datasets_rgh</span><span class="p">(</span><span class="n">datasets_rgh</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">datasets_rgh</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># fromdep keeps track of whether any manning values should be based on the depth or not</span>
        <span class="n">fromdep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasets_rgh</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;regular&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasets_rgh</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">da_man</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">merge_multi_dataarrays</span><span class="p">(</span>
                    <span class="n">da_list</span><span class="o">=</span><span class="n">datasets_rgh</span><span class="p">,</span>
                    <span class="n">da_like</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
                    <span class="n">interp_method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
                    <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">fromdep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">da_man</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;dep&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="ow">and</span> <span class="n">fromdep</span><span class="p">:</span>
                <span class="n">da_man0</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;dep&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">rgh_lev_land</span><span class="p">,</span> <span class="n">manning_land</span><span class="p">,</span> <span class="n">manning_sea</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">fromdep</span><span class="p">:</span>
                <span class="n">da_man0</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">manning_land</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasets_rgh</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">fromdep</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;nan values in manning roughness array&quot;</span><span class="p">)</span>
                <span class="n">da_man</span> <span class="o">=</span> <span class="n">da_man</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">da_man</span><span class="p">),</span> <span class="n">da_man0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">fromdep</span><span class="p">:</span>
                <span class="n">da_man</span> <span class="o">=</span> <span class="n">da_man0</span>
            <span class="n">da_man</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_nodata</span><span class="p">(</span><span class="o">-</span><span class="mf">9999.0</span><span class="p">)</span>

            <span class="c1"># set grid</span>
            <span class="n">mname</span> <span class="o">=</span> <span class="s2">&quot;manning&quot;</span>
            <span class="n">da_man</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid</span><span class="p">(</span><span class="n">da_man</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">mname</span><span class="p">)</span>
            <span class="c1"># update config: remove default manning values and set maning map</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;manning_land&quot;</span><span class="p">,</span> <span class="s2">&quot;manning_sea&quot;</span><span class="p">,</span> <span class="s2">&quot;rgh_lev_land&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">mname</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_observation_points"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_observation_points.html#hydromt_sfincs.SfincsModel.setup_observation_points">[docs]</a>    <span class="k">def</span> <span class="nf">setup_observation_points</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">locations</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">],</span>
        <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup model observation point locations.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **obs** geom: observation point locations</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        locations: str, Path, gpd.GeoDataFrame, optional</span>
<span class="sd">            Path, data source name, or geopandas object for observation point locations.</span>
<span class="sd">        merge: bool, optional</span>
<span class="sd">            If True, merge the new observation points with the existing ones. By default True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="s2">&quot;observation_points&quot;</span><span class="p">]</span>

        <span class="c1"># FIXME ensure the catalog is loaded before adding any new entries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">sources</span>

        <span class="n">gdf_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
            <span class="n">locations</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">assert_gtype</span><span class="o">=</span><span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">gdf_obs</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;Point&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Observation points must be of type Point.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">merge</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">gdf0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">gdf_obs</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">gdf_obs</span><span class="p">,</span> <span class="n">gdf0</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding new observation points to existing ones.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_geoms</span><span class="p">(</span><span class="n">gdf_obs</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_structures"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_structures.html#hydromt_sfincs.SfincsModel.setup_structures">[docs]</a>    <span class="k">def</span> <span class="nf">setup_structures</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structures</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">],</span>
        <span class="n">stype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">dz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup thin dam or weir structures.</span>

<span class="sd">        Adds model layer (depending on `stype`):</span>

<span class="sd">        * **thd** geom: thin dam</span>
<span class="sd">        * **weir** geom: weir / levee</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structures : str, Path</span>
<span class="sd">            Path, data source name, or geopandas object to structure line geometry file.</span>
<span class="sd">            The &quot;name&quot; (for thd and weir), &quot;z&quot; and &quot;par1&quot; (for weir only) variables are optional.</span>
<span class="sd">            For weirs: `dz` must be provided if gdf has no &quot;z&quot; column or ZLineString;</span>
<span class="sd">            &quot;par1&quot; defaults to 0.6 if gdf has no &quot;par1&quot; column.</span>
<span class="sd">        stype : {&#39;thd&#39;, &#39;weir&#39;}</span>
<span class="sd">            Structure type.</span>
<span class="sd">        merge : bool, optional</span>
<span class="sd">            If True, merge with existing&#39;stype&#39; structures, by default True.    </span>
<span class="sd">        dz: float, optional</span>
<span class="sd">            If provided, for weir structures the z value is calculated from</span>
<span class="sd">            the model elevation (dep) plus dz.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># read, clip and reproject</span>
        <span class="n">gdf_structures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
            <span class="n">structures</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;thd&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">],</span>
            <span class="s2">&quot;weir&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;par1&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">assert</span> <span class="n">stype</span> <span class="ow">in</span> <span class="n">cols</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf_structures</span><span class="p">[</span>
            <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">[</span><span class="n">stype</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">gdf_structures</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="p">]</span>  <span class="c1"># keep relevant cols</span>

        <span class="n">structs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gdf2linestring</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>  <span class="c1"># check if it parsed correct</span>
        <span class="c1"># sample zb values from dep file and set z = zb + dz</span>
        <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="s2">&quot;weir&quot;</span> <span class="ow">and</span> <span class="n">dz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;dep&quot;</span><span class="p">]</span>
            <span class="n">structs_out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">structs</span><span class="p">:</span>
                <span class="n">pnts</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
                <span class="n">zb</span> <span class="o">=</span> <span class="n">elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">pnts</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">))</span>
                <span class="n">s</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zb</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">dz</span><span class="p">)</span>
                <span class="n">structs_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">linestring2gdf</span><span class="p">(</span><span class="n">structs_out</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="c1"># Else function if you define elevation of weir</span>
        <span class="k">elif</span> <span class="n">stype</span> <span class="o">==</span> <span class="s2">&quot;weir&quot;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="s2">&quot;z&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">structs</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Weir structure requires z values.&quot;</span><span class="p">)</span>
        <span class="c1"># combine with existing structures if present</span>
        <span class="k">if</span> <span class="n">merge</span> <span class="ow">and</span> <span class="n">stype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">gdf0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">stype</span><span class="p">)</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">gdf</span><span class="p">,</span> <span class="n">gdf0</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding </span><span class="si">{</span><span class="n">stype</span><span class="si">}</span><span class="s2"> structures to existing structures.&quot;</span><span class="p">)</span>

        <span class="c1"># set structures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_geoms</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">stype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stype</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">stype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1">### FORCING</span>
<div class="viewcode-block" id="SfincsModel.set_forcing_1d"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.set_forcing_1d.html#hydromt_sfincs.SfincsModel.set_forcing_1d">[docs]</a>    <span class="k">def</span> <span class="nf">set_forcing_1d</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df_ts</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">gdf_locs</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bzs&quot;</span><span class="p">,</span>
        <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set 1D forcing time series for &#39;bzs&#39; or &#39;dis&#39; boundary conditions.</span>

<span class="sd">        1D forcing exists of point location `gdf_locs` and associated timeseries `df_ts`.</span>
<span class="sd">        If `gdf_locs` is None, the currently set locations are used.</span>

<span class="sd">        If merge is True, time series in `df_ts` with the same index will</span>
<span class="sd">        overwrite existing data. Time series with new indices are added to</span>
<span class="sd">        the existing forcing.</span>

<span class="sd">        In case the forcing time series have a numeric index, the index is converted to</span>
<span class="sd">        a datetime index assuming the index is in seconds since `tref`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df_ts : pd.DataFrame, optional</span>
<span class="sd">            1D forcing time series data. If None, dummy forcing data is added.</span>
<span class="sd">        gdf_locs : gpd.GeoDataFrame, optional</span>
<span class="sd">            Location of waterlevel boundary points. If None, the currently set locations are used.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            Name of the waterlevel boundary time series file, by default &#39;bzs&#39;.</span>
<span class="sd">        merge : bool, optional</span>
<span class="sd">            If True, merge with existing forcing data, by default True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check dtypes</span>
        <span class="k">if</span> <span class="n">gdf_locs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gdf_locs</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;gdf_locs must be a gpd.GeoDataFrame&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gdf_locs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">gdf_locs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;gdf_locs index must be unique integer values&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gdf_locs</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;Point&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;gdf_locs geometry must be Point&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gdf_locs</span><span class="o">.</span><span class="n">crs</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">:</span>
                <span class="n">gdf_locs</span> <span class="o">=</span> <span class="n">gdf_locs</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="n">gdf_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">df_ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_ts</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;df_ts must be a pd.DataFrame&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;df_ts column names must be unique integer values&quot;</span><span class="p">)</span>
        <span class="c1"># parse datetime index</span>
        <span class="k">if</span> <span class="n">df_ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_numeric</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;tref&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;tref must be set in config to convert numeric index to datetime index&quot;</span>
                <span class="p">)</span>
            <span class="n">tref</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tref&quot;</span><span class="p">])</span>
            <span class="n">df_ts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tref</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;sec&quot;</span><span class="p">)</span>
        <span class="c1"># parse location index</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">gdf_locs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">df_ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">gdf_locs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">size</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">gdf_locs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># loop over integer columns and find matching index</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">gdf_locs</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">gdf_locs</span><span class="p">[</span><span class="n">col</span><span class="p">])</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                    <span class="n">gdf_locs</span> <span class="o">=</span> <span class="n">gdf_locs</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting gdf_locs index to </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">gdf_locs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="n">gdf_locs</span> <span class="o">=</span> <span class="n">gdf_locs</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No matching index column found in gdf_locs; assuming the order is correct&quot;</span>
                <span class="p">)</span>
        <span class="c1"># merge with existing data</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span> <span class="ow">and</span> <span class="n">merge</span><span class="p">:</span>
            <span class="c1"># read existing data</span>
            <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">gdf0</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
            <span class="n">df0</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index_dim</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">gdf0</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">gdf_locs</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                <span class="c1"># merge locations; overwrite existing locations with the same name</span>
                <span class="n">gdf0</span> <span class="o">=</span> <span class="n">gdf0</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">gdf_locs</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">gdf_locs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">gdf0</span><span class="p">,</span> <span class="n">gdf_locs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
                <span class="c1"># gdf_locs = gpd.GeoDataFrame(gdf_locs, crs=gdf0.crs)</span>
                <span class="n">df0</span> <span class="o">=</span> <span class="n">df0</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">gdf_locs</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">df_ts</span> <span class="o">=</span> <span class="n">df0</span>
            <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">df0</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="c1"># merge timeseries; overwrite existing timeseries with the same name</span>
                <span class="n">df0</span> <span class="o">=</span> <span class="n">df0</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">df_ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df0</span><span class="p">,</span> <span class="n">df_ts</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
                <span class="c1"># use linear interpolation and backfill to fill in missing values</span>
                <span class="n">df_ts</span> <span class="o">=</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
                <span class="n">df_ts</span> <span class="o">=</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># location data is required</span>
        <span class="k">if</span> <span class="n">gdf_locs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;gdf_locs must be provided if not merged with existing </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing data&quot;</span>
            <span class="p">)</span>
        <span class="c1"># fill in missing timeseries</span>
        <span class="k">if</span> <span class="n">df_ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">(),</span> <span class="n">periods</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">data</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">gdf_locs</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># set forcing with consistent names</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">gdf_locs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The gdf_locs index and df_ts columns must be the same&quot;</span><span class="p">)</span>
        <span class="n">gdf_locs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
        <span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
        <span class="n">df_ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">GeoDataArray</span><span class="o">.</span><span class="n">from_gdf</span><span class="p">(</span><span class="n">gdf_locs</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">df_ts</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="SfincsModel.setup_waterlevel_forcing"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_waterlevel_forcing.html#hydromt_sfincs.SfincsModel.setup_waterlevel_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">setup_waterlevel_forcing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">geodataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeseries</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">locations</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">offset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">buffer</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5e3</span><span class="p">,</span>
        <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup waterlevel forcing.</span>

<span class="sd">        Waterlevel boundary conditions are read from a `geodataset` (geospatial point timeseries)</span>
<span class="sd">        or a tabular `timeseries` dataframe. At least one of these must be provided.</span>

<span class="sd">        The tabular timeseries data is combined with `locations` if provided,</span>
<span class="sd">        or with existing &#39;bnd&#39; locations if previously set.</span>

<span class="sd">        Adds model forcing layers:</span>

<span class="sd">        * **bzs** forcing: waterlevel time series [m+ref]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geodataset: str, Path, xr.Dataset, optional</span>
<span class="sd">            Path, data source name, or xarray data object for geospatial point timeseries.</span>
<span class="sd">        timeseries: str, Path, pd.DataFrame, optional</span>
<span class="sd">            Path, data source name, or pandas data object for tabular timeseries.</span>
<span class="sd">        locations: str, Path, gpd.GeoDataFrame, optional</span>
<span class="sd">            Path, data source name, or geopandas object for bnd point locations.</span>
<span class="sd">        offset: str, Path, xr.Dataset, float, optional</span>
<span class="sd">            Path, data source name, constant value or xarray raster data for gridded offset</span>
<span class="sd">            between vertical reference of elevation and waterlevel data,</span>
<span class="sd">            The offset is added to the waterlevel data.</span>
<span class="sd">        buffer: float, optional</span>
<span class="sd">            Buffer [m] around model water level boundary cells to select waterlevel gauges,</span>
<span class="sd">            by default 5 km.</span>
<span class="sd">        merge : bool, optional</span>
<span class="sd">            If True, merge with existing forcing data, by default True.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        set_forcing_1d</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gdf_locs</span><span class="p">,</span> <span class="n">df_ts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">()</span>  <span class="c1"># model time</span>
        <span class="c1"># buffer around msk==2 values</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">vectorize</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span>
        <span class="c1"># read waterlevel data from geodataset or geodataframe</span>
        <span class="k">if</span> <span class="n">geodataset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># read and clip data in time &amp; space</span>
            <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataset</span><span class="p">(</span>
                <span class="n">geodataset</span><span class="p">,</span>
                <span class="n">geom</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
                <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span>
                <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;waterlevel&quot;</span><span class="p">],</span>
                <span class="n">time_tuple</span><span class="o">=</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">),</span>
                <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">df_ts</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index_dim</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
            <span class="n">gdf_locs</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">timeseries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">(</span>
                <span class="n">timeseries</span><span class="p">,</span>
                <span class="n">time_tuple</span><span class="o">=</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">),</span>
                <span class="c1"># kwargs below only applied if timeseries not in data catalog</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># parse column names to integers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either geodataset or timeseries must be provided&quot;</span><span class="p">)</span>

        <span class="c1"># optionally read location data (if not already read from geodataset)</span>
        <span class="k">if</span> <span class="n">gdf_locs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">locations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                <span class="n">locations</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">gdf_locs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;bzs&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="n">gdf_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="s2">&quot;bzs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">gdf_locs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No waterlevel boundary (bnd) points provided.&quot;</span><span class="p">)</span>

        <span class="c1"># optionally read offset data and correct df_ts</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gdf_locs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">df_ts</span> <span class="o">+=</span> <span class="n">offset</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">da_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                    <span class="n">offset</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">5</span>
                <span class="p">)</span>
                <span class="n">offset_pnts</span> <span class="o">=</span> <span class="n">da_offset</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">gdf_locs</span><span class="p">)</span>
                <span class="n">df_offset</span> <span class="o">=</span> <span class="n">offset_pnts</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">df_ts</span> <span class="o">=</span> <span class="n">df_ts</span> <span class="o">+</span> <span class="n">df_offset</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">offset_pnts</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;waterlevel forcing: applied offset (avg: </span><span class="si">{</span><span class="n">offset</span><span class="si">:</span><span class="s2">+.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>

        <span class="c1"># set/ update forcing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">df_ts</span><span class="p">,</span> <span class="n">gdf_locs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bzs&quot;</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="n">merge</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_waterlevel_bnd_from_mask"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_waterlevel_bnd_from_mask.html#hydromt_sfincs.SfincsModel.setup_waterlevel_bnd_from_mask">[docs]</a>    <span class="k">def</span> <span class="nf">setup_waterlevel_bnd_from_mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e4</span><span class="p">,</span>
        <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup waterlevel boundary (bnd) points along model waterlevel boundary (msk=2).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        distance: float, optional</span>
<span class="sd">            Distance [m] between waterlevel boundary points,</span>
<span class="sd">            by default 10 km.</span>
<span class="sd">        merge : bool, optional</span>
<span class="sd">            If True, merge with existing forcing data, by default True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get waterlevel boundary vector based on mask</span>
        <span class="n">gdf_msk</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_bounds_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
        <span class="n">gdf_msk2</span> <span class="o">=</span> <span class="n">gdf_msk</span><span class="p">[</span><span class="n">gdf_msk</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>

        <span class="c1"># create points along boundary</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">gdf_msk2</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">distances</span><span class="p">:</span>
                <span class="n">point</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

        <span class="c1"># create geodataframe with points</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">)),</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

        <span class="c1"># set waterlevel boundary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">gdf_locs</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bzs&quot;</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="n">merge</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_discharge_forcing"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_discharge_forcing.html#hydromt_sfincs.SfincsModel.setup_discharge_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">setup_discharge_forcing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">geodataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeseries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup discharge forcing.</span>

<span class="sd">        Discharge timeseries are read from a `geodataset` (geospatial point timeseries)</span>
<span class="sd">        or a tabular `timeseries` dataframe. At least one of these must be provided.</span>

<span class="sd">        The tabular timeseries data is combined with `locations` if provided,</span>
<span class="sd">        or with existing &#39;src&#39; locations if previously set.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **dis** forcing: discharge time series [m3/s]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geodataset: str, Path, xr.Dataset, optional</span>
<span class="sd">            Path, data source name, or xarray data object for geospatial point timeseries.</span>
<span class="sd">        timeseries: str, Path, pd.DataFrame, optional</span>
<span class="sd">            Path, data source name, or pandas data object for tabular timeseries.</span>
<span class="sd">        locations: str, Path, gpd.GeoDataFrame, optional</span>
<span class="sd">            Path, data source name, or geopandas object for bnd point locations.</span>
<span class="sd">        merge : bool, optional</span>
<span class="sd">            If True, merge with existing forcing data, by default True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gdf_locs</span><span class="p">,</span> <span class="n">df_ts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">()</span>  <span class="c1"># model time</span>
        <span class="c1"># read waterlevel data from geodataset or geodataframe</span>
        <span class="k">if</span> <span class="n">geodataset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># read and clip data in time &amp; space</span>
            <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataset</span><span class="p">(</span>
                <span class="n">geodataset</span><span class="p">,</span>
                <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;discharge&quot;</span><span class="p">],</span>
                <span class="n">time_tuple</span><span class="o">=</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">),</span>
                <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">df_ts</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index_dim</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
            <span class="n">gdf_locs</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">timeseries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">(</span>
                <span class="n">timeseries</span><span class="p">,</span>
                <span class="n">time_tuple</span><span class="o">=</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">),</span>
                <span class="c1"># kwargs below only applied if timeseries not in data catalog</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># parse column names to integers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either geodataset or timeseries must be provided&quot;</span><span class="p">)</span>

        <span class="c1"># optionally read location data (if not already read from geodataset)</span>
        <span class="k">if</span> <span class="n">gdf_locs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">locations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                <span class="n">locations</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">gdf_locs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;dis&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="n">gdf_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="s2">&quot;dis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">gdf_locs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No discharge boundary (src) points provided.&quot;</span><span class="p">)</span>

        <span class="c1"># set/ update forcing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">df_ts</span><span class="p">,</span> <span class="n">gdf_locs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dis&quot;</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="n">merge</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_discharge_forcing_from_grid"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_discharge_forcing_from_grid.html#hydromt_sfincs.SfincsModel.setup_discharge_forcing_from_grid">[docs]</a>    <span class="k">def</span> <span class="nf">setup_discharge_forcing_from_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">discharge</span><span class="p">,</span>
        <span class="n">locations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">uparea</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wdw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">rel_error</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="n">abs_error</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup discharge forcing based on a gridded discharge dataset.</span>

<span class="sd">        Discharge boundary timesereis are read from the `discharge` dataset</span>
<span class="sd">        with gridded discharge time series data.</span>

<span class="sd">        The `locations` are snapped to the `uparea` grid if provided based their</span>
<span class="sd">        uparea attribute. If not provided, the nearest grid cell is used.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **dis** forcing: discharge time series [m3/s]</span>

<span class="sd">        Adds meta layer (not used by SFINCS):</span>

<span class="sd">        * **src_snapped** geom: snapped gauge location on discharge grid</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        discharge: str, Path, xr.DataArray optional</span>
<span class="sd">            Path,  data source name or xarray data object for gridded discharge timeseries dataset.</span>

<span class="sd">            * Required variables: [&#39;discharge&#39; (m3/s)]</span>
<span class="sd">            * Required coordinates: [&#39;time&#39;, &#39;y&#39;, &#39;x&#39;]</span>
<span class="sd">        locations: str, Path, gpd.GeoDataFrame, optional</span>
<span class="sd">            Path, data source name, or geopandas data object for point location dataset.</span>
<span class="sd">            Not required if point location have previously been set, e.g. using the</span>
<span class="sd">            :py:meth:`~hydromt_sfincs.SfincsModel.setup_river_inflow` method.</span>

<span class="sd">            * Required variables: [&#39;uparea&#39; (km2)]</span>
<span class="sd">        uparea: str, Path, optional</span>
<span class="sd">            Path, data source name, or xarray data object for upstream area grid.</span>

<span class="sd">            * Required variables: [&#39;uparea&#39; (km2)]</span>
<span class="sd">        wdw: int, optional</span>
<span class="sd">            Window size in number of cells around discharge boundary locations</span>
<span class="sd">            to snap to, only used if ``uparea`` is provided. By default 1.</span>
<span class="sd">        rel_error, abs_error: float, optional</span>
<span class="sd">            Maximum relative error (default 0.05) and absolute error (default 50 km2)</span>
<span class="sd">            between the discharge boundary location upstream area and the upstream area of</span>
<span class="sd">            the best fit grid cell, only used if &quot;discharge&quot; geoms has a &quot;uparea&quot; column.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        hydromt_sfincs.SfincsModel.setup_river_inflow</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">locations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                <span class="n">locations</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">assert_gtype</span><span class="o">=</span><span class="s2">&quot;Point&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;dis&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="s2">&quot;dis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No discharge boundary (src) points provided.&quot;</span><span class="p">)</span>

        <span class="c1"># read data</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">discharge</span><span class="p">,</span>
            <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="n">buffer</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">time_tuple</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">(),</span>  <span class="c1"># model time</span>
            <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;discharge&quot;</span><span class="p">],</span>
            <span class="n">single_var_as_array</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">uparea</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;uparea&quot;</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">da_upa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                <span class="n">uparea</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># make sure ds and da_upa align</span>
            <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_upa</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reproject_like</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;uparea&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No &quot;uparea&quot; column found in location data.&#39;</span><span class="p">)</span>

        <span class="c1"># TODO use hydromt core method</span>
        <span class="n">ds_snapped</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">snap_discharge</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span>
            <span class="n">gdf</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span>
            <span class="n">wdw</span><span class="o">=</span><span class="n">wdw</span><span class="p">,</span>
            <span class="n">rel_error</span><span class="o">=</span><span class="n">rel_error</span><span class="p">,</span>
            <span class="n">abs_error</span><span class="o">=</span><span class="n">abs_error</span><span class="p">,</span>
            <span class="n">uparea_name</span><span class="o">=</span><span class="s2">&quot;uparea&quot;</span><span class="p">,</span>
            <span class="n">discharge_name</span><span class="o">=</span><span class="s2">&quot;discharge&quot;</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># set zeros for src points without matching discharge</span>
        <span class="n">da_q</span> <span class="o">=</span> <span class="n">ds_snapped</span><span class="p">[</span><span class="s2">&quot;discharge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">df_q</span> <span class="o">=</span> <span class="n">da_q</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
        <span class="c1"># update forcing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">df_ts</span><span class="o">=</span><span class="n">df_q</span><span class="p">,</span> <span class="n">gdf_locs</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dis&quot;</span><span class="p">)</span>
        <span class="c1"># keep snapped locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_geoms</span><span class="p">(</span><span class="n">ds_snapped</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">(),</span> <span class="s2">&quot;src_snapped&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_precip_forcing_from_grid"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_precip_forcing_from_grid.html#hydromt_sfincs.SfincsModel.setup_precip_forcing_from_grid">[docs]</a>    <span class="k">def</span> <span class="nf">setup_precip_forcing_from_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">precip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dst_res</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup precipitation forcing from a gridded spatially varying data source.</span>

<span class="sd">        If aggregate is True, spatially uniform precipitation forcing is added to</span>
<span class="sd">        the model based on the mean precipitation over the model domain.</span>
<span class="sd">        If aggregate is False, distributed precipitation is added to the model as netcdf file.</span>
<span class="sd">        The data is reprojected to the model CRS (and destination resolution `dst_res` if provided).</span>

<span class="sd">        Adds one of these model layer:</span>

<span class="sd">        * **netamprfile** forcing: distributed precipitation [mm/hr]</span>
<span class="sd">        * **precipfile** forcing: uniform precipitation [mm/hr]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        precip, str, Path</span>
<span class="sd">            Path to precipitation rasterdataset netcdf file.</span>

<span class="sd">            * Required variables: [&#39;precip&#39; (mm)]</span>
<span class="sd">            * Required coordinates: [&#39;time&#39;, &#39;y&#39;, &#39;x&#39;]</span>

<span class="sd">        dst_res: float</span>
<span class="sd">            output resolution (m), by default None and computed from source data.</span>
<span class="sd">            Only used in combination with aggregate=False</span>
<span class="sd">        aggregate: bool, {&#39;mean&#39;, &#39;median&#39;}, optional</span>
<span class="sd">            Method to aggregate distributed input precipitation data. If True, mean</span>
<span class="sd">            aggregation is used, if False (default) the data is not aggregated and</span>
<span class="sd">            spatially distributed precipitation is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get data for model domain and config time range</span>
        <span class="n">precip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">precip</span><span class="p">,</span>
            <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="n">buffer</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">time_tuple</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">(),</span>
            <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;precip&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># aggregate or reproject in space</span>
        <span class="k">if</span> <span class="n">aggregate</span><span class="p">:</span>
            <span class="n">stat</span> <span class="o">=</span> <span class="n">aggregate</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aggregate</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;mean&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Aggregate precip using </span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">zone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>  <span class="c1"># make sure we have a single (multi)polygon</span>
            <span class="n">precip_out</span> <span class="o">=</span> <span class="n">precip</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">zonal_stats</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stat</span><span class="p">)[</span><span class="sa">f</span><span class="s2">&quot;precip_</span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">df_ts</span> <span class="o">=</span> <span class="n">precip_out</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">precip_out</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_precip_forcing</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">to_frame</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># reproject to model utm crs</span>
            <span class="c1"># NOTE: currently SFINCS errors (stack overflow) on large files,</span>
            <span class="c1"># downscaling to model grid is not recommended</span>
            <span class="n">kwargs0</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="n">dst_res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest_index&quot;</span><span class="p">)</span>
            <span class="n">kwargs0</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">meth</span> <span class="o">=</span> <span class="n">kwargs0</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resample precip using </span><span class="si">{</span><span class="n">meth</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">precip_out</span> <span class="o">=</span> <span class="n">precip</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span>
                <span class="n">dst_crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">dst_res</span><span class="o">=</span><span class="n">dst_res</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># resample in time</span>
            <span class="n">precip_out</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">resample_time</span><span class="p">(</span>
                <span class="n">precip_out</span><span class="p">,</span>
                <span class="n">freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="s2">&quot;1H&quot;</span><span class="p">),</span>
                <span class="n">conserve_mass</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">upsampling</span><span class="o">=</span><span class="s2">&quot;bfill&quot;</span><span class="p">,</span>
                <span class="n">downsampling</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;precip&quot;</span><span class="p">)</span>

            <span class="c1"># add to forcing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">precip_out</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;precip&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_precip_forcing"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_precip_forcing.html#hydromt_sfincs.SfincsModel.setup_precip_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">setup_precip_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeseries</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup spatially uniform precipitation forcing (precip).</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **precipfile** forcing: uniform precipitation [mm/hr]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        timeseries, str, Path</span>
<span class="sd">            Path to tabulated timeseries csv file with time index in first column</span>
<span class="sd">            and location IDs in the first row,</span>
<span class="sd">            see :py:meth:`hydromt.open_timeseries_from_table`, for details.</span>
<span class="sd">            Note: tabulated timeseries files cannot yet be set through the data_catalog yml file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">()</span>
        <span class="n">df_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">(</span>
            <span class="n">timeseries</span><span class="p">,</span>
            <span class="n">time_tuple</span><span class="o">=</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">),</span>
            <span class="c1"># kwargs below only applied if timeseries not in data catalog</span>
            <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_ts</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">df_ts</span> <span class="o">=</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_ts</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;df_ts must be a pandas.Series&quot;</span><span class="p">)</span>
        <span class="n">df_ts</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;precip&quot;</span>
        <span class="n">df_ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;precip&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="SfincsModel.setup_tiles"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.setup_tiles.html#hydromt_sfincs.SfincsModel.setup_tiles">[docs]</a>    <span class="k">def</span> <span class="nf">setup_tiles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">region</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">datasets_dep</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">zoom_range</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
        <span class="n">z_range</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">20000.0</span><span class="p">,</span> <span class="mf">20000.0</span><span class="p">],</span>
        <span class="n">create_index_tiles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">create_topobathy_tiles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create both index and topobathy tiles in webmercator format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : Union[str, Path]</span>
<span class="sd">            Directory in which to store the index tiles, if None, the model root + tiles is used.</span>
<span class="sd">        region : dict</span>
<span class="sd">            Dictionary describing region of interest, e.g.:</span>
<span class="sd">            * {&#39;bbox&#39;: [xmin, ymin, xmax, ymax]}. Note bbox should be provided in WGS 84</span>
<span class="sd">            * {&#39;geom&#39;: &#39;path/to/polygon_geometry&#39;}</span>
<span class="sd">            If None, the model region is used.</span>
<span class="sd">        datasets_dep : List[dict]</span>
<span class="sd">            List of dictionaries with topobathy data, each containing a dataset name or Path (elevtn) and optional merge arguments e.g.:</span>
<span class="sd">            [{&#39;elevtn&#39;: merit_hydro, &#39;zmin&#39;: 0.01}, {&#39;elevtn&#39;: gebco, &#39;offset&#39;: 0, &#39;merge_method&#39;: &#39;first&#39;, reproj_method: &#39;bilinear&#39;}]</span>
<span class="sd">            For a complete overview of all merge options, see :py:function:~hydromt.workflows.merge_multi_dataarrays</span>
<span class="sd">            Note that subgrid/dep_subgrid.tif is automatically used if present and datasets_dep is left empty.</span>
<span class="sd">        zoom_range : Union[int, List[int]], optional</span>
<span class="sd">            Range of zoom levels for which tiles are created, by default [0,13]</span>
<span class="sd">        z_range : List[int], optional</span>
<span class="sd">            Range of valid elevations that are included in the topobathy tiles, by default [-20000.0, 20000.0]</span>
<span class="sd">        create_index_tiles : bool, optional</span>
<span class="sd">            If True, index tiles are created, by default True</span>
<span class="sd">        create_topobathy_tiles : bool, optional</span>
<span class="sd">            If True, topobathy tiles are created, by default True. </span>
<span class="sd">        fmt : str, optional</span>
<span class="sd">            Format of the tiles: &quot;bin&quot; (binary, default), or &quot;png&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># use model root if path not provided</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;tiles&quot;</span><span class="p">)</span>

        <span class="c1"># use model region if region not provided</span>
        <span class="k">if</span> <span class="n">region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_kind</span><span class="p">,</span> <span class="n">_region</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">parse_region</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;bbox&quot;</span> <span class="ow">in</span> <span class="n">_region</span><span class="p">:</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">_region</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span>
                <span class="n">region</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">bbox</span><span class="p">)],</span> <span class="n">crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;geom&quot;</span> <span class="ow">in</span> <span class="n">_region</span><span class="p">:</span>
                <span class="n">region</span> <span class="o">=</span> <span class="n">_region</span><span class="p">[</span><span class="s2">&quot;geom&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">region</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Model region &quot;geom&quot; has no CRS&#39;</span><span class="p">)</span>

        <span class="c1"># if only one zoom level is specified, create tiles up to that zoom level (inclusive)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">zoom_range</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">zoom_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">zoom_range</span><span class="p">]</span>

        <span class="c1"># create index tiles</span>
        <span class="k">if</span> <span class="n">create_index_tiles</span><span class="p">:</span>
            <span class="c1"># only binary and png are supported for index tiles so set to binary if tif</span>
            <span class="n">fmt_ind</span> <span class="o">=</span> <span class="s2">&quot;bin&quot;</span> <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;tif&quot;</span> <span class="k">else</span> <span class="n">fmt</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;regular&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">create_index_tiles</span><span class="p">(</span>
                    <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">zoom_range</span><span class="o">=</span><span class="n">zoom_range</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt_ind</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;quadtree&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;Index tiles not yet implemented for quadtree grids.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># create topobathy tiles</span>
        <span class="k">if</span> <span class="n">create_topobathy_tiles</span><span class="p">:</span>
            <span class="c1"># compute resolution of highest zoom level</span>
            <span class="c1"># resolution of zoom level 0  on equator: 156543.03392804097</span>
            <span class="n">res</span> <span class="o">=</span> <span class="mf">156543.03392804097</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">zoom_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">datasets_dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_datasets_dep</span><span class="p">(</span><span class="n">datasets_dep</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>

            <span class="c1"># if no datasets provided, check if high-res subgrid geotiff is there</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasets_dep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;subgrid&quot;</span><span class="p">)):</span>
                    <span class="c1"># check if there is a dep_subgrid.tif</span>
                    <span class="n">dep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;subgrid&quot;</span><span class="p">,</span> <span class="s2">&quot;dep_subgrid.tif&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dep</span><span class="p">):</span>
                        <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>
                        <span class="n">datasets_dep</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;da&quot;</span><span class="p">:</span> <span class="n">da</span><span class="p">})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No topobathy datasets provided.&quot;</span><span class="p">)</span>

            <span class="c1"># create topobathy tiles</span>
            <span class="n">workflows</span><span class="o">.</span><span class="n">tiling</span><span class="o">.</span><span class="n">create_topobathy_tiles</span><span class="p">(</span>
                <span class="n">root</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
                <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
                <span class="n">datasets_dep</span><span class="o">=</span><span class="n">datasets_dep</span><span class="p">,</span>
                <span class="n">index_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">),</span>
                <span class="n">zoom_range</span><span class="o">=</span><span class="n">zoom_range</span><span class="p">,</span>
                <span class="n">z_range</span><span class="o">=</span><span class="n">z_range</span><span class="p">,</span>
                <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span>
            <span class="p">)</span></div>

    <span class="c1"># Plotting</span>
<div class="viewcode-block" id="SfincsModel.plot_forcing"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.plot_forcing.html#hydromt_sfincs.SfincsModel.plot_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">plot_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot model timeseries forcing.</span>

<span class="sd">        For distributed forcing a spatial avarage is plotted.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fn_out: str</span>
<span class="sd">            Path to output figure file.</span>
<span class="sd">            If a basename is given it is saved to &lt;model_root&gt;/figs/&lt;fn_out&gt;</span>
<span class="sd">            If None, no file is saved.</span>
<span class="sd">        forcing : Dict of xr.DataArray</span>
<span class="sd">            Model forcing</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, axes</span>
<span class="sd">            Model fig and ax objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="n">forcing</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                    <span class="k">continue</span>  <span class="c1"># plot only dataarrays</span>
                <span class="n">forcing</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="c1"># update missing attributes for plot labels</span>
                <span class="n">forcing</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">forcing</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">plot_forcing</span><span class="p">(</span><span class="n">forcing</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="c1"># set xlim to model tstart - tend</span>
                <span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">()</span>
                <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">([</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">]))</span>

                <span class="c1"># save figure</span>
                <span class="k">if</span> <span class="n">fn_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">fn_out</span><span class="p">):</span>
                        <span class="n">fn_out</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;figs&quot;</span><span class="p">,</span> <span class="n">fn_out</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">)):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">))</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn_out</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">225</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No forcing found in model.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.plot_basemap"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.plot_basemap.html#hydromt_sfincs.SfincsModel.plot_basemap">[docs]</a>    <span class="k">def</span> <span class="nf">plot_basemap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fn_out</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dep&quot;</span><span class="p">,</span>
        <span class="n">shaded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">plot_bounds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">plot_region</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">plot_geoms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">bmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zoomlevel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">geom_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">geom_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create basemap plot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fn_out: str, optional</span>
<span class="sd">            Path to output figure file, by default None.</span>
<span class="sd">            If a basename is given it is saved to &lt;model_root&gt;/figs/&lt;fn_out&gt;</span>
<span class="sd">            If None, no file is saved.</span>
<span class="sd">        variable : str, optional</span>
<span class="sd">            Map of variable in ds to plot, by default &#39;dep&#39;</span>
<span class="sd">        shaded : bool, optional</span>
<span class="sd">            Add shade to variable (only for variable = &#39;dep&#39; and non-rotated grids),</span>
<span class="sd">            by default False</span>
<span class="sd">        plot_bounds : bool, optional</span>
<span class="sd">            Add waterlevel (msk=2) and open (msk=3) boundary conditions to plot.</span>
<span class="sd">        plot_region : bool, optional</span>
<span class="sd">            If True, plot region outline.</span>
<span class="sd">        plot_geoms : bool, optional</span>
<span class="sd">            If True, plot available geoms.</span>
<span class="sd">        bmap : {&#39;sat&#39;, &#39;osm&#39;}, optional</span>
<span class="sd">            background map, by default None</span>
<span class="sd">        zoomlevel : int, optional</span>
<span class="sd">            zoomlevel, by default 11</span>
<span class="sd">        figsize : Tuple[int], optional</span>
<span class="sd">            figure size, by default None</span>
<span class="sd">        geom_names : List[str], optional</span>
<span class="sd">            list of model geometries to plot, by default all model geometries.</span>
<span class="sd">        geom_kwargs : Dict of Dict, optional</span>
<span class="sd">            Model geometry styling per geometry, passed to geopandas.GeoDataFrame.plot method.</span>
<span class="sd">            For instance: {&#39;src&#39;: {&#39;markersize&#39;: 30}}.</span>
<span class="sd">        legend_kwargs : Dict, optional</span>
<span class="sd">            Legend kwargs, passed to ax.legend method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, axes</span>
<span class="sd">            Model fig and ax objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="c1"># combine geoms and forcing locations</span>
        <span class="n">sg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">gname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_1D</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span> <span class="ow">and</span> <span class="n">gname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">sg</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">gname</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="p">[</span><span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()})</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unable to plot forcing location: &quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_region</span> <span class="ow">and</span> <span class="s2">&quot;region&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">sg</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">})</span>

        <span class="c1"># make sure grid are set</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;subgrid.&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">subgrid</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subgrid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;subgrid.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;msk&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;msk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">plot_basemap</span><span class="p">(</span>
            <span class="n">ds</span><span class="p">,</span>
            <span class="n">sg</span><span class="p">,</span>
            <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
            <span class="n">shaded</span><span class="o">=</span><span class="n">shaded</span><span class="p">,</span>
            <span class="n">plot_bounds</span><span class="o">=</span><span class="n">plot_bounds</span><span class="p">,</span>
            <span class="n">plot_region</span><span class="o">=</span><span class="n">plot_region</span><span class="p">,</span>
            <span class="n">plot_geoms</span><span class="o">=</span><span class="n">plot_geoms</span><span class="p">,</span>
            <span class="n">bmap</span><span class="o">=</span><span class="n">bmap</span><span class="p">,</span>
            <span class="n">zoomlevel</span><span class="o">=</span><span class="n">zoomlevel</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
            <span class="n">geom_names</span><span class="o">=</span><span class="n">geom_names</span><span class="p">,</span>
            <span class="n">geom_kwargs</span><span class="o">=</span><span class="n">geom_kwargs</span><span class="p">,</span>
            <span class="n">legend_kwargs</span><span class="o">=</span><span class="n">legend_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">fn_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">fn_out</span><span class="p">):</span>
                <span class="n">fn_out</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;figs&quot;</span><span class="p">,</span> <span class="n">fn_out</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn_out</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">225</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

    <span class="c1"># I/O</span>
<div class="viewcode-block" id="SfincsModel.read"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.read.html#hydromt_sfincs.SfincsModel.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read the complete model schematization and configuration from file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_config</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="n">epsg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">epsg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;epsg&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please specify epsg to read this model&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_grid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_subgrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_geoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_forcing</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Model read&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.write.html#hydromt_sfincs.SfincsModel.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the complete model schematization and configuration to file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing model data to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># TODO - add check for subgrid &amp; quadtree &gt; give flags to self.write_grid() and self.write_config()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_grid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_subgrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_geoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_forcing</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_states</span><span class="p">()</span>
        <span class="c1"># config last; might be udpated when writing maps, states or forcing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_config</span><span class="p">()</span></div>
        <span class="c1"># write data catalog with used data sources</span>
        <span class="c1"># self.write_data_catalog()  # new in hydromt v0.4.4</span>

<div class="viewcode-block" id="SfincsModel.read_grid"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.read_grid.html#hydromt_sfincs.SfincsModel.read_grid">[docs]</a>    <span class="k">def</span> <span class="nf">read_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read SFINCS binary grid files and save to `grid` attribute.</span>
<span class="sd">        Filenames are taken from the `config` attribute (i.e. input file).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_vars : Union[List, str], optional</span>
<span class="sd">            List of data variables to read, by default None (all)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">da_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">data_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_vars</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">data_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_vars</span><span class="p">)</span>

        <span class="c1"># read index file</span>
        <span class="n">ind_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;indexfile&quot;</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="s2">&quot;sfincs.ind&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">ind_fn</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.ind path </span><span class="si">{</span><span class="n">ind_fn</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;msk&quot;</span><span class="p">:</span> <span class="s2">&quot;u1&quot;</span><span class="p">}</span>
        <span class="n">mvs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;msk&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">read_ind</span><span class="p">(</span><span class="n">ind_fn</span><span class="o">=</span><span class="n">ind_fn</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_vars</span><span class="p">:</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                    <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">file not found at </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;f4&quot;</span><span class="p">)</span>
                    <span class="n">mv</span> <span class="o">=</span> <span class="n">mvs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">-</span><span class="mf">9999.0</span><span class="p">)</span>
                    <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">read_map</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">da_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">da_lst</span><span class="p">)</span>
            <span class="n">epsg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;epsg&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">epsg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">epsg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

            <span class="c1"># keep some metadata maps from gis directory</span>
            <span class="n">fns</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">,</span> <span class="s2">&quot;*.tif&quot;</span><span class="p">))</span>
            <span class="n">fns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">fn</span>
                <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">fns</span>
                <span class="k">if</span> <span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">data_vars</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">fns</span><span class="p">:</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">open_mfraster</span><span class="p">(</span><span class="n">fns</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_grid</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="SfincsModel.write_grid"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.write_grid.html#hydromt_sfincs.SfincsModel.write_grid">[docs]</a>    <span class="k">def</span> <span class="nf">write_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write SFINCS grid to binary files including map index file.</span>
<span class="sd">        Filenames are taken from the `config` attribute (i.e. input file).</span>

<span class="sd">        If `write_gis` property is True, all grid variables are written to geotiff</span>
<span class="sd">        files in a &quot;gis&quot; subfolder.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_vars : Union[List, str], optional</span>
<span class="sd">            List of data variables to write, by default None (all)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_write_mode</span>

        <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;msk&quot;</span><span class="p">:</span> <span class="s2">&quot;u1&quot;</span><span class="p">}</span>  <span class="c1"># default to f4</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grid</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;msk&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="c1"># make sure orientation is S-&gt;N</span>
            <span class="n">ds_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span>
            <span class="k">if</span> <span class="n">ds_out</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ds_out</span> <span class="o">=</span> <span class="n">ds_out</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">flipud</span><span class="p">()</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">ds_out</span><span class="p">[</span><span class="s2">&quot;msk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Write binary map indices based on mask.&quot;</span><span class="p">)</span>
            <span class="n">ind_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;indexfile&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">write_ind</span><span class="p">(</span><span class="n">ind_fn</span><span class="o">=</span><span class="n">ind_fn</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">data_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># write all maps</span>
                <span class="n">data_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds_out</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_vars</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">data_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_vars</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write binary map files: </span><span class="si">{</span><span class="n">data_vars</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_vars</span><span class="p">:</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># do not write depfile if subgrid is used</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;dep&quot;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;manning&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">subgrid</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">write_map</span><span class="p">(</span>
                    <span class="n">map_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">ds_out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;f4&quot;</span><span class="p">),</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_raster</span><span class="p">(</span><span class="s2">&quot;grid&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.read_subgrid"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.read_subgrid.html#hydromt_sfincs.SfincsModel.read_subgrid">[docs]</a>    <span class="k">def</span> <span class="nf">read_subgrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read SFINCS subgrid file and add to `subgrid` attribute.</span>
<span class="sd">        Filename is taken from the `config` attribute (i.e. input file).&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_read_mode</span>

        <span class="k">if</span> <span class="s2">&quot;sbgfile&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;sbgfile&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sbgfile not found at </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">subgrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subgrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">subgrid</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">(</span>
                <span class="n">dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">coords</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write_subgrid"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.write_subgrid.html#hydromt_sfincs.SfincsModel.write_subgrid">[docs]</a>    <span class="k">def</span> <span class="nf">write_subgrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write SFINCS subgrid file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_write_mode</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subgrid</span><span class="p">:</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;sbgfile&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sbgfile&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.sbg&quot;</span><span class="p">)</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sbgfile&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span><span class="o">.</span><span class="n">subgrid</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.read_geoms"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.read_geoms.html#hydromt_sfincs.SfincsModel.read_geoms">[docs]</a>    <span class="k">def</span> <span class="nf">read_geoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read geometry files and save to `geoms` attribute.</span>
<span class="sd">        Known geometry files mentioned in the sfincs.inp configuration file are read,</span>
<span class="sd">        including: bnd/src/obs xy files and thd/weir structure files.</span>

<span class="sd">        If other geojson files are present in a &quot;gis&quot; subfolder folder, those are read as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_read_mode</span>
        <span class="c1"># read _GEOMS model files</span>
        <span class="k">for</span> <span class="n">gname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file not found at </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">gname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;thd&quot;</span><span class="p">,</span> <span class="s2">&quot;weir&quot;</span><span class="p">]:</span>
                    <span class="n">struct</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_geoms</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">linestring2gdf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">gname</span> <span class="o">==</span> <span class="s2">&quot;obs&quot;</span><span class="p">:</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_xyn</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_xy</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_geoms</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">gname</span><span class="p">)</span>
        <span class="c1"># read additional geojson files from gis directory</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">,</span> <span class="s2">&quot;*.geojson&quot;</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.geojson&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">gnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_1D</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">skip</span> <span class="o">=</span> <span class="n">gnames</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">open_vector</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_geoms</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write_geoms"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.write_geoms.html#hydromt_sfincs.SfincsModel.write_geoms">[docs]</a>    <span class="k">def</span> <span class="nf">write_geoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write geoms to bnd/src/obs xy files and thd/weir structure files.</span>
<span class="sd">        Filenames are based on the `config` attribute.</span>

<span class="sd">        If `write_gis` property is True, all geoms are written to geojson</span>
<span class="sd">        files in a &quot;gis&quot; subfolder.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_vars : list of str, optional</span>
<span class="sd">            List of data variables to write, by default None (all)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_write_mode</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">dvars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">data_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dvars</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_vars</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Write geom files&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">gname</span><span class="p">,</span> <span class="n">gdf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">gname</span> <span class="ow">in</span> <span class="n">dvars</span><span class="p">:</span>
                    <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">gname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;thd&quot;</span><span class="p">,</span> <span class="s2">&quot;weir&quot;</span><span class="p">]:</span>
                        <span class="n">struct</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gdf2linestring</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
                        <span class="n">utils</span><span class="o">.</span><span class="n">write_geoms</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">struct</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="n">gname</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">gname</span> <span class="o">==</span> <span class="s2">&quot;obs&quot;</span><span class="p">:</span>
                        <span class="n">utils</span><span class="o">.</span><span class="n">write_xyn</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">utils</span><span class="o">.</span><span class="n">write_xy</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%8.2f</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># NOTE: all geoms are written to geojson files in a &quot;gis&quot; subfolder</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_vector</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geoms&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="SfincsModel.read_forcing"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.read_forcing.html#hydromt_sfincs.SfincsModel.read_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">read_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_vars</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read forcing files and save to `forcing` attribute.</span>
<span class="sd">        Known forcing files mentioned in the sfincs.inp configuration file are read,</span>
<span class="sd">        including: bzs/dis/precip ascii files and the netampr netcdf file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_vars : list of str, optional</span>
<span class="sd">            List of data variables to read, by default None (all)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_read_mode</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_vars</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">data_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_vars</span><span class="p">)</span>

        <span class="c1"># 1D</span>
        <span class="n">dvars_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_1D</span>
        <span class="k">if</span> <span class="n">data_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dvars_1d</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_vars</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dvars_1d</span><span class="p">]</span>
        <span class="n">tref</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tref&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dvars_1d</span><span class="p">:</span>
            <span class="n">ts_names</span><span class="p">,</span> <span class="n">xy_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_1D</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># read time series</span>
            <span class="n">da_lst</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ts_name</span> <span class="ow">in</span> <span class="n">ts_names</span><span class="p">:</span>
                <span class="n">ts_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ts_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ts_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">ts_fn</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ts_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ts_name</span><span class="si">}</span><span class="s2">file not found at </span><span class="si">{</span><span class="n">ts_fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_timeseries</span><span class="p">(</span><span class="n">ts_fn</span><span class="p">,</span> <span class="n">tref</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
                <span class="k">if</span> <span class="n">xy_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
                    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">ts_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># spatially uniform forcing</span>
                    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">ts_name</span><span class="p">)</span>
                <span class="n">da_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">da_lst</span><span class="p">[:])</span>
            <span class="c1"># read xy</span>
            <span class="k">if</span> <span class="n">xy_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xy_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xy_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xy_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">xy_fn</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">xy_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xy_name</span><span class="si">}</span><span class="s2">file not found at </span><span class="si">{</span><span class="n">xy_fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_xy</span><span class="p">(</span><span class="n">xy_fn</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
                    <span class="c1"># read attribute data from gis files</span>
                    <span class="n">gis_fn</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xy_name</span><span class="si">}</span><span class="s2">.geojson&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">gis_fn</span><span class="p">):</span>
                        <span class="n">gdf1</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gis_fn</span><span class="p">)</span>
                        <span class="k">if</span> <span class="s2">&quot;index&quot;</span> <span class="ow">in</span> <span class="n">gdf1</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">gdf1</span> <span class="o">=</span> <span class="n">gdf1</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
                            <span class="n">gdf</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">gdf1</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                            <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">gdf1</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">gdf1</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span><span class="p">):</span>
                            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">gdf1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)[</span><span class="n">gdf1</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                    <span class="c1"># set locations as coordinates dataset</span>
                    <span class="n">ds</span> <span class="o">=</span> <span class="n">GeoDataset</span><span class="o">.</span><span class="n">from_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">index_dim</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="c1"># save in self.forcing</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># keep wave forcing together</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">split_dataset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">split_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># 2D NETCDF format</span>
        <span class="n">dvars_2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_NET</span>
        <span class="k">if</span> <span class="n">data_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dvars_2d</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_vars</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dvars_2d</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dvars_2d</span><span class="p">:</span>
            <span class="n">fname</span><span class="p">,</span> <span class="n">rename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_NET</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">file not found at </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;netbndbzsbzi&quot;</span><span class="p">,</span> <span class="s2">&quot;netsrcdis&quot;</span><span class="p">]:</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="n">GeoDataset</span><span class="o">.</span><span class="n">from_netcdf</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
            <span class="n">rename</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rename</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rename</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">rename</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="nb">list</span><span class="p">(</span><span class="n">rename</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">split_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No forcing variables found in </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write_forcing"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.write_forcing.html#hydromt_sfincs.SfincsModel.write_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">write_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write forcing to ascii or netcdf (netampr) files.</span>
<span class="sd">        Filenames are based on the `config` attribute.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_vars : list of str, optional</span>
<span class="sd">            List of data variables to write, by default None (all)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_write_mode</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Write forcing files&quot;</span><span class="p">)</span>

            <span class="n">tref</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tref&quot;</span><span class="p">])</span>
            <span class="c1"># for nc files -&gt; time in minutes since tref</span>
            <span class="n">tref_str</span> <span class="o">=</span> <span class="n">tref</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

            <span class="c1"># 1D timeseries + location text files</span>
            <span class="n">dvars_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_1D</span>
            <span class="k">if</span> <span class="n">data_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dvars_1d</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_vars</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_1D</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dvars_1d</span><span class="p">:</span>
                <span class="n">ts_names</span><span class="p">,</span> <span class="n">xy_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_1D</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_NET</span>
                    <span class="ow">and</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_NET</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
                <span class="p">):</span>
                    <span class="k">continue</span>  <span class="c1"># write NC file instead of text files</span>
                <span class="c1"># work with wavespectra dataset and bzs/dis dataarray</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                    <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span>  <span class="c1"># dict</span>
                <span class="c1"># write timeseries</span>
                <span class="n">da</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">ts_name</span> <span class="ow">in</span> <span class="n">ts_names</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ts_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span> <span class="ow">or</span> <span class="n">ds</span><span class="p">[</span><span class="n">ts_name</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="c1"># parse data to dataframe</span>
                    <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">ts_name</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
                    <span class="c1"># get filenames from config</span>
                    <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ts_name</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ts_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">ts_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ts_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1"># write timeseries</span>
                    <span class="n">utils</span><span class="o">.</span><span class="n">write_timeseries</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">tref</span><span class="p">)</span>
                <span class="c1"># write xy</span>
                <span class="k">if</span> <span class="n">xy_name</span> <span class="ow">and</span> <span class="n">da</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># parse data to geodataframe</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">gdf</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Locations missing for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing&quot;</span><span class="p">)</span>
                    <span class="c1"># get filenames from config</span>
                    <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xy_name</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xy_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">xy_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fn_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xy_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1"># write xy</span>
                    <span class="n">utils</span><span class="o">.</span><span class="n">write_xy</span><span class="p">(</span><span class="n">fn_xy</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%8.2f</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># write geojson file to gis folder</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write_vector</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;forcing.</span><span class="si">{</span><span class="n">ts_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># netcdf forcing</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">time</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;minutes since </span><span class="si">{</span><span class="n">tref_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="s2">&quot;float64&quot;</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">dvars_2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_NET</span>
            <span class="k">if</span> <span class="n">data_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dvars_2d</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_vars</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_NET</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dvars_2d</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_1D</span>
                    <span class="ow">and</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_1D</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
                <span class="p">):</span>
                    <span class="k">continue</span>  <span class="c1"># timeseries + xy file already written</span>
                <span class="n">fname</span><span class="p">,</span> <span class="n">rename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_NET</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="c1"># combine variables and rename to output names</span>
                <span class="n">rename</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rename</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">}</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rename</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rename</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">rename</span><span class="p">)</span>
                <span class="c1"># get filename from config</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">)</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># write 1D timeseries</span>
                <span class="k">if</span> <span class="n">fname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;netbndbzsbzi&quot;</span><span class="p">,</span> <span class="s2">&quot;netsrcdis&quot;</span><span class="p">]:</span>
                    <span class="n">ds</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_xy</span><span class="p">()</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
                    <span class="c1"># write geojson file to gis folder</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write_vector</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;forcing.</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">rename</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># write 2D gridded timeseries</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.read_states"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.read_states.html#hydromt_sfincs.SfincsModel.read_states">[docs]</a>    <span class="k">def</span> <span class="nf">read_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read waterlevel state (zsini) from ascii file and save to `states` attribute.</span>
<span class="sd">        The inifile if mentioned in the sfincs.inp configuration file is read.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        crs: int, CRS</span>
<span class="sd">            Coordinate reference system, if provided use instead of epsg code from sfincs.inp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_read_mode</span>
        <span class="k">if</span> <span class="s2">&quot;inifile&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;inifile&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;inifile not found at </span><span class="si">{fn}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">zsini</span> <span class="o">=</span> <span class="n">RasterDataArray</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">read_ascii_map</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span>  <span class="c1"># orientation S-N</span>
                <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
                <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                <span class="n">nodata</span><span class="o">=-</span><span class="mi">9999</span><span class="p">,</span>  <span class="c1"># TODO: check what a good nodatavalue is</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">zsini</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The shape of &quot;inifile&quot; and maps does not match.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;msk&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span><span class="p">:</span>
                <span class="n">zsini</span> <span class="o">=</span> <span class="n">zsini</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_states</span><span class="p">(</span><span class="n">zsini</span><span class="p">,</span> <span class="s2">&quot;zsini&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write_states"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.write_states.html#hydromt_sfincs.SfincsModel.write_states">[docs]</a>    <span class="k">def</span> <span class="nf">write_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%8.3f</span><span class="s2">&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write waterlevel state (zsini)  to ascii map file.</span>
<span class="sd">        The filenames is based on the `config` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_write_mode</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">:</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;inifile&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;inifile&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;inifile&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># TODO check proper nodata value</span>
            <span class="k">if</span> <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># orientation is S-&gt;N</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">flipud</span><span class="p">()</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">write_ascii_map</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_raster</span><span class="p">(</span><span class="s2">&quot;states&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.read_results"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.read_results.html#hydromt_sfincs.SfincsModel.read_results">[docs]</a>    <span class="k">def</span> <span class="nf">read_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">drop</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;crs&quot;</span><span class="p">,</span> <span class="s2">&quot;sfincsgrid&quot;</span><span class="p">],</span>
        <span class="n">fn_map</span><span class="o">=</span><span class="s2">&quot;sfincs_map.nc&quot;</span><span class="p">,</span>
        <span class="n">fn_his</span><span class="o">=</span><span class="s2">&quot;sfincs_his.nc&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read results from sfincs_map.nc and sfincs_his.nc and save to the `results` attribute.</span>
<span class="sd">        The staggered nc file format is translated into hydromt.RasterDataArray formats.</span>
<span class="sd">        Additionally, hmax is computed from zsmax and zb if present.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        chunksize: int, optional</span>
<span class="sd">            chunk size along time dimension, by default 100</span>
<span class="sd">        drop: list, optional</span>
<span class="sd">            list of variables to drop, by default [&quot;crs&quot;, &quot;sfincsgrid&quot;]</span>
<span class="sd">        fn_map: str, optional</span>
<span class="sd">            filename of sfincs_map.nc, by default &quot;sfincs_map.nc&quot;</span>
<span class="sd">        fn_his: str, optional</span>
<span class="sd">            filename of sfincs_his.nc, by default &quot;sfincs_his.nc&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isabs</span><span class="p">(</span><span class="n">fn_map</span><span class="p">):</span>
            <span class="n">fn_map</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">fn_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn_map</span><span class="p">):</span>
            <span class="n">ds_face</span><span class="p">,</span> <span class="n">ds_edge</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_sfincs_map_results</span><span class="p">(</span>
                <span class="n">fn_map</span><span class="p">,</span>
                <span class="n">ds_like</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span>  <span class="c1"># TODO: fix for quadtree</span>
                <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># save as dict of DataArray</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_results</span><span class="p">(</span><span class="n">ds_face</span><span class="p">,</span> <span class="n">split_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_results</span><span class="p">(</span><span class="n">ds_edge</span><span class="p">,</span> <span class="n">split_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isabs</span><span class="p">(</span><span class="n">fn_his</span><span class="p">):</span>
            <span class="n">fn_his</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">fn_his</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn_his</span><span class="p">):</span>
            <span class="n">ds_his</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_sfincs_his_results</span><span class="p">(</span>
                <span class="n">fn_his</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span>
            <span class="p">)</span>
            <span class="c1"># drop double vars (map files has priority)</span>
            <span class="n">drop_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds_his</span><span class="o">.</span><span class="n">data_vars</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="ow">or</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">drop</span><span class="p">]</span>
            <span class="n">ds_his</span> <span class="o">=</span> <span class="n">ds_his</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="n">drop_vars</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_results</span><span class="p">(</span><span class="n">ds_his</span><span class="p">,</span> <span class="n">split_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">write_raster</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="s2">&quot;results.hmax&quot;</span><span class="p">],</span>
        <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
        <span class="n">compress</span><span class="o">=</span><span class="s2">&quot;deflate&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write model 2D raster variables to geotiff files.</span>

<span class="sd">        NOTE: these files are not used by the model by just saved for visualization/</span>
<span class="sd">        analysis purposes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variables: str, list, optional</span>
<span class="sd">            Model variables are a combination of attribute and layer (optional) using &lt;attribute&gt;.&lt;layer&gt; syntax.</span>
<span class="sd">            Known ratster attributes are [&quot;grid&quot;, &quot;states&quot;, &quot;results&quot;].</span>
<span class="sd">            Different variables can be combined in a list.</span>
<span class="sd">            By default, variables is [&quot;grid&quot;, &quot;states&quot;, &quot;results.hmax&quot;]</span>
<span class="sd">        root: Path, str, optional</span>
<span class="sd">            The output folder path. If None it defaults to the &lt;model_root&gt;/gis folder (Default)</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Key-word arguments passed to hydromt.RasterDataset.to_raster(driver=&#39;GTiff&#39;, compress=&#39;lzw&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check variables</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">variables</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;variables&quot; should be a list, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="c1"># check root</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="c1"># save to file</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">vsplit</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">vsplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># empty</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write raster file(s) for </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> to &#39;gis&#39; subfolder&quot;</span><span class="p">)</span>
            <span class="n">layers</span> <span class="o">=</span> <span class="n">vsplit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vsplit</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">layer</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2"> not found: skipping.&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># try to reduce to 2D by taking maximum over time dimension</span>
                    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">da</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
                        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s2">&quot;timemax&quot;</span> <span class="ow">in</span> <span class="n">da</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
                        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s2">&quot;timemax&quot;</span><span class="p">)</span>
                    <span class="c1"># if still not 2D, skip</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2"> has more than 2 dimensions: skipping.&quot;</span>
                        <span class="p">)</span>
                        <span class="k">continue</span>
                <span class="c1"># only write active cells to gis files</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">clip_geom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># make sure orientation is N-&gt;S</span>
                    <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">flipud</span><span class="p">()</span>
                <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">to_raster</span><span class="p">(</span>
                    <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">),</span>
                    <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span>
                    <span class="n">compress</span><span class="o">=</span><span class="n">compress</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_vector</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geoms&quot;</span><span class="p">,</span> <span class="s2">&quot;forcing.bzs&quot;</span><span class="p">,</span> <span class="s2">&quot;forcing.dis&quot;</span><span class="p">],</span>
        <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">gdf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write model vector (geoms) variables to geojson files.</span>

<span class="sd">        NOTE: these files are not used by the model by just saved for visualization/</span>
<span class="sd">        analysis purposes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variables: str, list, optional</span>
<span class="sd">            geoms variables. By default all geoms are saved.</span>
<span class="sd">        root: Path, str, optional</span>
<span class="sd">            The output folder path. If None it defaults to the &lt;model_root&gt;/gis folder (Default)</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Key-word arguments passed to geopandas.GeoDataFrame.to_file(driver=&#39;GeoJSON&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>  <span class="c1"># fixed</span>
        <span class="c1"># check variables</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">variables</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;variables&quot; should be a list, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="c1"># check root</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="c1"># save to file</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">vsplit</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">vsplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># empty</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write vector file(s) for </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> to &#39;gis&#39; subfolder&quot;</span><span class="p">)</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">vsplit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vsplit</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found: skipping.&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">gdf</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
                        <span class="c1"># xy name -&gt; difficult!</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING_1D</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> could not be written to vector file.&quot;</span>
                        <span class="p">)</span>
                        <span class="k">pass</span>
                <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.geojson&quot;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1">## model configuration</span>

<div class="viewcode-block" id="SfincsModel.read_config"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.read_config.html#hydromt_sfincs.SfincsModel.read_config">[docs]</a>    <span class="k">def</span> <span class="nf">read_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sfincs.inp&quot;</span><span class="p">,</span> <span class="n">epsg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse config from SFINCS input file.</span>
<span class="sd">        If in write-only mode the config is initialized with default settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config_fn: str</span>
<span class="sd">            Filename of config file, by default &quot;sfincs.inp&quot;.</span>
<span class="sd">            If in a different folder than the model root, the root is updated.</span>
<span class="sd">        epsg: int</span>
<span class="sd">            EPSG code of the model CRS. Only used if missing in the SFINCS input file, by default None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">SfincsInput</span><span class="p">()</span>  <span class="c1"># initialize with defaults</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">:</span>  <span class="c1"># in read-only or append mode, try reading config_fn</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">config_fn</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isabs</span><span class="p">(</span><span class="n">config_fn</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="p">:</span>
                <span class="c1"># path relative to self.root</span>
                <span class="n">config_fn</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">config_fn</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">isfile</span><span class="p">(</span><span class="n">config_fn</span><span class="p">)</span> <span class="ow">and</span> <span class="n">abspath</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_fn</span><span class="p">))</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="p">:</span>
                <span class="c1"># new root</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;r+&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read</span>
                    <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span> <span class="k">else</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_fn</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;updating the model root to: </span><span class="si">{</span><span class="n">root</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_root</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SFINCS input file not found </span><span class="si">{</span><span class="n">config_fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># read config_fn</span>
            <span class="n">inp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">inp_fn</span><span class="o">=</span><span class="n">config_fn</span><span class="p">)</span>
        <span class="c1"># overwrite / initialize config attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">epsg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;epsg&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="n">epsg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_grid_from_config</span><span class="p">()</span>  <span class="c1"># update grid properties based on sfincs.inp</span></div>

<div class="viewcode-block" id="SfincsModel.write_config"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.write_config.html#hydromt_sfincs.SfincsModel.write_config">[docs]</a>    <span class="k">def</span> <span class="nf">write_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sfincs.inp&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write config to &lt;root/config_fn&gt;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_write_mode</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isabs</span><span class="p">(</span><span class="n">config_fn</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="p">:</span>
            <span class="n">config_fn</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">config_fn</span><span class="p">)</span>

        <span class="n">inp</span> <span class="o">=</span> <span class="n">SfincsInput</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
        <span class="n">inp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inp_fn</span><span class="o">=</span><span class="n">abspath</span><span class="p">(</span><span class="n">config_fn</span><span class="p">))</span></div>

<div class="viewcode-block" id="SfincsModel.update_spatial_attrs"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.update_spatial_attrs.html#hydromt_sfincs.SfincsModel.update_spatial_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">update_spatial_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update geospatial `config` (sfincs.inp) attributes based on grid&quot;&quot;&quot;</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>
        <span class="c1"># TODO check self.bounds with rotation!! origin not necessary equal to total_bounds</span>
        <span class="n">west</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;epsg&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;mmax&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;nmax&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">))</span>  <span class="c1"># dy is always positive (orientation is S -&gt; N)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;x0&quot;</span><span class="p">,</span> <span class="n">west</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;y0&quot;</span><span class="p">,</span> <span class="n">south</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.update_grid_from_config"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.update_grid_from_config.html#hydromt_sfincs.SfincsModel.update_grid_from_config">[docs]</a>    <span class="k">def</span> <span class="nf">update_grid_from_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update grid properties based on `config` (sfincs.inp) attributes&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;quadtree&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;qtrfile&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;regular&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s2">&quot;regular&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reggrid</span> <span class="o">=</span> <span class="n">RegularGrid</span><span class="p">(</span>
                <span class="n">x0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x0&quot;</span><span class="p">),</span>
                <span class="n">y0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y0&quot;</span><span class="p">),</span>
                <span class="n">dx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">),</span>
                <span class="n">dy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">),</span>
                <span class="n">nmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nmax&quot;</span><span class="p">),</span>
                <span class="n">mmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mmax&quot;</span><span class="p">),</span>
                <span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rotation&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">epsg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;epsg&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ow">not</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Quadtree grid not implemented yet&quot;</span><span class="p">)</span></div>
            <span class="c1"># self.quadtree = QuadtreeGrid()</span>

<div class="viewcode-block" id="SfincsModel.get_model_time"><a class="viewcode-back" href="../../_generated/hydromt_sfincs.SfincsModel.get_model_time.html#hydromt_sfincs.SfincsModel.get_model_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_model_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return (tstart, tstop) tuple with parsed model start and end time&quot;&quot;&quot;</span>
        <span class="n">tstart</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstart&quot;</span><span class="p">])</span>
        <span class="n">tstop</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span></div>

    <span class="c1">## helper method</span>

    <span class="k">def</span> <span class="nf">_parse_datasets_dep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datasets_dep</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse filenames or paths of Datasets in list of dictionaries datasets_dep into xr.DataArray and gdf.GeoDataFrames:</span>
<span class="sd">        * &quot;elevtn&quot; is parsed into da (xr.DataArray)</span>
<span class="sd">        * &quot;offset&quot; is parsed into da_offset (xr.DataArray)</span>
<span class="sd">        * &quot;mask&quot; is parsed into gdf (gpd.GeoDataFrame)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        datasets_dep : List[dict]</span>
<span class="sd">            List of dictionaries with topobathy data, each containing a dataset name or Path (dep) and optional merge arguments.</span>
<span class="sd">        res : float</span>
<span class="sd">            Resolution of the model grid in meters. Used to obtain the correct zoom level of the depth datasets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parse_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="s2">&quot;da&quot;</span><span class="p">]</span>
        <span class="n">copy_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;zmin&quot;</span><span class="p">,</span> <span class="s2">&quot;zmax&quot;</span><span class="p">,</span> <span class="s2">&quot;reproj_method&quot;</span><span class="p">,</span> <span class="s2">&quot;merge_method&quot;</span><span class="p">]</span>

        <span class="n">datasets_out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets_dep</span><span class="p">:</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># read in depth datasets; replace dep (source name; filename or xr.DataArray)</span>
            <span class="k">if</span> <span class="s2">&quot;elevtn&quot;</span> <span class="ow">in</span> <span class="n">dataset</span> <span class="ow">or</span> <span class="s2">&quot;da&quot;</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">da_elv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                        <span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;elevtn&quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;da&quot;</span><span class="p">)),</span>
                        <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">box</span><span class="p">,</span>
                        <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                        <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">],</span>
                        <span class="n">zoom_level</span><span class="o">=</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s2">&quot;meter&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="n">dd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;da&quot;</span><span class="p">:</span> <span class="n">da_elv</span><span class="p">})</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">data_name</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;elevtn&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_name</span><span class="si">}</span><span class="s2"> not used; probably because all the data is outside of the mask.&quot;</span><span class="p">)</span>
                    <span class="k">continue</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;No &#39;elevtn&#39; (topobathy) dataset provided in datasets_dep.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># read offset filenames</span>
            <span class="c1"># NOTE offsets can be xr.DataArrays and floats</span>
            <span class="k">if</span> <span class="s2">&quot;offset&quot;</span> <span class="ow">in</span> <span class="n">dataset</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;offset&quot;</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">da_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">),</span>
                    <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">box</span><span class="p">,</span>
                    <span class="n">buffer</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">dd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">da_offset</span><span class="p">})</span>

            <span class="c1"># read geodataframes describing valid areas</span>
            <span class="k">if</span> <span class="s2">&quot;mask&quot;</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
                <span class="n">gdf_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                    <span class="n">path_or_key</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">),</span>
                    <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">box</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">dd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;gdf_valid&quot;</span><span class="p">:</span> <span class="n">gdf_valid</span><span class="p">})</span>

            <span class="c1"># copy remaining keys</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">copy_keys</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
                    <span class="n">dd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copy_keys</span> <span class="o">+</span> <span class="n">parse_keys</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> in datasets_dep. Ignoring.&quot;</span><span class="p">)</span>
            <span class="n">datasets_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">datasets_out</span>

    <span class="k">def</span> <span class="nf">_parse_datasets_rgh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datasets_rgh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse filenames or paths of Datasets in list of dictionaries datasets_rgh into xr.DataArrays and gdf.GeoDataFrames:</span>
<span class="sd">        * &quot;manning&quot; is parsed into da (xr.DataArray)</span>
<span class="sd">        * &quot;lulc&quot; is parsed into da (xr.DataArray) using reclassify table in &quot;reclass_table&quot;</span>
<span class="sd">        * &quot;mask&quot; is parsed into gdf_valid (gpd.GeoDataFrame)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        datasets_rgh : List[dict], optional</span>
<span class="sd">            List of dictionaries with Manning&#39;s n datasets. Each dictionary should at least contain one of the following:</span>
<span class="sd">            * (1) manning: filename (or Path) of gridded data with manning values</span>
<span class="sd">            * (2) lulc (and reclass_table) :a combination of a filename of gridded landuse/landcover and a reclassify table.</span>
<span class="sd">            In additon, optional merge arguments can be provided e.g.: merge_method, mask</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parse_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;manning&quot;</span><span class="p">,</span> <span class="s2">&quot;lulc&quot;</span><span class="p">,</span> <span class="s2">&quot;reclass_table&quot;</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="s2">&quot;da&quot;</span><span class="p">]</span>
        <span class="n">copy_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;reproj_method&quot;</span><span class="p">,</span> <span class="s2">&quot;merge_method&quot;</span><span class="p">]</span>

        <span class="n">datasets_out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets_rgh</span><span class="p">:</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="s2">&quot;manning&quot;</span> <span class="ow">in</span> <span class="n">dataset</span> <span class="ow">or</span> <span class="s2">&quot;da&quot;</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
                <span class="n">da_man</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manning&quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;da&quot;</span><span class="p">)),</span>
                    <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">box</span><span class="p">,</span>
                    <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">dd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;da&quot;</span><span class="p">:</span> <span class="n">da_man</span><span class="p">})</span>
            <span class="k">elif</span> <span class="s2">&quot;lulc&quot;</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
                <span class="c1"># landuse/landcover should always be combined with mapping</span>
                <span class="n">lulc</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lulc&quot;</span><span class="p">)</span>
                <span class="n">reclass_table</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reclass_table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">reclass_table</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lulc</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">reclass_table</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">DATADIR</span><span class="p">,</span> <span class="s2">&quot;lulc&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lulc</span><span class="si">}</span><span class="s2">_mapping.csv&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">reclass_table</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lulc</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Manning roughness mapping file not found: </span><span class="si">{</span><span class="n">reclass_table</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="n">da_lulc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                    <span class="n">lulc</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">box</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lulc&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">df_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">(</span><span class="n">reclass_table</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># reclassify</span>
                <span class="n">da_man</span> <span class="o">=</span> <span class="n">da_lulc</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reclassify</span><span class="p">(</span><span class="n">df_map</span><span class="p">[[</span><span class="s2">&quot;N&quot;</span><span class="p">]])[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span>
                <span class="n">dd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;da&quot;</span><span class="p">:</span> <span class="n">da_man</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No &#39;manning&#39; dataset provided in datasets_rgh.&quot;</span><span class="p">)</span>

            <span class="c1"># read geodataframes describing valid areas</span>
            <span class="k">if</span> <span class="s2">&quot;mask&quot;</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
                <span class="n">gdf_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                    <span class="n">path_or_key</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">),</span>
                    <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">box</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">dd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;gdf_valid&quot;</span><span class="p">:</span> <span class="n">gdf_valid</span><span class="p">})</span>

            <span class="c1"># copy remaining keys</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">copy_keys</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
                    <span class="n">dd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copy_keys</span> <span class="o">+</span> <span class="n">parse_keys</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> in datasets_rgh. Ignoring.&quot;</span><span class="p">)</span>
            <span class="n">datasets_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">datasets_out</span></div>
</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
       Copyright Deltares.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>