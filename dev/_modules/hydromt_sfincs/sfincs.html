

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>hydromt_sfincs.sfincs &mdash; hydromt_sfincs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> hydromt_sfincs
          

          
          </a>

          
            
            
              <div class="version">
                0.2.1.dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/sfincs.html">SFINCS model: General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/sfincs_coastal.html">Setting up a coastal model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/sfincs_riverine.html">Setting up a riverine model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References &amp; Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/api_index.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Whatâ€™s new</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">hydromt_sfincs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>hydromt_sfincs.sfincs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for hydromt_sfincs.sfincs</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">basename</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">numpy.core.fromnumeric</span> <span class="kn">import</span> <span class="n">var</span>
<span class="kn">from</span> <span class="nn">rasterio.warp</span> <span class="kn">import</span> <span class="n">transform_bounds</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">box</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pyproj</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">hydromt</span>
<span class="kn">from</span> <span class="nn">hydromt.models.model_api</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">hydromt.vector</span> <span class="kn">import</span> <span class="n">GeoDataArray</span>
<span class="kn">from</span> <span class="nn">hydromt.raster</span> <span class="kn">import</span> <span class="n">RasterDataset</span><span class="p">,</span> <span class="n">RasterDataArray</span>
<span class="kn">from</span> <span class="nn">xarray.core</span> <span class="kn">import</span> <span class="n">variable</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">workflows</span><span class="p">,</span> <span class="n">utils</span><span class="p">,</span> <span class="n">plots</span><span class="p">,</span> <span class="n">DATADIR</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SfincsModel&quot;</span><span class="p">]</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="SfincsModel"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.html#hydromt_sfincs.SfincsModel">[docs]</a><span class="k">class</span> <span class="nc">SfincsModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_NAME</span> <span class="o">=</span> <span class="s2">&quot;sfincs&quot;</span>
    <span class="n">_GEOMS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;gauges&quot;</span><span class="p">:</span> <span class="s2">&quot;obs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;weirs&quot;</span><span class="p">:</span> <span class="s2">&quot;weir&quot;</span><span class="p">,</span>
        <span class="s2">&quot;thin_dams&quot;</span><span class="p">:</span> <span class="s2">&quot;thd&quot;</span><span class="p">,</span>
    <span class="p">}</span>  <span class="c1"># parsed to dict of geopandas.GeoDataFrame</span>
    <span class="n">_FORCING</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;waterlevel&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;bzs&quot;</span><span class="p">,</span> <span class="s2">&quot;bnd&quot;</span><span class="p">),</span>  <span class="c1">#  timeseries, locations tuple</span>
        <span class="s2">&quot;discharge&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;dis&quot;</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">),</span>
        <span class="s2">&quot;precip&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;precip&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="s2">&quot;precip2D&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;netampr&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="p">}</span>  <span class="c1"># parsed to dict of hydromt.GeoDataArray if locations else xarray.DataArray</span>
    <span class="n">_MAPS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;elevtn&quot;</span><span class="p">:</span> <span class="s2">&quot;dep&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="s2">&quot;msk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curve_number&quot;</span><span class="p">:</span> <span class="s2">&quot;scs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;manning&quot;</span><span class="p">:</span> <span class="s2">&quot;manning&quot;</span><span class="p">,</span>
        <span class="s2">&quot;infiltration&quot;</span><span class="p">:</span> <span class="s2">&quot;qinf&quot;</span><span class="p">,</span>
    <span class="p">}</span>  <span class="c1"># parsed to hydromt.RasterDataset</span>
    <span class="n">_FOLDERS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_CONF</span> <span class="o">=</span> <span class="s2">&quot;sfincs.inp&quot;</span>
    <span class="n">_DATADIR</span> <span class="o">=</span> <span class="n">DATADIR</span>
    <span class="n">_ATTRS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;dep&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;elevation&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m+ref&quot;</span><span class="p">},</span>
        <span class="s2">&quot;msk&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">},</span>
        <span class="s2">&quot;scs&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;potential maximum soil moisture retention&quot;</span><span class="p">,</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;qinf&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;infiltration rate&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;mm.hr-1&quot;</span><span class="p">},</span>
        <span class="s2">&quot;manning&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;manning roughness&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;s.m-1/3&quot;</span><span class="p">},</span>
        <span class="s2">&quot;bzs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;waterlevel&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m+ref&quot;</span><span class="p">},</span>
        <span class="s2">&quot;dis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;discharge&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m3.s-1&quot;</span><span class="p">},</span>
        <span class="s2">&quot;netampr&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;mm.hr-1&quot;</span><span class="p">},</span>
        <span class="s2">&quot;precip&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;mm.hr-1&quot;</span><span class="p">},</span>
    <span class="p">}</span>

<div class="viewcode-block" id="SfincsModel.__init__"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.html#hydromt_sfincs.SfincsModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="n">config_fn</span><span class="o">=</span><span class="s2">&quot;sfincs.inp&quot;</span><span class="p">,</span>
        <span class="n">write_gis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">data_libs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">deltares_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">artifact_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The SFINCS model class (SfincsModel) contains methods to read, write, setup and edit</span>
<span class="sd">        `SFINCS &lt;https://sfincs.readthedocs.io/en/latest/&gt;`_ models.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root: str, Path, optional</span>
<span class="sd">            Path to model folder</span>
<span class="sd">        mode: {&#39;w&#39;, &#39;r+&#39;, &#39;r&#39;}</span>
<span class="sd">            Open model in write, append or reading mode, by default &#39;w&#39;</span>
<span class="sd">        config_fn: str, Path, optional</span>
<span class="sd">            Filename of model config file, by default &quot;sfincs.inp&quot;</span>
<span class="sd">        write_gis: bool</span>
<span class="sd">            Write model files additionally to geotiff and geojson, by default True</span>
<span class="sd">        opt: dict</span>
<span class="sd">            Values for model setup options, used when called from CLI</span>
<span class="sd">        sources: dict</span>
<span class="sd">            Library with references to data sources</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># model paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span> <span class="o">=</span> <span class="n">write_gis</span>
        <span class="k">if</span> <span class="n">write_gis</span> <span class="ow">and</span> <span class="s2">&quot;gis&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FOLDERS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_FOLDERS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;gis&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">config_fn</span><span class="o">=</span><span class="n">config_fn</span><span class="p">,</span>
            <span class="n">data_libs</span><span class="o">=</span><span class="n">data_libs</span><span class="p">,</span>
            <span class="n">deltares_data</span><span class="o">=</span><span class="n">deltares_data</span><span class="p">,</span>
            <span class="n">artifact_data</span><span class="o">=</span><span class="n">artifact_data</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_basemaps"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_basemaps.html#hydromt_sfincs.SfincsModel.setup_basemaps">[docs]</a>    <span class="k">def</span> <span class="nf">setup_basemaps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">region</span><span class="p">,</span>
        <span class="n">res</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;utm&quot;</span><span class="p">,</span>
        <span class="n">basemaps_fn</span><span class="o">=</span><span class="s2">&quot;merit_hydro&quot;</span><span class="p">,</span>
        <span class="n">basin_index_fn</span><span class="o">=</span><span class="s2">&quot;merit_hydro_index&quot;</span><span class="p">,</span>
        <span class="n">reproj_method</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define model region and setup topobathy (depfile) model layer.</span>

<span class="sd">        To merge elevation and bathymetry data, elevation data is taken for land and</span>
<span class="sd">        bathymetry for sea cells, see ``landmask_fn``. An optional ``merge_buffer``</span>
<span class="sd">        can be set to define a buffer aourd the land cells where the bathymetry is</span>
<span class="sd">        estimated from a linear interpolation of elevation and bathymetry data.</span>



<span class="sd">        Adds model layers:</span>

<span class="sd">        * **dep** map: combined elevation/bathymetry [m+ref]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        region : dict</span>
<span class="sd">            Dictionary describing region of interest, e.g. {&#39;bbox&#39;: [xmin, ymin, xmax, ymax]}</span>
<span class="sd">            See :py:func:`~hydromt.workflows.parse_region()` for all options</span>
<span class="sd">        res : float</span>
<span class="sd">            Model resolution [m], by default 100 m.</span>
<span class="sd">        crs : str, int, optional</span>
<span class="sd">            Model Coordinate Reference System as epsg code, by default &#39;utm&#39; in which</span>
<span class="sd">            case the region centroid UTM zone is used. If None, the basemaps crs is used</span>
<span class="sd">            and must be a projected CRS.</span>
<span class="sd">        basemaps_fn : str</span>
<span class="sd">            Path or data source name for hydrography raster data, by default &#39;merit_hydro&#39;.</span>

<span class="sd">            * Required variables: [&#39;elevtn&#39;].</span>
<span class="sd">            * Required variables to delineate a (sub)basin: [&#39;flwdir&#39;, &#39;uparea&#39;, &#39;basins&#39;]</span>
<span class="sd">        reproj_method: str, optional</span>
<span class="sd">            Method used to reproject topobathy data, by default &#39;bilinear&#39;</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]</span>
        <span class="c1"># read data (lazy!) and return dataset</span>
        <span class="n">ds_org</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">basemaps_fn</span><span class="p">,</span> <span class="n">single_var_as_array</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="c1"># get basin geometry and clip data</span>
        <span class="n">kind</span><span class="p">,</span> <span class="n">region</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">parse_region</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">basin_geom</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geom&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bbox&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;interbasin&quot;</span><span class="p">:</span>
            <span class="n">bas_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="p">[</span><span class="n">basin_index_fn</span><span class="p">]</span>
            <span class="n">basin_geom</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">get_basin_geometry</span><span class="p">(</span>
                <span class="n">ds</span><span class="o">=</span><span class="n">ds_org</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                <span class="n">basin_index</span><span class="o">=</span><span class="n">bas_index</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                <span class="o">**</span><span class="n">region</span><span class="p">,</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">geom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">geom</span> <span class="o">=</span> <span class="n">basin_geom</span>
        <span class="k">elif</span> <span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">,</span> <span class="s2">&quot;geom&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unknown region kind for SFINCS model: </span><span class="si">{kind}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;select from [&#39;bbox&#39;, &#39;geom&#39;, &#39;interbasin&#39;]&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">geom</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;SFINCS region &quot;geom&quot; has no CRS&#39;</span><span class="p">)</span>
        <span class="c1"># parse dst_crs. if &#39;utm&#39; the best utm zone is calculated based on bbox_epsg4326</span>
        <span class="n">bbox_epsg4326</span> <span class="o">=</span> <span class="n">bbox</span> <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">geom</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span><span class="o">.</span><span class="n">total_bounds</span>
        <span class="k">if</span> <span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dst_crs</span> <span class="o">=</span> <span class="n">ds_org</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">crs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dst_crs</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">gis_utils</span><span class="o">.</span><span class="n">parse_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="n">bbox_epsg4326</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dst_crs</span><span class="o">.</span><span class="n">is_geographic</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A projected CRS is required.&quot;</span><span class="p">)</span>
        <span class="c1"># transfrom bbox/geom to geom with destination CRS to deal with nonlinear</span>
        <span class="c1"># transformations along domain edges when clipping</span>
        <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># to epsg required to be understood when writing GEOJSON</span>
            <span class="n">dst_geom</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">dst_crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dst_bbox</span> <span class="o">=</span> <span class="n">transform_bounds</span><span class="p">(</span><span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span> <span class="n">dst_crs</span><span class="p">,</span> <span class="o">*</span><span class="n">bbox</span><span class="p">)</span>
            <span class="n">dst_geom</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">dst_bbox</span><span class="p">)],</span> <span class="n">crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">)</span>

        <span class="c1"># reproject to destination CRS and clip to actual extent</span>
        <span class="n">da_elv</span> <span class="o">=</span> <span class="n">ds_org</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]</span>
        <span class="n">reproj_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">dst_res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">reproj_method</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">crs</span> <span class="o">!=</span> <span class="n">dst_crs</span><span class="p">:</span>
            <span class="n">da_elv</span> <span class="o">=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">clip_geom</span><span class="p">(</span><span class="n">geom</span><span class="o">=</span><span class="n">dst_geom</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span>
                <span class="o">**</span><span class="n">reproj_kwargs</span>
            <span class="p">)</span>
        <span class="c1"># clip and mask</span>
        <span class="n">da_elv</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">clip_geom</span><span class="p">(</span><span class="n">dst_geom</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span>
            <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span>  <span class="c1"># force nodata value to be -9999</span>
            <span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># mm precision</span>
        <span class="p">)</span>
        <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_nodata</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
        <span class="c1"># make sure orientation is S -&gt; N</span>
        <span class="k">if</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ycoords_rev</span> <span class="o">=</span> <span class="p">{</span><span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">y_dim</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">ycoords</span><span class="p">))}</span>
            <span class="n">da_elv</span> <span class="o">=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ycoords_rev</span><span class="p">)</span>

        <span class="c1"># set staticmaps</span>
        <span class="n">da_elv</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">da_elv</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># update config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_spatial_attrs</span><span class="p">()</span></div>

<div class="viewcode-block" id="SfincsModel.setup_merge_topobathy"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_merge_topobathy.html#hydromt_sfincs.SfincsModel.setup_merge_topobathy">[docs]</a>    <span class="k">def</span> <span class="nf">setup_merge_topobathy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topobathy_fn</span><span class="p">,</span>
        <span class="n">elv_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">elv_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">offset_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">offset_constant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">merge_buffer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">merge_method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">,</span>
        <span class="n">reproj_method</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the existing model topobathy data (depfile) with a new topobathy source.</span>

<span class="sd">        The existing toptobathy data is overwritten with valid values from the new dataset</span>
<span class="sd">        based on the merge method.</span>

<span class="sd">        If `offset_fn` is provided, a (spatially varying) offset is applied to the</span>
<span class="sd">        new dataset to convert the vertical datum before merging.</span>

<span class="sd">        Updates model layers:</span>

<span class="sd">        * **dep** map: combined elevation/bathymetry [m+ref]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        topobathy_fn : str, optional</span>
<span class="sd">            Path or data source name for topobathy raster data.</span>

<span class="sd">            * Required variables: [&#39;elevtn&#39;]</span>
<span class="sd">        mask_fn : str, optional</span>
<span class="sd">            Path or data source name of polygon with valid new topobathy cells.</span>
<span class="sd">        elv_min, elv_max : float, optional</span>
<span class="sd">            Minimum and maximum elevation caps for valid new topobathy cells.</span>
<span class="sd">            Note: applied before vertical offset.</span>
<span class="sd">        offset_fn : str, optional</span>
<span class="sd">            Difference between vertical reference of the current model topobathy and the new</span>
<span class="sd">            datasourcs. The offset is added to the new source before merging.</span>
<span class="sd">        merge_buffer : int, optional</span>
<span class="sd">            Buffer (number of cells) around cells where the original (merge_method = &#39;first&#39;)</span>
<span class="sd">            or new (merge_method = &#39;last&#39;) dataset where values are linearly interpolated.</span>
<span class="sd">            Not recommended to use in combination with merge_methods &#39;min&#39; or &#39;max&#39;</span>
<span class="sd">        merge_method: str {&#39;first&#39;,&#39;last&#39;,&#39;min&#39;,&#39;max&#39;}</span>
<span class="sd">            merge method, by default &#39;first&#39;:</span>

<span class="sd">            * first: use valid new where existing invalid</span>
<span class="sd">            * last: use valid new</span>
<span class="sd">            * min: pixel-wise min of existing and new</span>
<span class="sd">            * max: pixel-wise max of existing and new</span>
<span class="sd">        reproj_method: str</span>
<span class="sd">            Method used to reproject the new source and offset data to the model grid,</span>
<span class="sd">            by default &#39;bilinear&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span>
        <span class="n">da_elv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">da_elv2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">topobathy_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">reproj_method</span><span class="o">=</span><span class="n">reproj_method</span><span class="p">,</span>
            <span class="n">merge_buffer</span><span class="o">=</span><span class="n">merge_buffer</span><span class="p">,</span>
            <span class="n">merge_method</span><span class="o">=</span><span class="n">merge_method</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># mask</span>
        <span class="k">if</span> <span class="n">mask_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">elv_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">elv_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">da_elv2</span> <span class="o">!=</span> <span class="n">da_elv2</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">nodata</span>
            <span class="k">if</span> <span class="n">mask_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">gdf_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span><span class="n">mask_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">da_elv2</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">geometry_mask</span><span class="p">(</span><span class="n">gdf_mask</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">elv_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">da_elv2</span> <span class="o">&gt;</span> <span class="n">elv_min</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">elv_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">da_elv2</span> <span class="o">&lt;</span> <span class="n">elv_max</span><span class="p">)</span>
            <span class="n">da_elv2</span> <span class="o">=</span> <span class="n">da_elv2</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">da_elv2</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">nodata</span><span class="p">)</span>
        <span class="c1"># offset</span>
        <span class="k">if</span> <span class="n">offset_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">da_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                <span class="n">offset_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>
            <span class="c1"># variable name not important, but must be single variable</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">da_offset</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">da_offset</span><span class="o">=</span><span class="n">da_offset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">offset_constant</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">da_offset</span><span class="o">=</span><span class="n">offset_constant</span><span class="p">)</span>
        <span class="c1"># merge</span>
        <span class="n">da_dep_merged</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">merge_topobathy</span><span class="p">(</span>
            <span class="n">da_elv</span><span class="p">,</span> <span class="n">da_elv2</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">da_dep_merged</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns model mask map.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span>
        <span class="n">da_mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticmaps</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticmaps</span><span class="p">:</span>
            <span class="n">da_elv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]]</span>
            <span class="n">da_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">da_elv</span> <span class="o">!=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">nodata</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="n">da_mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_nodata</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticmaps</span><span class="p">:</span>
            <span class="n">da_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">da_mask</span>

<div class="viewcode-block" id="SfincsModel.setup_mask"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_mask.html#hydromt_sfincs.SfincsModel.setup_mask">[docs]</a>    <span class="k">def</span> <span class="nf">setup_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active_mask_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elv_min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">elv_max</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates mask of active model cells.</span>

<span class="sd">        Active model cells are based on cells with valid elevation; within the</span>
<span class="sd">        active mask polygon or between minimum and maximum elevation contour lines.</span>
<span class="sd">        Note that local sinks (isolated regions with elv &lt; elv_min) are kept as active cells.</span>

<span class="sd">        The model mask defines 0) Inactive, 1) active, and 2) waterlevel boundary cells</span>
<span class="sd">        and 3) outflow boundary cells. Note that this method does not set the boundary</span>
<span class="sd">        cells, use `setup_bounds` istead.</span>

<span class="sd">        Inactive cells in all staticmap layers are set to its nodata value.</span>

<span class="sd">        Sets model layers:</span>

<span class="sd">        * **msk** map: model mask [-]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        active_mask_fn : str, optional</span>
<span class="sd">            Path or data source name for mask polygon. Models cells outside the polygon are set as</span>
<span class="sd">            inactive (mask == 0) and within the polygon as active (mask == 1) cells.</span>
<span class="sd">        elv_min, elv_max : float, optional</span>
<span class="sd">            Minimum and maximum elevation thresholds for active model cells.</span>
<span class="sd">            Note: only applied if active_mask_fn not provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">da_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>
        <span class="n">da_elv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">active_mask_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf_active_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                <span class="n">active_mask_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span>
            <span class="p">)</span>
            <span class="n">da_valid</span> <span class="o">=</span> <span class="n">da_mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">geometry_mask</span><span class="p">(</span><span class="n">gdf_active_mask</span><span class="p">)</span>
            <span class="n">da_mask</span> <span class="o">=</span> <span class="n">da_mask</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">da_valid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">elv_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">elv_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dep_mask</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">mask_topobathy</span><span class="p">(</span><span class="n">da_elv</span><span class="p">,</span> <span class="n">elv_min</span><span class="p">,</span> <span class="n">elv_max</span><span class="p">)</span>
            <span class="n">da_mask</span> <span class="o">=</span> <span class="n">da_mask</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dep_mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Either active_mask_fn or elv_min/elv_max must be provided.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># update staticmaps</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticmaps</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
            <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticmaps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_staticmaps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">da_mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">nodata</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">da_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span>
        <span class="n">ncells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">da_mask</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mask with </span><span class="si">{</span><span class="n">ncells</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2"> active cells set.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Derive region based on active cells.&quot;</span><span class="p">)</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">da_mask</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">da_mask</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">vectorize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_bounds"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_bounds.html#hydromt_sfincs.SfincsModel.setup_bounds">[docs]</a>    <span class="k">def</span> <span class="nf">setup_bounds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s2">&quot;waterlevel&quot;</span><span class="p">,</span> <span class="n">include_mask_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude_mask_fn</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set boundary cells in the model mask.</span>

<span class="sd">        Boundary cells are cells at the edge of the active model domain, optionally bounded</span>
<span class="sd">        by areas to include or exclude. If no geometries to in- or exclude are provided,</span>
<span class="sd">        boundary cells are limited to cells with elevation smaller or equal to zero.</span>
<span class="sd">        Currently dynamic water level and outflow boundaries are supported, see `btype` argument.</span>

<span class="sd">        The model mask defines 0) Inactive, 1) active, and 2) waterlevel boundary cells</span>
<span class="sd">        and 3) outflow boundary cells. Active cells are inferred from valid elevation cells</span>
<span class="sd">        if not previously set using the `set_mask` method.</span>

<span class="sd">        Updates model layers:</span>

<span class="sd">        * **msk** map: model mask [-]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        btype: {&#39;waterlevel&#39;, &#39;outflow&#39;}</span>
<span class="sd">            Boundary type</span>
<span class="sd">        include_mask_fn, exclude_mask_fn: str, optional</span>
<span class="sd">            Path or data source name for mask polygon with areas to include/exclude</span>
<span class="sd">            from the model boundary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">btype</span> <span class="o">=</span> <span class="n">btype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">bvalues</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;waterlevel&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;outflow&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">btype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bvalues</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;btype must be one of &quot;waterlevel&quot;, &quot;outflow&quot;&#39;</span><span class="p">)</span>
        <span class="n">bvalue</span> <span class="o">=</span> <span class="n">bvalues</span><span class="p">[</span><span class="n">btype</span><span class="p">]</span>
        <span class="c1"># read geometries</span>
        <span class="n">gdf_include</span><span class="p">,</span> <span class="n">gdf_exclude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">include_mask_fn</span><span class="p">:</span>
            <span class="n">gdf_include</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                <span class="n">include_mask_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">exclude_mask_fn</span><span class="p">:</span>
            <span class="n">gdf_exclude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                <span class="n">include_mask_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span>
            <span class="p">)</span>
        <span class="c1"># mask values</span>
        <span class="n">da_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">mask_bounds</span><span class="p">(</span><span class="n">da_mask</span><span class="p">,</span> <span class="n">gdf_include</span><span class="p">,</span> <span class="n">gdf_exclude</span><span class="p">)</span>
        <span class="c1"># limit to cells with elevation &lt;= 0</span>
        <span class="k">if</span> <span class="n">gdf_include</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gdf_exclude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">da_elv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]]</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">da_elv</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># update model mask</span>
        <span class="n">ncells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">bounds</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ncells</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">da_mask</span> <span class="o">=</span> <span class="n">da_mask</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">bounds</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">bvalue</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">da_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ncells</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">btype</span><span class="si">}</span><span class="s2"> (mask=</span><span class="si">{</span><span class="n">bvalue</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">) boundary cells set.&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_river_inflow"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_river_inflow.html#hydromt_sfincs.SfincsModel.setup_river_inflow">[docs]</a>    <span class="k">def</span> <span class="nf">setup_river_inflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">basemaps_fn</span><span class="o">=</span><span class="s2">&quot;merit_hydro&quot;</span><span class="p">,</span> <span class="n">river_upa</span><span class="o">=</span><span class="mf">25.0</span><span class="p">,</span> <span class="n">river_len</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup river inflow (source) points where a river enters the model domain.</span>

<span class="sd">        NOTE: only the most downstream point where a river enters the model domain</span>
<span class="sd">        is kept.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **src** geoms: discharge boundary point locations</span>
<span class="sd">        * **dis** forcing: dummy discharge timeseries</span>
<span class="sd">        * **river** geoms: river centerline (not used by SFINCS; for plotting only)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        basemaps_fn: str, Path</span>
<span class="sd">            Path or data source name for hydrography raster data, by default &#39;merit_hydro&#39;.</span>

<span class="sd">            * Required layers: [&#39;uparea&#39;, &#39;flwdir&#39;].</span>
<span class="sd">        river_upa: float, optional</span>
<span class="sd">            Mimimum upstream area threshold [km2] to define river cells, by default 25 km2.</span>
<span class="sd">        river_len: float, optional</span>
<span class="sd">            Mimimum river length [m] within the model domain to define river cells, by default 0 m.</span>
<span class="sd">        buffer: int, optional</span>
<span class="sd">            Buffer [no. of cells of basemaps_fn] around model domain. A buffer is requied to identify</span>
<span class="sd">            the most downstream point where a river enters the model domain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;region&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Run setup_mask() first to define the active model region. The model region &quot;</span>
                <span class="s2">&quot;is now infered from the bounding box and may lead to inaccurate inflow points.&quot;</span>
            <span class="p">)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">basemaps_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span>
        <span class="p">)</span>

        <span class="n">gdf_src</span><span class="p">,</span> <span class="n">gdf_riv</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">river_inflow_points</span><span class="p">(</span>
            <span class="n">ds</span><span class="p">,</span>
            <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="n">dst_crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">(),</span>
            <span class="n">river_len</span><span class="o">=</span><span class="n">river_len</span><span class="p">,</span>
            <span class="n">river_upa</span><span class="o">=</span><span class="n">river_upa</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_src</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># set forcing with dummy timeseries to keep valid sfincs model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="n">gdf_src</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;discharge&quot;</span><span class="p">)</span>
        <span class="c1"># set river</span>
        <span class="n">gdf_riv</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">gdf_riv</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># one based index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf_riv</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rivers&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_river_outflow"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_river_outflow.html#hydromt_sfincs.SfincsModel.setup_river_outflow">[docs]</a>    <span class="k">def</span> <span class="nf">setup_river_outflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">basemaps_fn</span><span class="o">=</span><span class="s2">&quot;merit_hydro&quot;</span><span class="p">,</span>
        <span class="n">river_upa</span><span class="o">=</span><span class="mf">25.0</span><span class="p">,</span>
        <span class="n">outflow_width</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup river outflow boundary (msk=3) where a river flows out of the model domain.</span>

<span class="sd">        Adds / edits model layers:</span>

<span class="sd">        * **msk** map: edited by adding outflow points (msk=3)</span>
<span class="sd">        * **river_out** geoms: river centerline (not used by SFINCS; for plotting only)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        basemaps_f: str, Path</span>
<span class="sd">            Path or data source name for hydrography raster data, by default &#39;merit_hydro&#39;.</span>

<span class="sd">            * Required layers: [&#39;uparea&#39;, &#39;flwdir&#39;].</span>
<span class="sd">        outflow_width: int, optional</span>
<span class="sd">            The width [m] of the outflow boundary in the SFINCS msk file.</span>
<span class="sd">            By default 2km, i.e.: 1km to each side of the outflow point.</span>
<span class="sd">        river_upa: float, optional</span>
<span class="sd">            Mimimum upstream area threshold [km2] to define river cells, by default 25 km2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;region&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Run setup_mask() first to define the active model region. The model region &quot;</span>
                <span class="s2">&quot;is now infered from the bounding box and may lead to inaccurate outflow points.&quot;</span>
            <span class="p">)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">basemaps_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

        <span class="n">gdf_out</span><span class="p">,</span> <span class="n">gdf_riv</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">river_outflow_points</span><span class="p">(</span>
            <span class="n">ds</span><span class="p">,</span>
            <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="n">dst_crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">(),</span>
            <span class="n">river_upa</span><span class="o">=</span><span class="n">river_upa</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_out</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">da_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>
        <span class="c1"># apply buffer</span>
        <span class="n">gdf_out_buf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
            <span class="n">geometry</span><span class="o">=</span><span class="n">gdf_out</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">outflow_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">gdf_out</span><span class="o">.</span><span class="n">crs</span>
        <span class="p">)</span>
        <span class="c1"># remove outflow points near source points</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="p">[</span><span class="s2">&quot;discharge&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="n">gdf_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
            <span class="n">idx_drop</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">gdf_out_buf</span><span class="p">,</span> <span class="n">gdf_src</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
            <span class="k">if</span> <span class="n">idx_drop</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Dropping </span><span class="si">{</span><span class="n">idx_drop</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> outflow points near source points.&quot;</span>
                <span class="p">)</span>
            <span class="n">gdf_out_buf</span> <span class="o">=</span> <span class="n">gdf_out_buf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx_drop</span><span class="p">)</span>

        <span class="c1"># find intersect of buffer and model grid</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">mask_bounds</span><span class="p">(</span><span class="n">da_mask</span><span class="p">,</span> <span class="n">gdf_include</span><span class="o">=</span><span class="n">gdf_out_buf</span><span class="p">)</span>
        <span class="c1"># update model mask</span>
        <span class="n">ncells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">bounds</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ncells</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">da_mask</span> <span class="o">=</span> <span class="n">da_mask</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">bounds</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">da_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ncells</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2"> outflow (mask=3) boundary cells set.&quot;</span><span class="p">)</span>

        <span class="n">gdf_riv</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">gdf_riv</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># one based index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf_riv</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rivers_out&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_cn_infiltration"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_cn_infiltration.html#hydromt_sfincs.SfincsModel.setup_cn_infiltration">[docs]</a>    <span class="k">def</span> <span class="nf">setup_cn_infiltration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cn_fn</span><span class="o">=</span><span class="s2">&quot;gcn250&quot;</span><span class="p">,</span> <span class="n">antecedent_runoff_conditions</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup model potential maximum soil moisture retention map (scsfile)</span>
<span class="sd">        from gridded curve number map.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **scs** map: potential maximum soil moisture retention [inch]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        cn_fn: str, optional</span>
<span class="sd">            Name of gridded curve number map.</span>

<span class="sd">            * Required layers without antecedent runoff conditions: [&#39;cn&#39;]</span>
<span class="sd">            * Required layers with antecedent runoff conditions: [&#39;cn_dry&#39;, &#39;cn_avg&#39;, &#39;cn_wet&#39;]</span>
<span class="sd">        antecedent_runoff_conditions: {&#39;dry&#39;, &#39;avg&#39;, &#39;wet&#39;}, optional</span>
<span class="sd">            Antecedent runoff conditions.</span>
<span class="sd">            None if data has no atecedent runoff conditions.</span>
<span class="sd">            By default `avg`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get data</span>
        <span class="n">v</span> <span class="o">=</span> <span class="s2">&quot;cn&quot;</span>
        <span class="k">if</span> <span class="n">antecedent_runoff_conditions</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cn_</span><span class="si">{</span><span class="n">antecedent_runoff_conditions</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">da_org</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">cn_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># reproject using median</span>
        <span class="n">da_cn</span> <span class="o">=</span> <span class="n">da_org</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reproject_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;med&quot;</span><span class="p">)</span>
        <span class="c1"># TODO set CN=100 based on water mask</span>
        <span class="c1"># convert to potential maximum soil moisture retention S (1000/CN - 10) [inch]</span>
        <span class="n">da_scs</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">cn_to_s</span><span class="p">(</span><span class="n">da_cn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># set staticmaps</span>
        <span class="n">mname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;curve_number&quot;</span><span class="p">]</span>
        <span class="n">da_scs</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">da_scs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">mname</span><span class="p">)</span>
        <span class="c1"># update config: remove default infiltration values and set scs map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;qinf&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_manning_roughness"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_manning_roughness.html#hydromt_sfincs.SfincsModel.setup_manning_roughness">[docs]</a>    <span class="k">def</span> <span class="nf">setup_manning_roughness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lulc_fn</span><span class="o">=</span><span class="s2">&quot;vito&quot;</span><span class="p">,</span> <span class="n">map_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup model manning rouchness map (manningfile) from gridded</span>
<span class="sd">        land-use/land-cover map and manning roughness mapping table.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **man** map: manning roughness coefficient [s.m-1/3]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        lulc_fn: str, optional</span>
<span class="sd">            Name of landuse-landcover map.</span>

<span class="sd">            * Required layers: [&#39;lulc&#39;]</span>
<span class="sd">        map_fn: path-like, optional</span>
<span class="sd">            CSV mapping file with lulc classes in the index column and manning values</span>
<span class="sd">            in another column with &#39;N&#39; as header.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">map_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">map_fn</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">DATADIR</span><span class="p">,</span> <span class="s2">&quot;lulc&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lulc_fn</span><span class="si">}</span><span class="s2">_mapping.csv&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">map_fn</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mannng roughness mapping file not found: </span><span class="si">{</span><span class="n">map_fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">da_org</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">lulc_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lulc&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># reproject and reclassify</span>
        <span class="c1"># TODO use generic names for parameters</span>
        <span class="c1"># FIXME use hydromt general version!!</span>
        <span class="n">da_msk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">da_man</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">landuse</span><span class="p">(</span>
            <span class="n">da_org</span><span class="p">,</span> <span class="n">da_msk</span><span class="p">,</span> <span class="n">map_fn</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span>
        <span class="p">)[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span>
        <span class="c1"># mask and set precision</span>
        <span class="n">da_man</span> <span class="o">=</span> <span class="n">da_man</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">da_msk</span><span class="p">,</span> <span class="n">da_man</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">nodata</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1"># set staticmaps</span>
        <span class="n">mname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;manning&quot;</span><span class="p">]</span>
        <span class="n">da_man</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">da_man</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">mname</span><span class="p">)</span>
        <span class="c1"># update config: remove default manning values and set maning map</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;manning_land&quot;</span><span class="p">,</span> <span class="s2">&quot;manning_sea&quot;</span><span class="p">,</span> <span class="s2">&quot;rgh_lev_land&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">mname</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_gauges"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_gauges.html#hydromt_sfincs.SfincsModel.setup_gauges">[docs]</a>    <span class="k">def</span> <span class="nf">setup_gauges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gauges_fn</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup model observation point locations.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **obs** geom: observation point locations</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        gauges_fn: str</span>
<span class="sd">            Path to observation points geometry file.</span>
<span class="sd">            See :py:func:`~hydromt.open_vector`, for accepted files.</span>
<span class="sd">        overwrite: bool, optional</span>
<span class="sd">            If True, overwrite existing gauges instead of appending the new gauges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="s2">&quot;gauges&quot;</span><span class="p">]</span>
        <span class="c1"># ensure the catalog is loaded before adding any new entries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">sources</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
            <span class="n">gauges_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">assert_gtype</span><span class="o">=</span><span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="p">:</span>
            <span class="n">gdf0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticgeoms</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">gdf</span><span class="p">,</span> <span class="n">gdf0</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding new gauges to existing gauges.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> set based on </span><span class="si">{</span><span class="n">gauges_fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_structures"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_structures.html#hydromt_sfincs.SfincsModel.setup_structures">[docs]</a>    <span class="k">def</span> <span class="nf">setup_structures</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">structures_fn</span><span class="p">,</span> <span class="n">stype</span><span class="p">,</span> <span class="n">dz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup thin dam or weir structures.</span>

<span class="sd">        Adds model layer (depending on `stype`):</span>

<span class="sd">        * **thd** geom: thin dam</span>
<span class="sd">        * **weir** geom: weir / levee</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structures_fn : str, Path</span>
<span class="sd">            Path to structure line geometry file.</span>
<span class="sd">            The &quot;name&quot; (for thd and weir), &quot;z&quot; and &quot;par1&quot; (for weir only) are optional.</span>
<span class="sd">            For weirs: `dz` must be provided if gdf has no &quot;z&quot; column or Z LineString;</span>
<span class="sd">            &quot;par1&quot; defaults to 0.6 if gdf has no &quot;par1&quot; column.</span>
<span class="sd">        stype : {&#39;thd&#39;, &#39;weir&#39;}</span>
<span class="sd">            Structure type.</span>
<span class="sd">        overwrite: bool, optional</span>
<span class="sd">            If True, overwrite existing &#39;stype&#39; structures instead of appending the</span>
<span class="sd">            new structures.</span>
<span class="sd">        dz: float, optional</span>
<span class="sd">            If provided, for weir structures the z value is calculated from</span>
<span class="sd">            the model elevation (dep) plus dz.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;thd&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">],</span>
            <span class="s2">&quot;weir&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;par1&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">assert</span> <span class="n">stype</span> <span class="ow">in</span> <span class="n">cols</span>
        <span class="c1"># read, clip and reproject</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
            <span class="n">structures_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">[</span><span class="n">stype</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">]]</span>  <span class="c1"># keep relevant cols</span>
        <span class="n">structs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gdf2structures</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>  <span class="c1"># check if it parsed correct</span>
        <span class="c1"># sample zb values from dep file and set z = zb + dz</span>
        <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="s2">&quot;weir&quot;</span> <span class="ow">and</span> <span class="n">dz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]]</span>
            <span class="n">structs_out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">structs</span><span class="p">:</span>
                <span class="n">pnts</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
                <span class="n">zb</span> <span class="o">=</span> <span class="n">elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">pnts</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">))</span>
                <span class="n">s</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zb</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">dz</span><span class="p">)</span>
                <span class="n">structs_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">structures2gdf</span><span class="p">(</span><span class="n">structs_out</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">stype</span> <span class="o">==</span> <span class="s2">&quot;weir&quot;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="s2">&quot;z&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">structs</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Weir structure requires z values.&quot;</span><span class="p">)</span>
        <span class="c1"># combine with exisiting structures if present</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">stype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="p">:</span>
            <span class="n">gdf0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticgeoms</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">stype</span><span class="p">)</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">gdf</span><span class="p">,</span> <span class="n">gdf0</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding </span><span class="si">{</span><span class="n">stype</span><span class="si">}</span><span class="s2"> structures to existing structures.&quot;</span><span class="p">)</span>
        <span class="c1"># set structures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">stype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stype</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">stype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stype</span><span class="si">}</span><span class="s2"> structure set based on </span><span class="si">{</span><span class="n">structures_fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1">### FORCING</span>
<div class="viewcode-block" id="SfincsModel.setup_h_forcing"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_h_forcing.html#hydromt_sfincs.SfincsModel.setup_h_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">setup_h_forcing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">geodataset_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">timeseries_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">offset_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">buffer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup waterlevel boundary point locations (bnd) and time series (bzs).</span>

<span class="sd">        Use geodataset_fn to set the waterlevel boundary from a dataset of point location</span>
<span class="sd">        timeseries. The dataset is clipped to the model region plus `buffer` [m], and</span>
<span class="sd">        model time based on the model config tstart and tstop entries.</span>

<span class="sd">        Use timeseries_fn to set a spatially uniform waterlevel boundary representative</span>
<span class="sd">        for all waterlevel boundary cells (msk==2), The timeseries is clipped based on</span>
<span class="sd">        the model config tstart and tstop entries. The boundary point location is infered</span>
<span class="sd">        from the model mask.</span>

<span class="sd">        If timeseries_fn and geodataset_fn are both not provided a dummy (h=0) waterlevel</span>
<span class="sd">        boundary is set.</span>

<span class="sd">        The vertical reference of the waterlevel data can be corrected to match</span>
<span class="sd">        the vertical reference of the model elevation (dep) layer by adding</span>
<span class="sd">        a local offset value derived from the `offset_fn` map to the waterlevels,</span>
<span class="sd">        e.g. mean dynamic topography for difference between EGM and MSL levels.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **bnd** geom: waterlevel gauge point locations</span>
<span class="sd">        * **bzs** forcing: waterlevel time series [m+ref]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geodataset_fn: str, Path</span>
<span class="sd">            Path or data source name for geospatial point timeseries file.</span>
<span class="sd">            This can either be a netcdf file with geospatial coordinates</span>
<span class="sd">            or a combined point location file with a timeseries data csv file</span>
<span class="sd">            which can be setup through the data_catalog.yml file.</span>

<span class="sd">            * Required variables if netcdf: [&#39;waterlevel&#39;]</span>
<span class="sd">            * Required coordinates if netcdf: [&#39;time&#39;, &#39;index&#39;, &#39;y&#39;, &#39;x&#39;]</span>
<span class="sd">        timeseries_fn: str, Path</span>
<span class="sd">            Path to spatially uniform timeseries csv file with time index in first column</span>
<span class="sd">            and waterlevels in the second column. The first row is interpreted as header,</span>
<span class="sd">            see :py:func:`hydromt.open_timeseries_from_table`, for details.</span>
<span class="sd">            Note: tabulated timeseries files cannot yet be set through the data_catalog yml file.</span>
<span class="sd">        offset_fn: str, optional</span>
<span class="sd">            Path or data source name for gridded offset between vertical reference of elevation and waterlevel data,</span>
<span class="sd">            Adds to the waterlevel data before merging.</span>

<span class="sd">            * Required variables: [&#39;mdt&#39;]</span>
<span class="sd">        buffer: float</span>
<span class="sd">            Buffer around model region from which to select waterlevel gauges</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;waterlevel&quot;</span>
        <span class="n">msk2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">msk2</span><span class="p">):</span>
            <span class="c1"># No waterlevel boundary remove bnd/bzs from sfincs.inp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;No waterlevel boundary cells (msk==2) in model mask. &quot;</span>
                <span class="s2">&quot;Update the mask layer first before setting waterlevel timeseries.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">()</span>  <span class="c1"># model time</span>
        <span class="k">if</span> <span class="n">geodataset_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># read and clip data in time &amp; space</span>
            <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataset</span><span class="p">(</span>
                <span class="n">geodataset_fn</span><span class="p">,</span>
                <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span>
                <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
                <span class="n">time_tuple</span><span class="o">=</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># create bnd point on single waterlevel boundary cell</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">msk2</span><span class="p">))</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">y</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]),</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">timeseries_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">da_ts</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">open_timeseries</span><span class="p">(</span><span class="n">timeseries_fn</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
                    <span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">da_ts</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="p">),</span> <span class="s2">&quot;Uniform waterlevel should contain single time series.&quot;</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">GeoDataArray</span><span class="o">.</span><span class="n">from_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">da_ts</span><span class="p">,</span> <span class="n">index_dim</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># dummy timeseries</span>
                <span class="k">return</span>
        <span class="c1"># correct for MDT</span>
        <span class="k">if</span> <span class="n">offset_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">isfile</span><span class="p">(</span><span class="n">offset_fn</span><span class="p">):</span>
            <span class="n">da_mdt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                <span class="n">offset_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mdt&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">mdt_pnts</span> <span class="o">=</span> <span class="n">da_mdt</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">())</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">da</span> <span class="o">+</span> <span class="n">mdt_pnts</span>
            <span class="n">mdt_avg</span> <span class="o">=</span> <span class="n">mdt_pnts</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: applied MDT (avg: </span><span class="si">{</span><span class="n">mdt_avg</span><span class="si">:</span><span class="s2">+.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">ts</span><span class="o">=</span><span class="n">da</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_q_forcing"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_q_forcing.html#hydromt_sfincs.SfincsModel.setup_q_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">setup_q_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geodataset_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeseries_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup discharge boundary point locations (src) and time series (dis).</span>

<span class="sd">        Use geodataset_fn to set the discharge boundary from a dataset of point location</span>
<span class="sd">        timeseries. Only locations within the model domain are selected.</span>

<span class="sd">        Use timeseries_fn to set discharge boundary conditions to pre-set (src) locations,</span>
<span class="sd">        e.g. after the `setup_river_inflow` method.</span>

<span class="sd">        The dataset/timeseries are clipped to the model time based on the model config</span>
<span class="sd">        tstart and tstop entries.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **src** geom: discharge gauge point locations</span>
<span class="sd">        * **dis** forcing: discharge time series [m3/s]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geodataset_fn: str, Path</span>
<span class="sd">            Path or data source name for geospatial point timeseries file.</span>
<span class="sd">            This can either be a netcdf file with geospatial coordinates</span>
<span class="sd">            or a combined point location file with a timeseries data csv file</span>
<span class="sd">            which can be setup through the data_catalog yml file.</span>

<span class="sd">            * Required variables if netcdf: [&#39;discharge&#39;]</span>
<span class="sd">            * Required coordinates if netcdf: [&#39;time&#39;, &#39;index&#39;, &#39;y&#39;, &#39;x&#39;]</span>
<span class="sd">        timeseries_fn: str, Path</span>
<span class="sd">            Path to tabulated timeseries csv file with time index in first column</span>
<span class="sd">            and location IDs in the first row,</span>
<span class="sd">            see :py:func:`~hydromt.open_timeseries_from_table`, for details.</span>
<span class="sd">            NOTE: tabulated timeseries files cannot yet be set through the data_catalog yml file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;discharge&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">()</span>  <span class="c1"># time slice</span>
        <span class="k">if</span> <span class="n">geodataset_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;No discharge inflow (src) points set: &quot;</span>
                <span class="s2">&quot;Run ``setup_river_inflow()`` method first or provide locations.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">geodataset_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># read and clip data</span>
            <span class="n">da</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataset</span><span class="p">(</span>
                    <span class="n">geodataset_fn</span><span class="p">,</span>
                    <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                    <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
                    <span class="n">time_tuple</span><span class="o">=</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">),</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">ts</span><span class="o">=</span><span class="n">da</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">timeseries_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># read timeseries data and match with existing gdf</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
            <span class="n">da_ts</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">open_timeseries_from_table</span><span class="p">(</span><span class="n">timeseries_fn</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="n">da_ts</span> <span class="o">=</span> <span class="n">da_ts</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">))</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">ts</span><span class="o">=</span><span class="n">da_ts</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Either &quot;geodataset_fn&quot; or &quot;timeseries_fn&quot; must be provided.&#39;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_q_forcing_from_grid"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_q_forcing_from_grid.html#hydromt_sfincs.SfincsModel.setup_q_forcing_from_grid">[docs]</a>    <span class="k">def</span> <span class="nf">setup_q_forcing_from_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">discharge_fn</span><span class="p">,</span> <span class="n">locs_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uparea_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wdw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_error</span><span class="o">=</span><span class="mf">0.1</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup discharge boundary location (src) and timeseries (dis) based on a</span>
<span class="sd">        gridded discharge dataset.</span>

<span class="sd">        If `locs_fn` is not provided, the discharge source locations are expected to be</span>
<span class="sd">        pre-set, e.g. using the :py:func:`~hydromt_sfincs.SfincsModel.setup_river_inflow` method.</span>

<span class="sd">        If an upstream area grid is provided the discharge boundary condition is</span>
<span class="sd">        snapped to the best fitting grid cell within a `wdw` neighboring cells.</span>
<span class="sd">        The best fit is dermined based on the minimal relative upstream area error if</span>
<span class="sd">        an upstream area value is available for the discharge boundary locations;</span>
<span class="sd">        otherwise it is based on maximum upstream area.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **src** geom: discharge gauge point locations</span>
<span class="sd">        * **dis** forcing: discharge time series [m3/s]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        discharge_fn: str, Path, optional</span>
<span class="sd">            Path or data source name for gridded discharge timeseries dataset.</span>

<span class="sd">            * Required variables: [&#39;discharge&#39; (m3/s)]</span>
<span class="sd">            * Required coordinates: [&#39;time&#39;, &#39;y&#39;, &#39;x&#39;]</span>
<span class="sd">        locs_fn: str, Path, optional</span>
<span class="sd">            Path or data source name for point location dataset.</span>
<span class="sd">            See :py:func:`~hydromt.open_vector`, for accepted files.</span>

<span class="sd">        uparea_fn: str, Path, optional</span>
<span class="sd">            Path to upstream area grid in gdal (e.g. geotiff) or netcdf format.</span>

<span class="sd">            * Required variables: [&#39;uparea&#39; (km2)]</span>
<span class="sd">        wdw: int, optional</span>
<span class="sd">            Window size in number of cells around discharge boundary locations</span>
<span class="sd">            to snap to, only used if ``uparea_fn`` is provided. By default 1.</span>
<span class="sd">        max_error: float, optional</span>
<span class="sd">            Maximum relative error between the discharge boundary location upstream area</span>
<span class="sd">            and the upstream area of the best fit grid cell, only used if &quot;discharge&quot;</span>
<span class="sd">            staticgeoms has a &quot;uparea&quot; column. By default 0.1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;discharge&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">locs_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                <span class="n">locs_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">assert_gtype</span><span class="o">=</span><span class="s2">&quot;Point&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;No discharge inflow points in staticgeoms. Provide locations using &quot;locs_fn&quot; or &#39;</span>
                <span class="s1">&#39;run &quot;setup_river_inflow()&quot; method first to determine inflow locations.&#39;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># read data</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">discharge_fn</span><span class="p">,</span>
            <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="n">buffer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">time_tuple</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">(),</span>  <span class="c1"># model time</span>
            <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
            <span class="n">single_var_as_array</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">uparea_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;uparea&quot;</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">da_upa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                <span class="n">uparea_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">rm</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">da_upa</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">x_dim</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">x_dim</span><span class="p">,</span>
                <span class="n">da_upa</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">y_dim</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">y_dim</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">ds</span><span class="p">,</span> <span class="n">da_upa</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">rm</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="s2">&quot;uparea&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No &quot;uparea&quot; column found in location data.&#39;</span><span class="p">)</span>

        <span class="n">da_q</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">snap_discharge</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span>
            <span class="n">gdf</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span>
            <span class="n">wdw</span><span class="o">=</span><span class="n">wdw</span><span class="p">,</span>
            <span class="n">max_error</span><span class="o">=</span><span class="n">max_error</span><span class="p">,</span>
            <span class="n">uparea_name</span><span class="o">=</span><span class="s2">&quot;uparea&quot;</span><span class="p">,</span>
            <span class="n">discharge_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># set zeros for src points without matching discharge</span>
        <span class="n">da_q</span> <span class="o">=</span> <span class="n">da_q</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># update forcing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">da_q</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">gdf</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_p_forcing_from_grid"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_p_forcing_from_grid.html#hydromt_sfincs.SfincsModel.setup_p_forcing_from_grid">[docs]</a>    <span class="k">def</span> <span class="nf">setup_p_forcing_from_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">precip_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dst_res</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup precipitation forcing from a gridded spatially varying data source.</span>

<span class="sd">        If aggregate is True, spatially uniform precipitation forcing is added to</span>
<span class="sd">        the model based on the mean precipitation over the model domain.</span>
<span class="sd">        If aggregate is False, distributed precipitation is added to the model as netcdf file.</span>
<span class="sd">        The data is reprojected to the model CRS (and destination resolution `dst_res` if provided).</span>

<span class="sd">        Adds one of these model layer:</span>

<span class="sd">        * **netamprfile** forcing: distributed precipitation [mm/hr]</span>
<span class="sd">        * **precipfile** forcing: uniform precipitation [mm/hr]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        precip_fn, str, Path</span>
<span class="sd">            Path to precipitation rasterdataset netcdf file.</span>

<span class="sd">            * Required variables: [&#39;precip&#39; (mm)]</span>
<span class="sd">            * Required coordinates: [&#39;time&#39;, &#39;y&#39;, &#39;x&#39;]</span>

<span class="sd">        dst_res: float</span>
<span class="sd">            output resolution (m), by default None and computed from source data.</span>
<span class="sd">            Only used in combination with aggregate=False</span>
<span class="sd">        aggregate: bool, {&#39;mean&#39;, &#39;median&#39;}, optional</span>
<span class="sd">            Method to aggregate distributed input precipitation data. If True, mean</span>
<span class="sd">            aggregation is used, if False (default) the data is not aggregated and</span>
<span class="sd">            spatially distributed precipitation is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;precip&quot;</span>
        <span class="c1"># get data for model domain and config time range</span>
        <span class="n">precip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">precip_fn</span><span class="p">,</span>
            <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="n">buffer</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">time_tuple</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">(),</span>
            <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># aggregate or reproject in space</span>
        <span class="k">if</span> <span class="n">aggregate</span><span class="p">:</span>
            <span class="n">stat</span> <span class="o">=</span> <span class="n">aggregate</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aggregate</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;mean&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Aggregate </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> using </span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">precip_out</span> <span class="o">=</span> <span class="n">precip</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">zonal_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stat</span><span class="p">)[</span>
                <span class="sa">f</span><span class="s2">&quot;precip_</span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">]</span>
            <span class="n">precip_out</span> <span class="o">=</span> <span class="n">precip_out</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">precip_out</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># reproject to model utm crs</span>
            <span class="c1"># NOTE: currently SFINCS errors (stack overflow) on large files,</span>
            <span class="c1"># downscaling to model grid is not recommended</span>
            <span class="n">kwargs0</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="n">dst_res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest_index&quot;</span><span class="p">)</span>
            <span class="n">kwargs0</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">meth</span> <span class="o">=</span> <span class="n">kwargs0</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resample </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> using </span><span class="si">{</span><span class="n">meth</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">precip_out</span> <span class="o">=</span> <span class="n">precip</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span>
                <span class="n">dst_crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">dst_res</span><span class="o">=</span><span class="n">dst_res</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># resample in time</span>
        <span class="n">precip_out</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">resample_time</span><span class="p">(</span>
            <span class="n">precip_out</span><span class="p">,</span>
            <span class="n">freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="s2">&quot;1H&quot;</span><span class="p">),</span>
            <span class="n">conserve_mass</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">upsampling</span><span class="o">=</span><span class="s2">&quot;bfill&quot;</span><span class="p">,</span>
            <span class="n">downsampling</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">precip_out</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Precipitation&quot;</span>  <span class="c1"># capital is important for netamprfile</span>

        <span class="c1"># set correct names and attrs and add forcing</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fname2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">2D&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">aggregate</span><span class="p">:</span>
            <span class="c1"># remove netamprfile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">fname2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname2</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># precipfile = sfincs.precip</span>
            <span class="n">fn_out</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># remove precipfile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># netamprfile = precip.nc</span>
            <span class="n">fn_out</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">.nc&quot;</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">fname2</span>
        <span class="n">precip_out</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">fn_out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">precip_out</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">fname</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_p_forcing"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.setup_p_forcing.html#hydromt_sfincs.SfincsModel.setup_p_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">setup_p_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precip_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup spatially uniform precipitation forcing (precip).</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **precipfile** forcing: uniform precipitation [mm/hr]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        precip_fn, str, Path</span>
<span class="sd">            Path to tabulated timeseries csv file with time index in first column</span>
<span class="sd">            and location IDs in the first row,</span>
<span class="sd">            see :py:func:`~hydromt.open_timeseries_from_table`, for details.</span>
<span class="sd">            Note: tabulated timeseries files cannot yet be set through the data_catalog yml file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">open_timeseries_from_table</span><span class="p">(</span><span class="n">precip_fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;precip&quot;</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">ts</span><span class="p">)</span>
        <span class="c1"># remove netamprfile</span>
        <span class="n">fname2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="p">[</span><span class="s2">&quot;precip2D&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">fname2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname2</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.plot_forcing"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.plot_forcing.html#hydromt_sfincs.SfincsModel.plot_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">plot_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn_out</span><span class="o">=</span><span class="s2">&quot;forcing.png&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot model timeseries forcing.</span>

<span class="sd">        For distributed forcing a spatial avarage is plotted.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fn_out: str</span>
<span class="sd">            Path to output figure file.</span>
<span class="sd">            If a basename is given it is saved to &lt;model_root&gt;/figs/&lt;fn_out&gt;</span>
<span class="sd">            If None, no file is saved.</span>
<span class="sd">        forcing : Dict of xr.DataArray</span>
<span class="sd">            Model forcing</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, axes</span>
<span class="sd">            Model fig and ax objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="c1"># update missing attributes for plot labels</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">plot_forcing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># set xlim to model tstart - tend</span>
            <span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">()</span>
            <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">([</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">]))</span>

            <span class="c1"># save figure</span>
            <span class="k">if</span> <span class="n">fn_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">fn_out</span><span class="p">):</span>
                    <span class="n">fn_out</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;figs&quot;</span><span class="p">,</span> <span class="n">fn_out</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">)):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn_out</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">225</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>

<div class="viewcode-block" id="SfincsModel.plot_basemap"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.plot_basemap.html#hydromt_sfincs.SfincsModel.plot_basemap">[docs]</a>    <span class="k">def</span> <span class="nf">plot_basemap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fn_out</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;basemap.png&quot;</span><span class="p">,</span>
        <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dep&quot;</span><span class="p">,</span>
        <span class="n">shaded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">plot_bounds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">bmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sat&quot;</span><span class="p">,</span>
        <span class="n">zoomlevel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">geoms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">geom_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create basemap plot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fn_out: str</span>
<span class="sd">            Path to output figure file.</span>
<span class="sd">            If a basename is given it is saved to &lt;model_root&gt;/figs/&lt;fn_out&gt;</span>
<span class="sd">            If None, no file is saved.</span>
<span class="sd">        staticmaps : xr.Dataset</span>
<span class="sd">            Dataset with model maps</span>
<span class="sd">        staticgeoms : Dict of geopandas.GeoDataFrame</span>
<span class="sd">            Model geometries</span>
<span class="sd">        variable : str, optional</span>
<span class="sd">            Map name to plot, by default &#39;dep&#39;</span>
<span class="sd">        shaded : bool, optional</span>
<span class="sd">            Add shade to variable (only for variable = &#39;dep&#39;), by default True</span>
<span class="sd">        plot_bounds : bool, optional</span>
<span class="sd">            Add waterlevel (msk=2) and open (msk=3) boundary conditions to plot.</span>
<span class="sd">        bmap : {&#39;sat&#39;, &#39;&#39;}</span>
<span class="sd">            background map, by default &quot;sat&quot;</span>
<span class="sd">        zoomlevel : int, optional</span>
<span class="sd">            zoomlevel, by default 11</span>
<span class="sd">        figsize : Tuple[int], optional</span>
<span class="sd">            figure size, by default None</span>
<span class="sd">        geoms : List[str], optional</span>
<span class="sd">            list of model geometries to plot, by default all model geometries.</span>
<span class="sd">        geom_kwargs : Dict of Dict, optional</span>
<span class="sd">            Model geometry styling per geometry, passed to geopands.GeoDataFrame.plot method.</span>
<span class="sd">            For instance: {&#39;src&#39;: {&#39;markersize&#39;: 30}}.</span>
<span class="sd">        legend_kwargs : Dict, optional</span>
<span class="sd">            Legend kwargs, passed to ax.legend method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, axes</span>
<span class="sd">            Model fig and ax objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="c1"># combine staticgeoms and forcing locations</span>
        <span class="n">sg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">gname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span> <span class="ow">and</span> <span class="n">gname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sg</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">gname</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()})</span>

        <span class="c1"># make sure staticmaps are set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">plot_basemap</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">,</span>
            <span class="n">staticgeoms</span><span class="o">=</span><span class="n">sg</span><span class="p">,</span>
            <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
            <span class="n">shaded</span><span class="o">=</span><span class="n">shaded</span><span class="p">,</span>
            <span class="n">plot_bounds</span><span class="o">=</span><span class="n">plot_bounds</span><span class="p">,</span>
            <span class="n">bmap</span><span class="o">=</span><span class="n">bmap</span><span class="p">,</span>
            <span class="n">zoomlevel</span><span class="o">=</span><span class="n">zoomlevel</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
            <span class="n">geoms</span><span class="o">=</span><span class="n">geoms</span><span class="p">,</span>
            <span class="n">geom_kwargs</span><span class="o">=</span><span class="n">geom_kwargs</span><span class="p">,</span>
            <span class="n">legend_kwargs</span><span class="o">=</span><span class="n">legend_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">fn_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">fn_out</span><span class="p">):</span>
                <span class="n">fn_out</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;figs&quot;</span><span class="p">,</span> <span class="n">fn_out</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn_out</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">225</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

    <span class="c1"># I/O</span>
<div class="viewcode-block" id="SfincsModel.read"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.read.html#hydromt_sfincs.SfincsModel.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the complete model schematization and configuration from file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_staticmaps</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_staticgeoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_forcing</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_states</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_results</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Model read&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.write.html#hydromt_sfincs.SfincsModel.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the complete model schematization and configuration to file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write model data to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_staticmaps</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_staticgeoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_forcing</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_states</span><span class="p">()</span>
        <span class="c1"># config last; might be udpated when writing maps, states or forcing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_config</span><span class="p">()</span></div>

<div class="viewcode-block" id="SfincsModel.read_staticmaps"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.read_staticmaps.html#hydromt_sfincs.SfincsModel.read_staticmaps">[docs]</a>    <span class="k">def</span> <span class="nf">read_staticmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read SFNCS binary staticmaps and save to `staticmaps` attribute.</span>
<span class="sd">        Known binary files mentioned in the sfincs.inp configuration file are read,</span>
<span class="sd">        including: msk/dep/scs/manning/qinf.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        crs: int, CRS</span>
<span class="sd">            Coordinate reference system, if provided use instead of epsg code from sfincs.inp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># read geospatial attributes from sfincs.inp, save with with S-&gt;N orientation</span>
        <span class="n">shape</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spatial_attrs</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>

        <span class="c1"># read raw numbers and reshape to 2D arrays</span>
        <span class="n">fn_ind</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indexfile&quot;</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn_ind</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.ind path </span><span class="si">{</span><span class="n">fn_ind</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_binary_map_index</span><span class="p">(</span><span class="n">fn_ind</span><span class="p">)</span>

        <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;msk&quot;</span><span class="p">:</span> <span class="s2">&quot;u1&quot;</span><span class="p">}</span>
        <span class="n">mvs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;msk&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">data_vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">mname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">file not found at </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span> <span class="s2">&quot;f4&quot;</span><span class="p">)</span>
                <span class="n">mv</span> <span class="o">=</span> <span class="n">mvs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span> <span class="o">-</span><span class="mf">9999.0</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_binary_map</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
                <span class="n">data_vars</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">mname</span><span class="p">:</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mv</span><span class="p">)})</span>

        <span class="c1"># create dataset and set as staticmaps</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">RasterDataset</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
            <span class="n">data_vars</span><span class="o">=</span><span class="n">data_vars</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
            <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
            <span class="n">ds</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write_staticmaps"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.write_staticmaps.html#hydromt_sfincs.SfincsModel.write_staticmaps">[docs]</a>    <span class="k">def</span> <span class="nf">write_staticmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write SFINCS staticmaps to binary files including map index file.</span>
<span class="sd">        Filenames are taken from the `config` attribute.</span>

<span class="sd">        If `write_gis` property is True, all staticmaps are written to geotiff</span>
<span class="sd">        files in a &quot;gis&quot; subfolder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Model opened in read-only&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticmaps</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">ds_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span>
        <span class="k">if</span> <span class="n">ds_out</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># make sure orientation is S -&gt; N</span>
            <span class="n">yrev</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">ds_out</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">ycoords</span><span class="p">))</span>
            <span class="n">ds_out</span> <span class="o">=</span> <span class="n">ds_out</span><span class="o">.</span><span class="n">reindex</span><span class="p">({</span><span class="n">ds_out</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">y_dim</span><span class="p">:</span> <span class="n">yrev</span><span class="p">})</span>

        <span class="c1"># make sure a mask if present</span>
        <span class="n">da_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">da_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Write binary map indices based on mask.&quot;</span><span class="p">)</span>
        <span class="n">msk</span> <span class="o">=</span> <span class="n">da_mask</span><span class="o">.</span><span class="n">values</span>
        <span class="n">fn_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;indexfile&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">write_binary_map_index</span><span class="p">(</span><span class="n">fn_ind</span><span class="p">,</span> <span class="n">msk</span><span class="o">=</span><span class="n">msk</span><span class="p">)</span>

        <span class="n">dvars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write binary map files: </span><span class="si">{</span><span class="n">dvars</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;msk&quot;</span><span class="p">:</span> <span class="s2">&quot;u1&quot;</span><span class="p">}</span>  <span class="c1"># default to f4</span>
        <span class="k">for</span> <span class="n">mname</span> <span class="ow">in</span> <span class="n">dvars</span><span class="p">:</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">fn_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">write_binary_map</span><span class="p">(</span>
                <span class="n">fn_out</span><span class="p">,</span>
                <span class="n">ds_out</span><span class="p">[</span><span class="n">mname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">msk</span><span class="o">=</span><span class="n">msk</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span> <span class="s2">&quot;f4&quot;</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_raster</span><span class="p">(</span><span class="s2">&quot;staticmaps&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.read_staticgeoms"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.read_staticgeoms.html#hydromt_sfincs.SfincsModel.read_staticgeoms">[docs]</a>    <span class="k">def</span> <span class="nf">read_staticgeoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read geometry files if and save to `staticgeoms` attribute.</span>
<span class="sd">        Known geometry files mentioned in the sfincs.inp configuration file are read,</span>
<span class="sd">        including: bnd/src/obs xy files and thd/weir structure files.</span>

<span class="sd">        If other geojson files are present in a &quot;gis&quot; subfolder folder, those are read as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_staticgeoms</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># fresh start in read-only mode</span>
        <span class="c1"># read _GEOMS model files</span>
        <span class="k">for</span> <span class="n">gname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file not found at </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">gname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;thd&quot;</span><span class="p">,</span> <span class="s2">&quot;weir&quot;</span><span class="p">]:</span>
                    <span class="n">struct</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_structures</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">structures2gdf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_xy</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">gname</span><span class="p">)</span>
        <span class="c1"># read additional geojson files from gis directory</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">,</span> <span class="s2">&quot;*.geojson&quot;</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.geojson&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">gnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">skip</span> <span class="o">=</span> <span class="n">gnames</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">open_vector</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write_staticgeoms"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.write_staticgeoms.html#hydromt_sfincs.SfincsModel.write_staticgeoms">[docs]</a>    <span class="k">def</span> <span class="nf">write_staticgeoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write staticgeoms to bnd/src/obs xy files and thd/weir structure files.</span>
<span class="sd">        Filenames are based on the `config` attribute.</span>

<span class="sd">        If `write_gis` property is True, all staticgeoms are written to geojson</span>
<span class="sd">        files in a &quot;gis&quot; subfolder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Model opened in read-only mode&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticgeoms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Write staticgeom files&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">gname</span><span class="p">,</span> <span class="n">gdf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">gname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">gname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;thd&quot;</span><span class="p">,</span> <span class="s2">&quot;weir&quot;</span><span class="p">]:</span>
                        <span class="n">struct</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gdf2structures</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
                        <span class="n">utils</span><span class="o">.</span><span class="n">write_structures</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">struct</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="n">gname</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">utils</span><span class="o">.</span><span class="n">write_xy</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%8.2f</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_vector</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;staticgeoms&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="SfincsModel.read_forcing"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.read_forcing.html#hydromt_sfincs.SfincsModel.read_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">read_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read forcing files and save to `forcing` attribute.</span>
<span class="sd">        Known forcing files mentioned in the sfincs.inp configuration file are read,</span>
<span class="sd">        including: bzd/dis/precip ascii files and the netampr netcdf file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="c1"># start fresh in read-only mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tref</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tref&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">gname</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file not found at </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="c1"># read forcing</span>
            <span class="k">if</span> <span class="s2">&quot;net&quot;</span> <span class="ow">in</span> <span class="n">fname</span><span class="p">:</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>  <span class="c1"># lazy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">fname</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_timeseries</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">tref</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">gname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># read bzd/src locations</span>
                    <span class="n">fn_geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file not found at </span><span class="si">{</span><span class="n">fn_geom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_xy</span><span class="p">(</span><span class="n">fn_geom</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
                    <span class="c1"># read attribute data from gis files</span>
                    <span class="n">fn_gis</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">.geojson&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn_gis</span><span class="p">):</span>
                        <span class="n">gdf1</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fn_gis</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">gdf1</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span><span class="p">):</span>
                            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">gdf1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)[</span><span class="n">gdf1</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># to series for spatially uniform forcing</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_1d</span><span class="p">(</span><span class="n">ts</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write_forcing"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.write_forcing.html#hydromt_sfincs.SfincsModel.write_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">write_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write forcing to ascii (bzd/dis/precip) and netcdf (netampr) files.</span>
<span class="sd">        Filenames are based on the `config` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Model opened in read-only mode&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Write forcing files&quot;</span><span class="p">)</span>
            <span class="n">tref</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tref&quot;</span><span class="p">])</span>
            <span class="c1"># for nc files -&gt; time in minutes since tref</span>
            <span class="n">tref_str</span> <span class="o">=</span> <span class="n">tref</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">time</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;minutes since </span><span class="si">{</span><span class="n">tref_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="s2">&quot;float64&quot;</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>
            <span class="n">gis_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2"> forcing unknown and skipped.&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;net&quot;</span> <span class="ow">in</span> <span class="n">fname</span><span class="p">:</span>  <span class="c1"># spatially distributed forcing</span>
                    <span class="n">da</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># forcing at point locations</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">gname</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">gname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Locations missing for </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
                        <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">fn_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">utils</span><span class="o">.</span><span class="n">write_xy</span><span class="p">(</span><span class="n">fn_xy</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%8.2f</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">gis_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># spatially uniform forcing</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
                    <span class="n">utils</span><span class="o">.</span><span class="n">write_timeseries</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">tref</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">gis_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_vector</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;forcing.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">gis_names</span><span class="p">])</span></div>

<div class="viewcode-block" id="SfincsModel.read_states"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.read_states.html#hydromt_sfincs.SfincsModel.read_states">[docs]</a>    <span class="k">def</span> <span class="nf">read_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read waterlevel state (zsini) from ascii file and save to `states` attribute.</span>
<span class="sd">        The inifile if mentioned in the sfincs.inp configuration file is read.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        crs: int, CRS</span>
<span class="sd">            Coordinate reference system, if provided use instead of epsg code from sfincs.inp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="c1"># start fresh in read-only mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_states</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;inifile&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;inifile&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;inifile not found at </span><span class="si">{fn}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">shape</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spatial_attrs</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
            <span class="n">zsini</span> <span class="o">=</span> <span class="n">RasterDataArray</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">read_ascii_map</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span>  <span class="c1"># orientation S-N</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
                <span class="n">nodata</span><span class="o">=-</span><span class="mi">9999</span><span class="p">,</span>  <span class="c1"># TODO: check what a good nodatavalue is</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">zsini</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">shape</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The shape of &quot;inifile&quot; and maps does not match.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticmaps</span><span class="p">:</span>
                <span class="n">zsini</span> <span class="o">=</span> <span class="n">zsini</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_states</span><span class="p">(</span><span class="n">zsini</span><span class="p">,</span> <span class="s2">&quot;zsini&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write_states"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.write_states.html#hydromt_sfincs.SfincsModel.write_states">[docs]</a>    <span class="k">def</span> <span class="nf">write_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%8.3f</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write waterlevel state (zsini)  to ascii map file.</span>
<span class="sd">        The filenames is based on the `config` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Model opened in read-only mode&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">:</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;inifile&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;inifile&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;inifile&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># TODO check proper nodata value</span>
            <span class="k">if</span> <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># orientation is S-&gt;N</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">reindex</span><span class="p">({</span><span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">y_dim</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">ycoords</span><span class="p">))})</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">write_ascii_map</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_raster</span><span class="p">(</span><span class="s2">&quot;states&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.read_results"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.read_results.html#hydromt_sfincs.SfincsModel.read_results">[docs]</a>    <span class="k">def</span> <span class="nf">read_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;crs&quot;</span><span class="p">,</span> <span class="s2">&quot;sfincsgrid&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read results from sfincs_map.nc and sfincs_his.nc and save to the `results` attribute.</span>
<span class="sd">        The staggered nc file format is translated into hydromt.RasterDataArray formats.</span>
<span class="sd">        Additionally, hmax is computed from zsmax and zb if present.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        chunksize: int, optional</span>
<span class="sd">            chunk size along time dimension, by default 100</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fn_map</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;sfincs_map.nc&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn_map</span><span class="p">):</span>
            <span class="n">ds_face</span><span class="p">,</span> <span class="n">ds_edge</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_sfincs_map_results</span><span class="p">(</span>
                <span class="n">fn_map</span><span class="p">,</span>
                <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
                <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># save as dict of DataArray</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_results</span><span class="p">(</span><span class="n">ds_face</span><span class="p">,</span> <span class="n">split_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_results</span><span class="p">(</span><span class="n">ds_edge</span><span class="p">,</span> <span class="n">split_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">fn_his</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;sfincs_his.nc&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn_his</span><span class="p">):</span>
            <span class="n">ds_his</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_sfincs_his_results</span><span class="p">(</span>
                <span class="n">fn_his</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span>
            <span class="p">)</span>
            <span class="c1"># drop double vars (map files has priority)</span>
            <span class="n">drop_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds_his</span><span class="o">.</span><span class="n">data_vars</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="ow">or</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">drop</span><span class="p">]</span>
            <span class="n">ds_his</span> <span class="o">=</span> <span class="n">ds_his</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="n">drop_vars</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_results</span><span class="p">(</span><span class="n">ds_his</span><span class="p">,</span> <span class="n">split_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">write_raster</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;staticmaps&quot;</span><span class="p">,</span> <span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="s2">&quot;results.hmax&quot;</span><span class="p">],</span>
        <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
        <span class="n">compress</span><span class="o">=</span><span class="s2">&quot;lzw&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write model 2D raster variables to geotiff files.</span>

<span class="sd">        NOTE: these files are not used by the model by just saved for visualization/</span>
<span class="sd">        analysis purposes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variables: str, list, optional</span>
<span class="sd">            Model variables are a combination of attribute and layer (optional) using &lt;attribute&gt;.&lt;layer&gt; syntax.</span>
<span class="sd">            Known ratster attributes are [&quot;staticmaps&quot;, &quot;states&quot;, &quot;results&quot;].</span>
<span class="sd">            Different variables can be combined in a list.</span>
<span class="sd">            By default, variables is [&quot;staticmaps&quot;, &quot;states&quot;, &quot;results.hmax&quot;]</span>
<span class="sd">        root: Path, str, optional</span>
<span class="sd">            The output folder path. If None it defautls to the &lt;model_root&gt;/gis folder (Default)</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Key-word arguments passed to hydromt.RasterDataset.to_raster(driver=&#39;GTiff&#39;, compress=&#39;lzw&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check variables</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">variables</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;variables&quot; should be a list, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="c1"># check root</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="c1"># save to file</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">vsplit</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">vsplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># empty</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write raster file(s) for </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> to &#39;gis&#39; subfolder&quot;</span><span class="p">)</span>
            <span class="n">layers</span> <span class="o">=</span> <span class="n">vsplit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vsplit</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">layer</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2"> not found: skipping.&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">da</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># make sure orientation is N-&gt;S</span>
                    <span class="n">yrev</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">ycoords</span><span class="p">))</span>
                    <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">reindex</span><span class="p">({</span><span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">y_dim</span><span class="p">:</span> <span class="n">yrev</span><span class="p">})</span>
                <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">to_raster</span><span class="p">(</span>
                    <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">),</span>
                    <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span>
                    <span class="n">compress</span><span class="o">=</span><span class="n">compress</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_vector</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;staticgeoms&quot;</span><span class="p">,</span> <span class="s2">&quot;forcing.bzs&quot;</span><span class="p">,</span> <span class="s2">&quot;forcing.dis&quot;</span><span class="p">],</span>
        <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write model vector (staticgeoms) variables to geojson files.</span>

<span class="sd">        NOTE: these files are not used by the model by just saved for visualization/</span>
<span class="sd">        analysis purposes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variables: str, list, optional</span>
<span class="sd">            Staticgeoms variables. By bedault all staticgeoms are saved.</span>
<span class="sd">        root: Path, str, optional</span>
<span class="sd">            The output folder path. If None it defautls to the &lt;model_root&gt;/gis folder (Default)</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Key-word arguments passed to geopandas.GeoDataFrame.to_file(driver=&#39;GeoJSON&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>  <span class="c1"># fixed</span>
        <span class="c1"># check variables</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">variables</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;variables&quot; should be a list, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="c1"># check root</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="c1"># save to file</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">vsplit</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">vsplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># empty</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write vector file(s) for </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> to &#39;gis&#39; subfolder&quot;</span><span class="p">)</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">vsplit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vsplit</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found: skipping.&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">da</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                        <span class="n">gdf</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="o">.</span><span class="n">values</span><span class="p">()}[</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> could not be written to vector file.&quot;</span>
                        <span class="p">)</span>
                        <span class="k">pass</span>
                <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.geojson&quot;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="SfincsModel.set_staticmaps"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.set_staticmaps.html#hydromt_sfincs.SfincsModel.set_staticmaps">[docs]</a>    <span class="k">def</span> <span class="nf">set_staticmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add data to staticmaps.</span>

<span class="sd">        All layers of staticmaps must have identical spatial coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data: xarray.DataArray or xarray.Dataset</span>
<span class="sd">            new map layer to add to staticmaps</span>
<span class="sd">        name: str, optional</span>
<span class="sd">            Name of new map layer, this is used to overwrite the name of a DataArray</span>
<span class="sd">            or to select a variable from a Dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># make sure data is in S -&gt; N orientation</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">data</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">y_dim</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">ycoords</span><span class="p">))}</span>
                <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.set_forcing_1d"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.set_forcing_1d.html#hydromt_sfincs.SfincsModel.set_forcing_1d">[docs]</a>    <span class="k">def</span> <span class="nf">set_forcing_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set 1D forcing and update staticgoms and config accordingly.</span>

<span class="sd">        For waterlevel and discharge forcing point locations are required to set the</span>
<span class="sd">        combined src/dis and bnd/bzs files. If only point locations (and no timeseries)</span>
<span class="sd">        are given a dummy timeseries with zero values is set.</span>

<span class="sd">        If ts and xy are both None, the</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name: {&#39;waterlevel&#39;, &#39;discharge&#39;, &#39;precip&#39;}</span>
<span class="sd">            Name of forcing type.</span>
<span class="sd">        ts: pandas.DataFrame, xarray.DataArray</span>
<span class="sd">            Timeseries data. If DataArray it should contain time and index dims; if</span>
<span class="sd">            DataFrame the index should be a datetime index and the columns the location</span>
<span class="sd">            index.</span>
<span class="sd">        xy: geopandas.GeoDataFrame</span>
<span class="sd">            Forcing point locations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fname</span><span class="p">,</span> <span class="n">gname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FORCING</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;net&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown forcing &quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;, select from </span><span class="si">{</span><span class="n">names</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># sort out ts and xy types</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">fname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># spatially uniform forcing</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">GeoDataArray</span><span class="o">.</span><span class="n">from_gdf</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">index_dim</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_ts</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># dummy timeseries</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">xy</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index_dim</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="n">ts</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">IndexVariable</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: Unknown type for ts </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="si">}</span><span class="s2"> should be xarray.DataArray.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># check if locations (bzs / dis)</span>
        <span class="k">if</span> <span class="n">gname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="c1"># make sure time is on last dim</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index_dim</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">time_dim</span><span class="p">)</span>
            <span class="c1"># set crs</span>
            <span class="k">if</span> <span class="n">ts</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">ts</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">crs</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">:</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">())</span>
            <span class="c1"># fix order based on x_dim after setting crs (for comparibility between OS)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">x_dim</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># reset index</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index_dim</span>
            <span class="n">ts</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">IndexVariable</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ts</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: setting </span><span class="si">{</span><span class="n">gname</span><span class="si">}</span><span class="s2"> data for </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> points.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">dims</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: uniform forcing should have single &#39;time&#39; dimension.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># set forcing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: setting </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2"> data.&quot;</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span></div>

    <span class="c1">## model configuration</span>

    <span class="k">def</span> <span class="nf">set_crs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SfincsModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_spatial_attrs</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_configread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_inp</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_configwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">write_inp</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

<div class="viewcode-block" id="SfincsModel.update_spatial_attrs"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.update_spatial_attrs.html#hydromt_sfincs.SfincsModel.update_spatial_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">update_spatial_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update geospatial `config` (sfincs.inp) attributes based on staticmaps&quot;&quot;&quot;</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>
        <span class="n">west</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;epsg&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;mmax&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;nmax&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">))</span>  <span class="c1"># dy is always positive (orientation is S -&gt; N)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;x0&quot;</span><span class="p">,</span> <span class="n">west</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;y0&quot;</span><span class="p">,</span> <span class="n">south</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.get_spatial_attrs"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.get_spatial_attrs.html#hydromt_sfincs.SfincsModel.get_spatial_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">get_spatial_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get geospatial `config` (sfincs.inp) attributes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        crs: int, CRS</span>
<span class="sd">            Coordinate reference system</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        shape: tuple of int</span>
<span class="sd">            width, height</span>
<span class="sd">        transform: Affine.transform</span>
<span class="sd">            Geospatial transform</span>
<span class="sd">        crs: pyproj.CRS</span>
<span class="sd">            Coordinate reference system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_spatial_attrs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.get_model_time"><a class="viewcode-back" href="../../generated/hydromt_sfincs.SfincsModel.get_model_time.html#hydromt_sfincs.SfincsModel.get_model_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_model_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return (tstart, tstop) tuple with parsed model start and end time&quot;&quot;&quot;</span>
        <span class="n">tstart</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstart&quot;</span><span class="p">])</span>
        <span class="n">tstop</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span></div>

    <span class="c1">## helper method</span>

    <span class="k">def</span> <span class="nf">_dummy_ts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_model_time</span><span class="p">())),</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">gdf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">fill_value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">GeoDataArray</span><span class="o">.</span><span class="n">from_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ts</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Deltares.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>