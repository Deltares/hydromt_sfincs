

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>hydromt_sfincs.sfincs &mdash; hydromt_sfincs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> hydromt_sfincs
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/sfincs.html">SFINCS model components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/sfincs_coastal.html">Setting up a coastal model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/sfincs_riverine.html">Setting up a riverine model</a></li>
</ul>
<p class="caption"><span class="caption-text">References &amp; Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/api_index.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Whatâ€™s new</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">hydromt_sfincs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>hydromt_sfincs.sfincs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for hydromt_sfincs.sfincs</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">basename</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">hydromt</span> <span class="kn">import</span> <span class="n">vector</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">configparser</span> <span class="kn">import</span> <span class="n">ConfigParser</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.warp</span> <span class="kn">import</span> <span class="n">transform_bounds</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">box</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pyproj</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">hydromt</span>
<span class="kn">from</span> <span class="nn">hydromt.models.model_api</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">hydromt.vector</span> <span class="kn">import</span> <span class="n">GeoDataArray</span>
<span class="kn">from</span> <span class="nn">hydromt.raster</span> <span class="kn">import</span> <span class="n">RasterDataset</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">workflows</span><span class="p">,</span> <span class="n">DATADIR</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SfincsModel&quot;</span><span class="p">]</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ConfigParserSfincs</span><span class="p">(</span><span class="n">ConfigParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">comment_prefixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">),</span>
            <span class="n">inline_comment_prefixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">),</span>
            <span class="n">allow_no_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">delimiters</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ConfigParserSfincs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">defaults</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">add_header</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">header_name</span><span class="o">=</span><span class="s2">&quot;dummy&quot;</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;add header&quot;&quot;&quot;</span>
            <span class="k">yield</span> <span class="s2">&quot;[</span><span class="si">{}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ConfigParserSfincs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">add_header</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">section_name</span><span class="p">,</span> <span class="n">section_items</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write a single section to the specified `fp&#39;.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">section_items</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span><span class="o">.</span><span class="n">before_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section_name</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&lt;15}</span><span class="s2"> </span><span class="si">{:&lt;1}</span><span class="s2"> </span><span class="si">{:&lt;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delimiters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="SfincsModel"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.html#hydromt_sfincs.sfincs.SfincsModel">[docs]</a><span class="k">class</span> <span class="nc">SfincsModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_NAME</span> <span class="o">=</span> <span class="s2">&quot;sfincs&quot;</span>
    <span class="n">_GEOMS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;waterlevel&quot;</span><span class="p">:</span> <span class="s2">&quot;bnd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;discharge&quot;</span><span class="p">:</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gauges&quot;</span><span class="p">:</span> <span class="s2">&quot;obs&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">_1DFORCING</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;waterlevel&quot;</span><span class="p">:</span> <span class="s2">&quot;bzs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;discharge&quot;</span><span class="p">:</span> <span class="s2">&quot;dis&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">_2DFORCING</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;precip&quot;</span><span class="p">:</span> <span class="s2">&quot;netampr&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">_MAPS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;elevtn&quot;</span><span class="p">:</span> <span class="s2">&quot;dep&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="s2">&quot;msk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curve_number&quot;</span><span class="p">:</span> <span class="s2">&quot;scs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;manning&quot;</span><span class="p">:</span> <span class="s2">&quot;manning&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">_FOLDERS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>  <span class="c1"># to create root folder without subfolders</span>
    <span class="n">_dtfmt</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2"> %H%M%S&quot;</span>
    <span class="n">_CONF</span> <span class="o">=</span> <span class="s2">&quot;sfincs.inp&quot;</span>
    <span class="n">_DATADIR</span> <span class="o">=</span> <span class="n">DATADIR</span>
    <span class="n">_ATTRS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;dep&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;elevation&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">},</span>
        <span class="s2">&quot;msk&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">},</span>
        <span class="s2">&quot;scs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;curve number&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">},</span>
        <span class="s2">&quot;man&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;manning roughness&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">},</span>
        <span class="s2">&quot;bzs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;waterlevel&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m+EGM96&quot;</span><span class="p">},</span>
        <span class="s2">&quot;dis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;discharge&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m3.s-1&quot;</span><span class="p">},</span>
        <span class="s2">&quot;netampr&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;mm.hr-1&quot;</span><span class="p">},</span>
    <span class="p">}</span>

<div class="viewcode-block" id="SfincsModel.__init__"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.html#hydromt_sfincs.sfincs.SfincsModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="n">config_fn</span><span class="o">=</span><span class="s2">&quot;sfincs.inp&quot;</span><span class="p">,</span>
        <span class="n">write_gis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">data_libs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">deltares_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">artifact_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The SFINCS model class (SfincsModel) contains methods to read, write, setup and edit</span>
<span class="sd">        `SFINCS &lt;https://sfincs.readthedocs.io/en/latest/&gt;`_ models.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root: str, Path, optional</span>
<span class="sd">            Path to model folder</span>
<span class="sd">        mode: {&#39;w&#39;, &#39;r+&#39;, &#39;r&#39;}</span>
<span class="sd">            Open model in write, append or reading mode, by default &#39;w&#39;</span>
<span class="sd">        config_fn: str, Path, optional</span>
<span class="sd">            Filename of model config file, by default &quot;sfincs.inp&quot;</span>
<span class="sd">        write_gis: bool</span>
<span class="sd">            Write model files additionally to geotiff and geojson, by default True</span>
<span class="sd">        opt: dict</span>
<span class="sd">            Values for model setup options, used when called from CLI</span>
<span class="sd">        sources: dict</span>
<span class="sd">            Library with references to data sources</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># model paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span> <span class="o">=</span> <span class="n">write_gis</span>
        <span class="k">if</span> <span class="n">write_gis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_FOLDERS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;gis&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">config_fn</span><span class="o">=</span><span class="n">config_fn</span><span class="p">,</span>
            <span class="n">data_libs</span><span class="o">=</span><span class="n">data_libs</span><span class="p">,</span>
            <span class="n">deltares_data</span><span class="o">=</span><span class="n">deltares_data</span><span class="p">,</span>
            <span class="n">artifact_data</span><span class="o">=</span><span class="n">artifact_data</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_basemaps"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.setup_basemaps.html#hydromt_sfincs.sfincs.SfincsModel.setup_basemaps">[docs]</a>    <span class="k">def</span> <span class="nf">setup_basemaps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">region</span><span class="p">,</span>
        <span class="n">res</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;utm&quot;</span><span class="p">,</span>
        <span class="n">basemaps_fn</span><span class="o">=</span><span class="s2">&quot;merit_hydro&quot;</span><span class="p">,</span>
        <span class="n">basin_index_fn</span><span class="o">=</span><span class="s2">&quot;merit_hydro_index&quot;</span><span class="p">,</span>
        <span class="n">landmask_fn</span><span class="o">=</span><span class="s2">&quot;osm_landareas&quot;</span><span class="p">,</span>
        <span class="n">bathymetry_fn</span><span class="o">=</span><span class="s2">&quot;gebco&quot;</span><span class="p">,</span>
        <span class="n">mdt_fn</span><span class="o">=</span><span class="s2">&quot;dtu10mdt_egm96&quot;</span><span class="p">,</span>
        <span class="n">merge_buffer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">mask_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dep_contour</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define model region and setup combined bathymetry/elevation and mask static model layers.</span>

<span class="sd">        To merge elevation and bathymetry data, elevation data is taken for land and</span>
<span class="sd">        bathymetry for sea cells, see ``landmask_fn``. An optional ``merge_buffer``</span>
<span class="sd">        can be set to define a buffer aourd the land cells where the bathymetry is</span>
<span class="sd">        estimated from a linear interpolation of elevation and bathymetry data.</span>

<span class="sd">        The model mask defines 0) Inactive, 1) active, and 2) waterlevel boundary cells.</span>
<span class="sd">        Active cells set based on valid bathymetry/elevation values: a) within ``mask_fn``,</span>
<span class="sd">        b) within ``region`` for land and above the ``dep_contour`` for sea cells, or</span>
<span class="sd">        c) within ``region``. Water level boundary cells defined by sea cells adjecent</span>
<span class="sd">        to active cells.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **dep** map: combined elevation/bathymetry [m+ref]</span>
<span class="sd">        * **mask** map: mask [-]</span>
<span class="sd">        * **region** geom: polygon of active model region</span>
<span class="sd">        * **bbox** geom: polygon bounding box of active model region</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        region : dict</span>
<span class="sd">            Dictionary describing region of interest, e.g. {&#39;bbox&#39;: [xmin, ymin, xmax, ymax]}</span>
<span class="sd">            See :py:meth:`~hydromt.cli.parse_region()` for all options</span>
<span class="sd">        res : float</span>
<span class="sd">            Model resolution [m], by default 100 m.</span>
<span class="sd">        crs : str, int</span>
<span class="sd">            Model Coordinate Reference System as epsg code, by default &#39;utm&#39; in which</span>
<span class="sd">            case the region centroid UTM zone is used.</span>
<span class="sd">        basemaps_fn : str</span>
<span class="sd">            Path or data source name for hydrography raster data, by default &#39;merit_hydro&#39;.</span>

<span class="sd">            * Required variables: [&#39;elevtn&#39;].</span>
<span class="sd">            * Required variables to delineate a (sub)basin: [&#39;flwdir&#39;, &#39;uparea&#39;, &#39;basins&#39;]</span>
<span class="sd">        landmask_fn : str, optional</span>
<span class="sd">            Path or data source name for land mask polygon, by default &#39;osm_landareas&#39;.</span>
<span class="sd">            Valid elevation cells within this geometry define land cells, all other cells</span>
<span class="sd">            are sea cells.</span>
<span class="sd">        bathymetry_fn : str, optional</span>
<span class="sd">            Path or data source name for bathymetry raster data, by default &#39;gebco&#39;.</span>
<span class="sd">            Bathymetry data with values smaller than zero are used to fill the area</span>
<span class="sd">            outside the land mask.</span>

<span class="sd">            * Required variables: [&#39;elevtn&#39;]</span>
<span class="sd">        mdt_fn : str, optional</span>
<span class="sd">            Path or data source name for MDT data, by default &#39;dtu10mdt_egm96&#39;.</span>
<span class="sd">            Difference between vertical reference of elevation and bathymetry data.</span>
<span class="sd">            MDT values are Adds to the bathymetry data before merging.</span>

<span class="sd">            * Required variables: [&#39;mdt&#39;]</span>
<span class="sd">        merge_buffer : int, optional</span>
<span class="sd">            Buffer (number of cells) around land cells where the bathymetry is estimated from a linear</span>
<span class="sd">            interpolation between the elevation and bathymetry data sources, by default 0.</span>
<span class="sd">        mask_fn : str, optional</span>
<span class="sd">            Path or data source name for polygon of active cells, by default None.</span>
<span class="sd">            Region of valid cells in the</span>
<span class="sd">        dep_contour: float, optional,</span>
<span class="sd">            Minimum depth threshold for active model cells. Must be negative, by default -1.</span>
<span class="sd">        method: str, optional</span>
<span class="sd">            Method used to reproject elevation and bathymetry data, by default &#39;bilinear&#39;</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># read data (lazy!) and return dataset</span>
        <span class="n">ds_org</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">basemaps_fn</span><span class="p">,</span> <span class="n">single_var_as_array</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="c1"># get basin geometry and clip data</span>
        <span class="n">kind</span><span class="p">,</span> <span class="n">region</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">parse_region</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">basin_geom</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geom&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bbox&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;interbasin&quot;</span><span class="p">:</span>
            <span class="n">bas_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="p">[</span><span class="n">basin_index_fn</span><span class="p">]</span>
            <span class="n">basin_geom</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">get_basin_geometry</span><span class="p">(</span>
                <span class="n">ds</span><span class="o">=</span><span class="n">ds_org</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                <span class="n">basin_index</span><span class="o">=</span><span class="n">bas_index</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                <span class="o">**</span><span class="n">region</span><span class="p">,</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">geom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">geom</span> <span class="o">=</span> <span class="n">basin_geom</span>
        <span class="k">elif</span> <span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">,</span> <span class="s2">&quot;geom&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unknown region kind for SFINCS model: </span><span class="si">{kind}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;select from [&#39;bbox&#39;, &#39;geom&#39;, &#39;interbasin&#39;]&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">geom</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;SFINCS region &quot;geom&quot; has no CRS&#39;</span><span class="p">)</span>
        <span class="c1"># parse dst_crs. if &#39;utm&#39; the best utm zone is calculated based on bbox_epsg4326</span>
        <span class="n">bbox_epsg4326</span> <span class="o">=</span> <span class="n">bbox</span> <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">geom</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span><span class="o">.</span><span class="n">total_bounds</span>
        <span class="n">dst_crs</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">gis_utils</span><span class="o">.</span><span class="n">parse_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="n">bbox_epsg4326</span><span class="p">)</span>
        <span class="c1"># transfrom bbox/geom to geom with destination CRS to deal with nonlinear</span>
        <span class="c1"># transformations along domain edges when clipping</span>
        <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># to epsg required to be understood when writing GEOJSON</span>
            <span class="n">dst_geom</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">dst_crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dst_bbox</span> <span class="o">=</span> <span class="n">transform_bounds</span><span class="p">(</span><span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span> <span class="n">dst_crs</span><span class="p">,</span> <span class="o">*</span><span class="n">bbox</span><span class="p">)</span>
            <span class="n">dst_geom</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">dst_bbox</span><span class="p">)],</span> <span class="n">crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">)</span>
        <span class="c1"># reproject to destination CRS and clip to actual extent</span>
        <span class="n">da_elv</span> <span class="o">=</span> <span class="n">ds_org</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">crs</span> <span class="o">!=</span> <span class="n">dst_crs</span><span class="p">:</span>
            <span class="n">da_elv</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">clip_geom</span><span class="p">(</span><span class="n">geom</span><span class="o">=</span><span class="n">dst_geom</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                <span class="o">.</span><span class="n">load</span><span class="p">()</span>
                <span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span>
                    <span class="n">dst_res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">clip_geom</span><span class="p">(</span><span class="n">dst_geom</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>
                <span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span>  <span class="c1"># force nodata value to be np.nan</span>
            <span class="p">)</span>

        <span class="c1"># read and rasterize land geometry</span>
        <span class="c1"># land mask contains all valid dep values inside land geometry</span>
        <span class="k">if</span> <span class="n">landmask_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                <span class="n">landmask_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">dst_geom</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
            <span class="n">lnd_msk</span> <span class="o">=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">geometry_mask</span><span class="p">(</span><span class="n">gdf_mask</span><span class="p">,</span> <span class="n">all_touched</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">da_elv</span> <span class="o">=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lnd_msk</span><span class="p">)</span>
        <span class="n">lnd_msk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">da_elv</span><span class="p">)</span>
        <span class="n">lnd_msk</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_nodata</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># TODO generalize and move merge to workflows</span>
        <span class="c1"># merge bathymetry if bathymetry_fn where lnd_msk is True</span>
        <span class="k">if</span> <span class="n">bathymetry_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">lnd_msk</span><span class="p">):</span>
            <span class="n">da_bat</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                    <span class="n">bathymetry_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">dst_geom</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">load</span><span class="p">()</span>
                <span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reproject_like</span><span class="p">(</span><span class="n">da_elv</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
                <span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">da_bat</span> <span class="o">=</span> <span class="n">da_bat</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">da_bat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># use values below MSL only</span>
            <span class="c1"># correct vertical datum with mean dynamic topography data</span>
            <span class="k">if</span> <span class="n">mdt_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">da_mdt</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                        <span class="n">mdt_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">dst_geom</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mdt&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reproject_like</span><span class="p">(</span><span class="n">da_elv</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">mmdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">da_mdt</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">~</span><span class="n">lnd_msk</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean vertical corection from MDT: </span><span class="si">{</span><span class="n">mmdt</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">da_bat</span> <span class="o">=</span> <span class="n">da_bat</span> <span class="o">+</span> <span class="n">da_mdt</span>
            <span class="c1"># merge based on lnd_msk</span>
            <span class="n">da_elv</span> <span class="o">=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lnd_msk</span><span class="p">,</span> <span class="n">da_bat</span><span class="p">)</span>
            <span class="c1"># create buffer between data sources and interpolate for smooth boundary</span>
            <span class="k">if</span> <span class="n">merge_buffer</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lnd_msk_np</span> <span class="o">=</span> <span class="n">lnd_msk</span><span class="o">.</span><span class="n">values</span>
                <span class="n">buf_dilate</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">binary_dilation</span><span class="p">(</span>
                    <span class="n">lnd_msk_np</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">iterations</span><span class="o">=</span><span class="n">merge_buffer</span>
                <span class="p">)</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">da_elv</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">buf_dilate</span><span class="p">,</span> <span class="n">lnd_msk_np</span><span class="p">))</span>
                <span class="n">da_elv</span> <span class="o">=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">buf</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">nodata</span><span class="p">)</span>
            <span class="c1"># interpolate missing in data</span>
            <span class="n">nempty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">da_elv</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">nempty</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interpolate bathymetry at </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">nempty</span><span class="p">)</span><span class="si">}</span><span class="s2"> cells&quot;</span><span class="p">)</span>
                <span class="n">da_elv</span> <span class="o">=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">interpolate_na</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bathymetry data merged; buffer </span><span class="si">{</span><span class="n">merge_buffer</span><span class="si">}</span><span class="s2"> cells&quot;</span><span class="p">)</span>
        <span class="n">da_elv</span> <span class="o">=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
        <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_nodata</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bathymetry generated&quot;</span><span class="p">)</span>

        <span class="c1"># generate mask; valid dep cells and basin_geom should minimally be included</span>
        <span class="k">if</span> <span class="n">basin_geom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bas_msk</span> <span class="o">=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">geometry_mask</span><span class="p">(</span><span class="n">basin_geom</span><span class="p">,</span> <span class="n">all_touched</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">lnd_msk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">lnd_msk</span><span class="p">,</span> <span class="n">bas_msk</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bas_msk</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">da_elv</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="n">msk</span> <span class="o">=</span> <span class="n">lnd_msk</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="n">mask_fn</span><span class="p">:</span>
            <span class="c1"># active cells: valid dep values inside polygon AND basin</span>
            <span class="n">gdf_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span><span class="n">mask_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">dst_geom</span><span class="p">)</span>
            <span class="n">valid_msk</span> <span class="o">=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">geometry_mask</span><span class="p">(</span><span class="n">gdf_mask</span><span class="p">,</span> <span class="n">all_touched</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">msk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">valid_msk</span><span class="p">,</span> <span class="n">da_elv</span> <span class="o">!=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">nodata</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="k">elif</span> <span class="n">dep_contour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># active cells: contiguous area above depth threshold offshore OR in basin on land</span>
            <span class="n">_msk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lnd_msk</span><span class="p">,</span> <span class="n">bas_msk</span><span class="p">,</span> <span class="n">da_elv</span> <span class="o">&gt;=</span> <span class="n">dep_contour</span><span class="p">)</span>
            <span class="c1"># keep contiguous area with lnd_msk cells</span>
            <span class="n">lbls</span><span class="p">,</span> <span class="n">nlbls</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">_msk</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
            <span class="n">labs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlbls</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">lbl_valid</span> <span class="o">=</span> <span class="n">labs</span><span class="p">[</span><span class="n">ndimage</span><span class="o">.</span><span class="n">measurements</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lnd_msk</span><span class="p">,</span> <span class="n">lbls</span><span class="p">,</span> <span class="n">labs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            <span class="c1"># fill holes</span>
            <span class="n">msk</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">binary_fill_holes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">lbls</span><span class="p">,</span> <span class="n">lbl_valid</span><span class="p">))</span>

        <span class="c1"># create mask: 0) inactive; 1) active 2) h boundary cells</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">msk</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
        <span class="c1"># apply dilation to mask to get boundary around mask</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">msk</span><span class="p">,</span> <span class="o">~</span><span class="n">lnd_msk</span><span class="p">)):</span>
            <span class="n">_msk</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">binary_dilation</span><span class="p">(</span><span class="n">msk</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_msk</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">binary_erosion</span><span class="p">(</span><span class="n">msk</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="c1"># TODO: bnd@sea based on lnd_msk, include other options for non-coastal models</span>
        <span class="n">bnd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">_msk</span><span class="p">,</span> <span class="n">msk</span><span class="p">),</span> <span class="o">~</span><span class="n">lnd_msk</span><span class="p">)</span>
        <span class="n">mask</span><span class="p">[</span><span class="n">bnd</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">da_mask</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
            <span class="n">dims</span><span class="o">=</span><span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mask</span>
        <span class="p">)</span>
        <span class="n">da_mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_nodata</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># set staticmap</span>
        <span class="n">da_elv</span> <span class="o">=</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">da_mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">da_elv</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">nodata</span><span class="p">)</span>
        <span class="n">da_elv</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">],</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">da_elv</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">])</span>
        <span class="n">da_mask</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">],</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">da_mask</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_update</span><span class="p">()</span>  <span class="c1"># update geospatial header in config</span>

        <span class="c1"># update mask staticgeom</span>
        <span class="n">da_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">da_mask</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
        <span class="n">da_mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">dst_crs</span><span class="p">)</span>
        <span class="n">da_mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_nodata</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">da_mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(),</span> <span class="s2">&quot;region&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">da_mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">box</span><span class="p">,</span> <span class="s2">&quot;bbox&quot;</span><span class="p">)</span>

        <span class="c1"># log n active cells</span>
        <span class="n">ncells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">msk</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mask generated; </span><span class="si">{</span><span class="n">ncells</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2"> active cells.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_river_inflow"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.setup_river_inflow.html#hydromt_sfincs.sfincs.SfincsModel.setup_river_inflow">[docs]</a>    <span class="k">def</span> <span class="nf">setup_river_inflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">river_upa</span><span class="o">=</span><span class="mf">25.0</span><span class="p">,</span> <span class="n">basemaps_fn</span><span class="o">=</span><span class="s2">&quot;merit_hydro&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup river inflow (source) points where a river enters the model domain.</span>

<span class="sd">        NOTE: to ensure a river only enters the model domain once, use the &#39;basin&#39;,</span>
<span class="sd">        subbasin, or outlet region options.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **src** geoms: discharge boundary point locations</span>
<span class="sd">        * **dis** forcing: dummy discharge timeseries</span>
<span class="sd">        * **river** geoms: river centerline (not used by SFINCS; for plotting only)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        basemaps_f: str, Path</span>
<span class="sd">            Path or data source name for hydrography raster data, by default &#39;merit_hydro&#39;.</span>

<span class="sd">            * Required layers: [&#39;uparea&#39;, &#39;flwdir&#39;].</span>
<span class="sd">        river_upa: float, optional</span>
<span class="sd">            Mimimum upstream area threshold [km2] to define river cells, by default 25 km2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO reproject flwdir, then burn rivers in D4</span>
        <span class="c1"># read data and rasterize basin mask &gt; used to initialize flwdir in river workflow</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">basemaps_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">src_crs</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span>
        <span class="n">dst_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span>
        <span class="n">basmsk</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">geometry_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Get river cells for inflow source points; upstream area threshold: </span><span class="si">{</span><span class="n">river_upa</span><span class="si">}</span><span class="s2"> km2.&quot;</span>
        <span class="p">)</span>
        <span class="c1"># initialize flwdir with river cells only (including outside basin)</span>
        <span class="n">rivmsk</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">river_upa</span>
        <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rivmsk</span>
        <span class="n">flwdir</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">flw</span><span class="o">.</span><span class="n">flwdir_from_da</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;flwdir&quot;</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Set river source points (.src).&quot;</span><span class="p">)</span>
        <span class="c1"># set source points at headwater indices on river</span>
        <span class="c1"># find river cells outside model domain</span>
        <span class="n">idxs0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">rivmsk</span><span class="p">,</span> <span class="o">~</span><span class="n">basmsk</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># snap to first downsteam cell in model domain</span>
        <span class="n">idxs_source</span> <span class="o">=</span> <span class="n">flwdir</span><span class="o">.</span><span class="n">snap</span><span class="p">(</span><span class="n">idxs</span><span class="o">=</span><span class="n">idxs0</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">basmsk</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">idxs_source</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">idxs_source</span><span class="p">[</span><span class="n">basmsk</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idxs_source</span><span class="p">]])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxs_source</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">source_xy</span> <span class="o">=</span> <span class="n">flwdir</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">idxs_source</span><span class="p">)</span>
            <span class="n">gdf_src</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
                <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="o">*</span><span class="n">source_xy</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">src_crs</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">dst_crs</span><span class="p">)</span>
            <span class="n">gdf_src</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idxs_source</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> river inflow point locations set.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf_src</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="s2">&quot;discharge&quot;</span><span class="p">])</span>
            <span class="c1"># set dummy timeseries to keep valid sfincs model</span>
            <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_ts</span><span class="p">(</span><span class="n">gdf_src</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;discharge&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_forcing_1d</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;discharge&quot;</span><span class="p">)</span>

        <span class="c1"># vectorize river</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vectorize river.&quot;</span><span class="p">)</span>
        <span class="n">feats</span> <span class="o">=</span> <span class="n">flwdir</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">basmsk</span><span class="p">,</span> <span class="n">rivmsk</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">gdf_riv</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">src_crs</span><span class="p">)</span>
        <span class="n">gdf_riv</span> <span class="o">=</span> <span class="n">gdf_riv</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">dst_crs</span><span class="p">)</span>
        <span class="n">gdf_riv</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">gdf_riv</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># one based index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf_riv</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rivers&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_river_outflow"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.setup_river_outflow.html#hydromt_sfincs.sfincs.SfincsModel.setup_river_outflow">[docs]</a>    <span class="k">def</span> <span class="nf">setup_river_outflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">river_upa</span><span class="o">=</span><span class="mf">25.0</span><span class="p">,</span> <span class="n">outflow_width</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">basemaps_fn</span><span class="o">=</span><span class="s2">&quot;merit_hydro&quot;</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup river outflow boundary (msk=3) where a river flows out of the model domain.</span>

<span class="sd">        Adds / edits model layers:</span>

<span class="sd">        * **msk** map: edited by adding outflow points (msk=3)</span>
<span class="sd">        * **river_out** geoms: river centerline (not used by SFINCS; for plotting only)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        basemaps_f: str, Path</span>
<span class="sd">            Path or data source name for hydrography raster data, by default &#39;merit_hydro&#39;.</span>

<span class="sd">            * Required layers: [&#39;uparea&#39;, &#39;flwdir&#39;].</span>
<span class="sd">        outflow_width: int, optional</span>
<span class="sd">            The width [m] of the outflow boundary in the SFINCS msk file.</span>
<span class="sd">            By default 2km, i.e.: 1km to each side of the outflow point.</span>
<span class="sd">        river_upa: float, optional</span>
<span class="sd">            Mimimum upstream area threshold [km2] to define river cells, by default 25 km2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># read data and rasterize basin mask &gt; used to initialize flwdir in river workflow</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">basemaps_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">src_crs</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span>
        <span class="n">dst_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span>
        <span class="n">basmsk</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">geometry_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Get river cells for outflow points; upstream area threshold: </span><span class="si">{</span><span class="n">river_upa</span><span class="si">}</span><span class="s2"> km2.&quot;</span>
        <span class="p">)</span>
        <span class="c1"># initialize flwdir with river cells only (including outside basin)</span>
        <span class="n">rivmsk</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">river_upa</span>
        <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">river_upa</span><span class="p">,</span> <span class="n">basmsk</span><span class="p">)</span>
        <span class="n">flwdir</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">flw</span><span class="o">.</span><span class="n">flwdir_from_da</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;flwdir&quot;</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># git pits at domain edge on flwdir grid</span>
        <span class="n">idxs0</span> <span class="o">=</span> <span class="n">flwdir</span><span class="o">.</span><span class="n">idxs_pit</span>
        <span class="n">basmsk_eroded</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">binary_erosion</span><span class="p">(</span><span class="n">basmsk</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="n">edge_basmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">basmsk_eroded</span><span class="p">,</span> <span class="n">basmsk</span><span class="p">)</span>
        <span class="n">idxs_outflw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">idxs0</span><span class="p">[</span><span class="n">edge_basmask</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idxs0</span><span class="p">]])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxs_outflw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Set msk=3 outflow points.&quot;</span><span class="p">)</span>
            <span class="n">da_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]]</span>
            <span class="n">gdf_outflw</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
                <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="o">*</span><span class="n">flwdir</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">idxs_outflw</span><span class="p">)),</span> <span class="n">crs</span><span class="o">=</span><span class="n">src_crs</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">dst_crs</span><span class="p">)</span>
            <span class="c1"># apply buffer</span>
            <span class="n">gdf_outflw_buf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
                <span class="n">geometry</span><span class="o">=</span><span class="n">gdf_outflw</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">outflow_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">gdf_outflw</span><span class="o">.</span><span class="n">crs</span>
            <span class="p">)</span>
            <span class="c1"># find intersect of buffer and model grid</span>
            <span class="n">msk</span> <span class="o">=</span> <span class="n">da_mask</span><span class="o">.</span><span class="n">values</span>
            <span class="n">msk_eroded</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">binary_erosion</span><span class="p">(</span><span class="n">msk</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
            <span class="n">edge_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">msk_eroded</span><span class="p">,</span> <span class="n">msk</span><span class="p">)</span>
            <span class="n">outflw_buf</span> <span class="o">=</span> <span class="n">da_mask</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">geometry_mask</span><span class="p">(</span><span class="n">gdf_outflw_buf</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="n">outflw_msk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">outflw_buf</span><span class="p">,</span> <span class="n">edge_model</span><span class="p">)</span>
            <span class="c1"># assign mask == 3 boundary and update staticmaps</span>
            <span class="n">msk</span><span class="p">[</span><span class="n">outflw_msk</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">da_mask</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">msk</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">da_mask</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs_outflw</span><span class="p">)</span><span class="si">}</span><span class="s2"> river outflow point locations set.&quot;</span><span class="p">)</span>

        <span class="c1"># vectorize river</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vectorize rivers used for setting outflow points.&quot;</span><span class="p">)</span>
        <span class="n">feats</span> <span class="o">=</span> <span class="n">flwdir</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">basmsk</span><span class="p">,</span> <span class="n">rivmsk</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">gdf_riv</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">src_crs</span><span class="p">)</span>
        <span class="n">gdf_riv</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">gdf_riv</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># one based index</span>
        <span class="n">gdf_riv</span> <span class="o">=</span> <span class="n">gdf_riv</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">dst_crs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf_riv</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rivers_out&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_cn_infiltration"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.setup_cn_infiltration.html#hydromt_sfincs.sfincs.SfincsModel.setup_cn_infiltration">[docs]</a>    <span class="k">def</span> <span class="nf">setup_cn_infiltration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cn_fn</span><span class="o">=</span><span class="s2">&quot;gcn250&quot;</span><span class="p">,</span> <span class="n">antecedent_runoff_conditions</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup model curve number map from gridded curve number map.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **scs** map: curve number for infiltration</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        cn_fn: str, optional</span>
<span class="sd">            Name of gridded curve number map.</span>

<span class="sd">            * Required layers without antecedent runoff conditions: [&#39;cn&#39;]</span>
<span class="sd">            * Required layers with antecedent runoff conditions: [&#39;cn_dry&#39;, &#39;cn_avg&#39;, &#39;cn_wet&#39;]</span>
<span class="sd">        antecedent_runoff_conditions: {&#39;dry&#39;, &#39;avg&#39;, &#39;wet&#39;}, optional</span>
<span class="sd">            Antecedent runoff conditions.</span>
<span class="sd">            None if data has no atecedent runoff conditions.</span>
<span class="sd">            By default `avg`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get data</span>
        <span class="n">v</span> <span class="o">=</span> <span class="s2">&quot;cn&quot;</span>
        <span class="k">if</span> <span class="n">antecedent_runoff_conditions</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cn_</span><span class="si">{</span><span class="n">antecedent_runoff_conditions</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">da_org</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">cn_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">da_msk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># reproject using median</span>
        <span class="c1"># force nodata value to be 100 (zero infiltration)</span>
        <span class="n">da_scs</span> <span class="o">=</span> <span class="n">da_org</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reproject_like</span><span class="p">(</span><span class="n">da_msk</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;med&quot;</span><span class="p">)</span>
        <span class="n">da_scs</span> <span class="o">=</span> <span class="n">da_scs</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="c1"># mask and set</span>
        <span class="n">da_scs</span> <span class="o">=</span> <span class="n">da_scs</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">da_msk</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
        <span class="n">da_scs</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">set_nodata</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
        <span class="c1"># set staticmaps</span>
        <span class="n">sfincs_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;curve_number&quot;</span><span class="p">]</span>
        <span class="n">da_scs</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sfincs_name</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">da_scs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">sfincs_name</span><span class="p">)</span>
        <span class="c1"># update config: remove default infiltration values and set cn map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;qinf&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_manning_roughness"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.setup_manning_roughness.html#hydromt_sfincs.sfincs.SfincsModel.setup_manning_roughness">[docs]</a>    <span class="k">def</span> <span class="nf">setup_manning_roughness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lulc_fn</span><span class="o">=</span><span class="s2">&quot;vito&quot;</span><span class="p">,</span> <span class="n">map_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup model curve number map from gridded curve number map.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **man** map: manning roughness coefficient</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        lulc_fn: str, optional</span>
<span class="sd">            Name of landuse-landcover map.</span>

<span class="sd">            * Required layers: [&#39;lulc&#39;]</span>
<span class="sd">        map_fn: path-like, optional</span>
<span class="sd">            CSV mapping file with lulc classes in the index column and manning values</span>
<span class="sd">            in another column with &#39;N&#39; as header.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">map_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">map_fn</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">DATADIR</span><span class="p">,</span> <span class="s2">&quot;lulc&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lulc_fn</span><span class="si">}</span><span class="s2">_mapping.csv&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">map_fn</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mannng roughness mapping file not found: </span><span class="si">{</span><span class="n">map_fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">da_org</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">lulc_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lulc&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">da_msk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># reproject and reclassify</span>
        <span class="c1"># TODO use generic names for parameters</span>
        <span class="c1"># FIXME use hydromt general version!!</span>
        <span class="n">da_man</span> <span class="o">=</span> <span class="n">workflows</span><span class="o">.</span><span class="n">landuse</span><span class="p">(</span>
            <span class="n">da_org</span><span class="p">,</span> <span class="n">da_msk</span><span class="p">,</span> <span class="n">map_fn</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span>
        <span class="p">)[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span>
        <span class="c1"># mask</span>
        <span class="n">da_man</span> <span class="o">=</span> <span class="n">da_man</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">da_msk</span><span class="p">,</span> <span class="n">da_man</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">nodata</span><span class="p">)</span>
        <span class="c1"># set staticmaps</span>
        <span class="n">sfincs_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;manning&quot;</span><span class="p">]</span>
        <span class="n">da_man</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sfincs_name</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">da_man</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">sfincs_name</span><span class="p">)</span>
        <span class="c1"># update config: remove default manning values and set maning map</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;manning_land&quot;</span><span class="p">,</span> <span class="s2">&quot;manning_sea&quot;</span><span class="p">,</span> <span class="s2">&quot;rgh_lev_land&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">sfincs_name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_gauges"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.setup_gauges.html#hydromt_sfincs.sfincs.SfincsModel.setup_gauges">[docs]</a>    <span class="k">def</span> <span class="nf">setup_gauges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gauges_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup model observation point locations.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **obs** geom: observation point locations</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        gauges_fn: str, optional</span>
<span class="sd">            Path to observation points geometry file.</span>
<span class="sd">            See :py:meth:`~hydromt.open_vector`, for accepted files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gauges_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="s2">&quot;gauges&quot;</span><span class="p">]</span>
            <span class="c1"># ensure the catalog is loaded before adding any new entries</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">sources</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">gauges_fn</span><span class="p">),</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">assert_gtype</span><span class="o">=</span><span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> set based on </span><span class="si">{</span><span class="n">gauges_fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1">### FORCING</span>
<div class="viewcode-block" id="SfincsModel.setup_h_forcing"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.setup_h_forcing.html#hydromt_sfincs.sfincs.SfincsModel.setup_h_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">setup_h_forcing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gauges_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">timeseries_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mdt_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">buffer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup waterlevel boundary point locations and time series.</span>

<span class="sd">        Waterlevel gauge locations are selected from gauges_fn based on location and time.</span>
<span class="sd">        The selection on location is based on an area `buffer` m around the model region.</span>
<span class="sd">        The selection of time is based on the model config time settings.</span>
<span class="sd">        The vertical reference level of the waterlevel data can be corrected to match</span>
<span class="sd">        the dep vertical reference level with based on the `mdt_fn` mean dynamical topography.</span>

<span class="sd">        If no timeseries files is provided or the model time period is ouside the data range,</span>
<span class="sd">        dummy timeseries with zero values are set. If only a timeseries file is provided</span>
<span class="sd">        it is used to update the boundary condition at waterlevel point locations in staticgeoms</span>
<span class="sd">        with matching IDs.</span>


<span class="sd">        Adds model layers:</span>

<span class="sd">        * **bnd** geom: waterlevel gauge point locations</span>
<span class="sd">        * **bzs** forcing: waterlevel time series [m+ref]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gauges_fn: str, Path</span>
<span class="sd">            Path to points geometry or geodataset netcdf file.</span>
<span class="sd">            See :py:meth:`~hydromt.open_vector`, for accepted point geometry files.</span>
<span class="sd">            See :py:meth:`~hydromt.open_geodataset`, for accepted geodataset netcdf files.</span>

<span class="sd">            * Required variables if netcdf: [&#39;waterlevel&#39;]</span>
<span class="sd">        timeseries_fn: str, Path</span>
<span class="sd">            Path to timeseries file associated with gauges_fn. Set to None if gauges_fn</span>
<span class="sd">            is a geodataset netcdf file including timeseries data.</span>
<span class="sd">            See :py:meth:`~hydromt.open_geodataset`, for accepted files.</span>
<span class="sd">        mdt_fn: str, optional</span>
<span class="sd">            Path or data source name for mean dynamic topography data, by default &#39;dtu10mdt_egm96&#39;.</span>
<span class="sd">            Difference between vertical reference of elevation and waterlevel data,</span>
<span class="sd">            Adds to the waterlevel data before merging.</span>

<span class="sd">            * Required variables: [&#39;mdt&#39;]</span>
<span class="sd">        buffer: float</span>
<span class="sd">            Buffer around model region from which to select waterlevel gauges</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;waterlevel&quot;</span>
        <span class="n">bnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bnd</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">():</span>
            <span class="c1"># No waterlevel boundary remove bnd/bzs from sfincs.inp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: no waterlevel boundary cells in model.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_forcing_1d</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># slice time</span>
        <span class="n">tstart</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstart&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
        <span class="n">tstop</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gauges_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># read amd clip data</span>
            <span class="n">fext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">gauges_fn</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">fext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span> <span class="ow">and</span> <span class="n">fext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">driver</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>
            <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataset</span><span class="p">(</span>
                <span class="n">gauges_fn</span><span class="p">,</span>
                <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span>
                <span class="n">fn_ts</span><span class="o">=</span><span class="n">timeseries_fn</span><span class="p">,</span>
                <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
                <span class="n">time_tuple</span><span class="o">=</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="p">:</span>
                <span class="c1"># add timeseries data to existing gdf</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># create bnd point on single waterlevel boundary cell</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bnd</span><span class="p">))</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
                    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">y</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]),</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">timeseries_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">da_ts</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">open_timeseries</span><span class="p">(</span><span class="n">timeseries_fn</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
                    <span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">GeoDataArray</span><span class="o">.</span><span class="n">from_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">da_ts</span><span class="p">,</span> <span class="n">index_dim</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: add time series to gauges.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_ts</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># dummy</span>
                <span class="n">mdt_fn</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># do not correct dummy values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: add dummy data to gauges.&quot;</span><span class="p">)</span>
        <span class="c1"># correct for MDT</span>
        <span class="k">if</span> <span class="n">mdt_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">isfile</span><span class="p">(</span><span class="n">mdt_fn</span><span class="p">):</span>
            <span class="n">da_mdt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                <span class="n">mdt_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mdt&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">mdt_pnts</span> <span class="o">=</span> <span class="n">da_mdt</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">())</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">da</span> <span class="o">+</span> <span class="n">mdt_pnts</span>
            <span class="n">mdt_avg</span> <span class="o">=</span> <span class="n">mdt_pnts</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: applied MDT (avg: </span><span class="si">{</span><span class="n">mdt_avg</span><span class="si">:</span><span class="s2">+.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_forcing_1d</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_q_forcing_from_grid"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.setup_q_forcing_from_grid.html#hydromt_sfincs.sfincs.SfincsModel.setup_q_forcing_from_grid">[docs]</a>    <span class="k">def</span> <span class="nf">setup_q_forcing_from_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">discharge_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uparea_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wdw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_error</span><span class="o">=</span><span class="mf">0.1</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup discharge boundary based on gridded discharge data and pre-set</span>
<span class="sd">        river inflow locations, for instance by using the ``set_rivers()`` method.</span>

<span class="sd">        If an upstream area grid is provided the discharge boundary condition is</span>
<span class="sd">        snapped to the best fitting grid cell within a ``wdw`` neighboring cells.</span>
<span class="sd">        The best fit is dermined based on the minimal relative upstream area error if</span>
<span class="sd">        an upstream area value is available for the discharge boundary locations;</span>
<span class="sd">        otherwise it is based on maximum upstream area.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **src** geom: discharge gauge point locations</span>
<span class="sd">        * **dis** forcing: discharge time series [m3/s]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        discharge_fn: str, Path, optional</span>
<span class="sd">            Path to gridded discharge netcdf file.</span>

<span class="sd">            * Required variables: [&#39;discharge&#39; (m3/s)]</span>
<span class="sd">        uparea_fn: str, Path, optional</span>
<span class="sd">            Path to upstream area grid in gdal (e.g. geotiff) or netcdf format.</span>

<span class="sd">            * Required variables: [&#39;uparea&#39; (km2)]</span>
<span class="sd">        wdw: int, optional</span>
<span class="sd">            Window size in number of cells around discharge boundary locations</span>
<span class="sd">            to snap to, only used if ``uparea_fn`` is provided. By default 1.</span>
<span class="sd">        max_error: float, optional</span>
<span class="sd">            Maximum relative error between the discharge boundary location upstream area</span>
<span class="sd">            and the upstream area of the best fit grid cell, only used if &quot;discharge&quot;</span>
<span class="sd">            staticgeoms has a &quot;uparea&quot; column. By default 0.1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;discharge&quot;</span>
        <span class="c1"># parse time slice time</span>
        <span class="k">if</span> <span class="n">discharge_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;No discharge inflow points in staticgeoms. &quot;</span>
                <span class="s2">&quot;Run ``setup_river_inflow()`` method first to determine inflow locations.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span>
        <span class="n">tstart</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstart&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
        <span class="n">tstop</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
        <span class="n">da_q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">discharge_fn</span><span class="p">,</span>
            <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="n">buffer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">time_tuple</span><span class="o">=</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">),</span>
            <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">uparea_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">da_upa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
                <span class="n">uparea_fn</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">da_upa</span> <span class="o">=</span> <span class="n">da_upa</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">da_upa</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">x_dim</span><span class="p">:</span> <span class="n">da_q</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">x_dim</span><span class="p">,</span>
                    <span class="n">da_upa</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">y_dim</span><span class="p">:</span> <span class="n">da_q</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">y_dim</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">ds_wdw</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">da_q</span><span class="p">,</span> <span class="n">da_upa</span><span class="p">])</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">wdw</span><span class="o">=</span><span class="n">wdw</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;uparea&quot;</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: snap boundary to best uparea cell.&quot;</span><span class="p">)</span>
                <span class="n">upa0</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">))</span>
                <span class="n">upa_dff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ds_wdw</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">()</span> <span class="o">-</span> <span class="n">upa0</span><span class="p">)</span> <span class="o">/</span> <span class="n">upa0</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">upa_dff</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="s2">&quot;wdw&quot;</span><span class="p">)</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">upa_dff</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">wdw</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_error</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">valid</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">gdf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">valid</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">gdf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> inflow boundary points with a &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;rel. upstream area error smaller or equal to </span><span class="si">{</span><span class="n">max_error</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">.&quot;</span>
                        <span class="s2">&quot; Removing boundary point(s) with larger error.&quot;</span>
                    <span class="p">)</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">valid</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: snap boundary to max uparea cell.&quot;</span><span class="p">)</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">ds_wdw</span><span class="p">[</span><span class="s2">&quot;uparea&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="s2">&quot;wdw&quot;</span><span class="p">)</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
            <span class="n">da_pnt</span> <span class="o">=</span> <span class="n">ds_wdw</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">wdw</span><span class="o">=</span><span class="n">idx</span><span class="o">.</span><span class="n">load</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">valid</span><span class="p">)</span><span class="o">.</span><span class="n">reset_coords</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">da_pnt</span> <span class="o">=</span> <span class="n">da_q</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span><span class="o">.</span><span class="n">reset_coords</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span>
        <span class="c1"># set original locations; parse and update forcing</span>
        <span class="n">da_out</span> <span class="o">=</span> <span class="n">GeoDataArray</span><span class="o">.</span><span class="n">from_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">valid</span><span class="p">,</span> <span class="p">:],</span> <span class="n">da_pnt</span><span class="p">,</span> <span class="n">index_dim</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_forcing_1d</span><span class="p">(</span><span class="n">da_out</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_q_forcing"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.setup_q_forcing.html#hydromt_sfincs.sfincs.SfincsModel.setup_q_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">setup_q_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gauges_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeseries_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup discharge boundary based on point location time series.</span>

<span class="sd">        If no timeseries file is provided or dummy timeseries with zero values are set.</span>

<span class="sd">        If the timeseries file is provided, but no gauges file, the timeseries are</span>
<span class="sd">        matched with existing discharge lacations in staticgeoms, if available.</span>
<span class="sd">        These can be set for river inflow locations using the ``set_rivers()`` method.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **src** geom: discharge gauge point locations</span>
<span class="sd">        * **dis** forcing: discharge time series [m3/s]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gauges_fn, str, Path, optional</span>
<span class="sd">            Path to points geometry or geodataset netcdf file.</span>
<span class="sd">            See :py:meth:`~hydromt.open_vector`, for accecpted point geometry files.</span>
<span class="sd">            See :py:meth:`~hydromt.open_geodataset`, for accecpted geodataset netcdf files.</span>

<span class="sd">            * Required variables if netcdf: [&#39;discharge&#39;]</span>
<span class="sd">        timeseries_fn, str, Path, optional</span>
<span class="sd">            Path to timeseries file associated with gauges_fn. Set to None if gauges_fn</span>
<span class="sd">            is a geodataset netcdf file including timeseries data.</span>
<span class="sd">            See :py:meth:`~hydromt.open_geodataset`, for accecpted files.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;discharge&quot;</span>
        <span class="n">has_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span>
        <span class="c1"># time slice</span>
        <span class="n">tstart</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstart&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
        <span class="n">tstop</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gauges_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_src</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timeseries_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;No discharge inflow points in staticgeoms. &quot;</span>
                    <span class="s2">&quot;Run ``setup_river_inflow()`` method first to determine inflow locations.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_forcing_1d</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># remove dis/src from config</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">gauges_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># read amd clip data</span>
            <span class="n">fext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">gauges_fn</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">fext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span> <span class="ow">and</span> <span class="n">fext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">driver</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>
            <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataset</span><span class="p">(</span>
                <span class="n">gauges_fn</span><span class="p">,</span>
                <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                <span class="n">fn_ts</span><span class="o">=</span><span class="n">timeseries_fn</span><span class="p">,</span>
                <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
                <span class="n">time_tuple</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># read timeseries data and match with existing gdf</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">timeseries_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">da_ts</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">open_timeseries_from_table</span><span class="p">(</span>
                    <span class="n">timeseries_fn</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span>
                <span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">))</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">GeoDataArray</span><span class="o">.</span><span class="n">from_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">da_ts</span><span class="p">,</span> <span class="n">index_dim</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: add time series to preset gauges.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_ts</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># dummy timeseries</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: add dummy data to preset gauges.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_forcing_1d</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.setup_p_forcing_gridded"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.setup_p_forcing_gridded.html#hydromt_sfincs.sfincs.SfincsModel.setup_p_forcing_gridded">[docs]</a>    <span class="k">def</span> <span class="nf">setup_p_forcing_gridded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precip_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dst_res</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup gridded precipitation forcing.</span>

<span class="sd">        The input precipitation grids are reprojected to the model CRS.</span>

<span class="sd">        Adds model layers:</span>

<span class="sd">        * **netamprfile**: gridded precipitation [mm/hr]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gauges_fn, str, Path</span>
<span class="sd">            Path to precipitation rasterdataset netcdf file.</span>

<span class="sd">            * Required variables: [&#39;precip&#39; (mm)]</span>
<span class="sd">        dst_res: float</span>
<span class="sd">            output resolution (m), by default None and computed from source data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;precip&quot;</span>
        <span class="k">if</span> <span class="n">precip_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># get data for model domain and config time range</span>
        <span class="n">tstart</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstart&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
        <span class="n">tstop</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
        <span class="n">precip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
            <span class="n">precip_fn</span><span class="p">,</span>
            <span class="n">geom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="n">buffer</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">time_tuple</span><span class="o">=</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">),</span>
            <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># reproject to utm zone:</span>
        <span class="c1"># NOTE: currently SFINCS errors (stack overflow) on large files,</span>
        <span class="c1"># downscaling to model grid is not recommended</span>
        <span class="n">kwargs0</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">align</span><span class="o">=</span><span class="n">dst_res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest_index&quot;</span><span class="p">,</span>
            <span class="n">freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="s2">&quot;1H&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">kwargs0</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">precip_out</span> <span class="o">=</span> <span class="n">precip</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span>
            <span class="n">dst_crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">dst_res</span><span class="o">=</span><span class="n">dst_res</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># set correct names and attrs and add forcing</span>
        <span class="n">sfincs_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_2DFORCING</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>
        <span class="n">precip_out</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sfincs_name</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">)</span>
        <span class="n">precip_out</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Precipitation&quot;</span>  <span class="c1"># capital is important</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">precip_out</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">sfincs_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.plot_forcing"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.plot_forcing.html#hydromt_sfincs.sfincs.SfincsModel.plot_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">plot_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn_out</span><span class="o">=</span><span class="s2">&quot;forcing.png&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">kwargs0</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">kwargs0</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs0</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">axes</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">):</span>
                <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">longname</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">da</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">x_dim</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">y_dim</span><span class="p">])</span>
                <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
                <span class="n">da</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SFINCS </span><span class="si">{</span><span class="n">longname</span><span class="si">}</span><span class="s2"> boundaries (</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fn_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">fn_out</span><span class="p">):</span>
                    <span class="n">fn_out</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;figs&quot;</span><span class="p">,</span> <span class="n">fn_out</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">)):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn_out</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">225</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>

<div class="viewcode-block" id="SfincsModel.plot_basemap"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.plot_basemap.html#hydromt_sfincs.sfincs.SfincsModel.plot_basemap">[docs]</a>    <span class="k">def</span> <span class="nf">plot_basemap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fn_out</span><span class="o">=</span><span class="s2">&quot;basemap.png&quot;</span><span class="p">,</span>
        <span class="n">variable</span><span class="o">=</span><span class="s2">&quot;dep&quot;</span><span class="p">,</span>
        <span class="n">shaded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bmap</span><span class="o">=</span><span class="s2">&quot;sat&quot;</span><span class="p">,</span>
        <span class="n">zoomlevel</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">geoms</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;rivers&quot;</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;bnd&quot;</span><span class="p">,</span> <span class="s2">&quot;obs&quot;</span><span class="p">],</span>
        <span class="n">geom_kwargs</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">legend_kwargs</span><span class="o">=</span><span class="p">{},</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span><span class="p">,</span> <span class="n">patheffects</span>
        <span class="kn">import</span> <span class="nn">cartopy.io.img_tiles</span> <span class="k">as</span> <span class="nn">cimgt</span>
        <span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>

        <span class="c1"># read crs and utm zone &gt; convert to cartopy</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span>
        <span class="n">wkt</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_wkt</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;UTM zone &quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wkt</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Model CRS UTM zone not found.&quot;</span><span class="p">)</span>
        <span class="n">utm_zone</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_wkt</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;UTM zone &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">utm</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">UTM</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">utm_zone</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span> <span class="s2">&quot;S&quot;</span> <span class="ow">in</span> <span class="n">utm_zone</span><span class="p">)</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mf">2e3</span><span class="p">)</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">)[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>

        <span class="c1"># create fig with geo-axis and set background</span>
        <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">ycoords</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">xcoords</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">utm</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">extent</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">utm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bmap</span> <span class="o">==</span> <span class="s2">&quot;sat&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_image</span><span class="p">(</span><span class="n">cimgt</span><span class="o">.</span><span class="n">QuadtreeTiles</span><span class="p">(),</span> <span class="n">zoomlevel</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">bmap</span> <span class="o">==</span> <span class="s2">&quot;osm&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_image</span><span class="p">(</span><span class="n">cimgt</span><span class="o">.</span><span class="n">OSM</span><span class="p">(),</span> <span class="n">zoomlevel</span><span class="p">)</span>

        <span class="c1"># make nice cmap</span>
        <span class="k">if</span> <span class="s2">&quot;cmap&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s2">&quot;norm&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">variable</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]:</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">da</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">quantile</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
                <span class="n">c_bat</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">terrain</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
                <span class="n">c_dem</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">terrain</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">vmin</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">c_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_bat</span><span class="p">,</span> <span class="n">c_dem</span><span class="p">))</span>
                    <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;bat_dem&quot;</span><span class="p">,</span> <span class="n">c_all</span><span class="p">)</span>
                    <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vcenter</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;dem&quot;</span><span class="p">,</span> <span class="n">c_dem</span><span class="p">)</span>
                    <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                <span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span>
            <span class="n">da</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="n">utm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">shaded</span> <span class="ow">and</span> <span class="n">variable</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;elevtn&quot;</span><span class="p">]:</span>
                <span class="n">ls</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">LightSource</span><span class="p">(</span><span class="n">azdeg</span><span class="o">=</span><span class="mi">315</span><span class="p">,</span> <span class="n">altdeg</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
                <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">res</span>
                <span class="n">_rgb</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span>
                    <span class="n">da</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">norm</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;norm&quot;</span><span class="p">],</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">],</span>
                    <span class="n">blend_mode</span><span class="o">=</span><span class="s2">&quot;soft&quot;</span><span class="p">,</span>
                    <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span>
                    <span class="n">dy</span><span class="o">=</span><span class="n">dy</span><span class="p">,</span>
                    <span class="n">vert_exag</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">rgb</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
                    <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;rgb&quot;</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">_rgb</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">coords</span>
                <span class="p">)</span>
                <span class="n">rgb</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">da</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">rgb</span><span class="p">)</span>
                <span class="n">rgb</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="n">utm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># TODO add vectorized boundary (points) from msk==2 and msk==3.</span>

        <span class="c1"># add geoms</span>
        <span class="n">geom_kwargs0</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rivers&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">),</span>
            <span class="s2">&quot;rivers_out&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">),</span>
            <span class="s2">&quot;bnd&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s2">&quot;src&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s2">&quot;obs&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">geom_kwargs0</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">geom_kwargs</span><span class="p">)</span>
        <span class="n">ann_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span>
                <span class="n">patheffects</span><span class="o">.</span><span class="n">Stroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">),</span>
                <span class="n">patheffects</span><span class="o">.</span><span class="n">Normal</span><span class="p">(),</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">geoms</span><span class="p">:</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">gdf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">annotate</span> <span class="o">=</span> <span class="n">geom_kwargs0</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;annotate&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="o">**</span><span class="n">geom_kwargs0</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">annotate</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="o">**</span><span class="n">ann_kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># title and labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y coordinate UTM zone </span><span class="si">{</span><span class="n">utm_zone</span><span class="si">}</span><span class="s2"> [m]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x coordinate UTM zone </span><span class="si">{</span><span class="n">utm_zone</span><span class="si">}</span><span class="s2"> [m]&quot;</span><span class="p">)</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;base&quot;</span> <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">variable</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SFINCS </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> map&quot;</span><span class="p">)</span>
        <span class="c1"># NOTE without defined loc it takes forever to find a &#39;best&#39; location</span>
        <span class="n">legend_kwargs0</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Legend&quot;</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">legend_kwargs0</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fn_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">fn_out</span><span class="p">):</span>
                <span class="n">fn_out</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;figs&quot;</span><span class="p">,</span> <span class="n">fn_out</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_out</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn_out</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">225</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

    <span class="c1"># I/O</span>
<div class="viewcode-block" id="SfincsModel.read"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.read.html#hydromt_sfincs.sfincs.SfincsModel.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to read the complete model schematization and configuration from file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_staticmaps</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_staticgeoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_forcing</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Model read&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.write.html#hydromt_sfincs.sfincs.SfincsModel.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to write the complete model schematization and configuration to file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write model data to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_staticmaps</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_staticgeoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_forcing</span><span class="p">()</span></div>

<div class="viewcode-block" id="SfincsModel.read_staticmaps"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.read_staticmaps.html#hydromt_sfincs.sfincs.SfincsModel.read_staticmaps">[docs]</a>    <span class="k">def</span> <span class="nf">read_staticmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read and SFNCS binary staticmaps</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        crs : coordinate ref. system</span>
<span class="sd">            this crs is assigned to the staticmaps, by default read from config file.</span>
<span class="sd">        nodata : float, optional</span>
<span class="sd">            assigned to missing values (mask = 0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># retrieve rows and cols</span>
        <span class="k">if</span> <span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;epsg&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">crs</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;epsg&quot;</span><span class="p">)))</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;mmax&quot;</span><span class="p">]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;nmax&quot;</span><span class="p">]</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;dx&quot;</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;dy&quot;</span><span class="p">]</span>
        <span class="n">west</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;x0&quot;</span><span class="p">]</span>
        <span class="n">south</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;y0&quot;</span><span class="p">]</span>
        <span class="n">rotdeg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span>  <span class="c1"># clockwise rotation in degrees</span>
        <span class="k">if</span> <span class="n">rotdeg</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Rotated grids cannot be parsed yet.&quot;</span><span class="p">)</span>
        <span class="c1"># TODO: extend to use rotated grids with rotated affine</span>
        <span class="c1">#     # code below generates a 2D coordinate grids.</span>
        <span class="c1">#     xx = np.linspace(0, dx * (cols - 1), cols)</span>
        <span class="c1">#     yy = np.linspace(0, dy * (rows - 1), rows)</span>
        <span class="c1">#     xi, yi = np.meshgrid(xx, yy)</span>
        <span class="c1">#     rot = rotdeg * np.pi / 180</span>
        <span class="c1">#     # xgrid and ygrid not used for now</span>
        <span class="c1">#     xgrid = x0 + np.cos(rot) * xi - np.sin(rot) * yi</span>
        <span class="c1">#     ygrid = y0 + np.sin(rot) * xi + np.cos(rot) * yi</span>
        <span class="c1"># ...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">north</span> <span class="o">=</span> <span class="n">south</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">rows</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">from_origin</span><span class="p">(</span><span class="n">west</span><span class="p">,</span> <span class="n">north</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>

        <span class="c1"># read raw numbers and reshape to 2D arrays</span>
        <span class="n">fn_ind</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indexfile&quot;</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn_ind</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.ind path </span><span class="si">{</span><span class="n">fn_ind</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">fn_ind</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;u4&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># convert to zero based index</span>

        <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;msk&quot;</span><span class="p">:</span> <span class="s2">&quot;u1&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">mvs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;msk&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;scs&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">data_vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">sfincs_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2"> path </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sfincs_name</span><span class="p">,</span> <span class="s2">&quot;f4&quot;</span><span class="p">)</span>
            <span class="n">mv</span> <span class="o">=</span> <span class="n">mvs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sfincs_name</span><span class="p">,</span> <span class="n">nodata</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="p">),</span> <span class="n">mv</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
            <span class="n">data_vars</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">sfincs_name</span><span class="p">:</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mv</span><span class="p">)})</span>

        <span class="c1"># create dataset and set as staticmaps</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">RasterDataset</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
            <span class="n">data_vars</span><span class="o">=</span><span class="n">data_vars</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
            <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
            <span class="n">ds</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_staticmaps</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write_staticmaps"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.write_staticmaps.html#hydromt_sfincs.sfincs.SfincsModel.write_staticmaps">[docs]</a>    <span class="k">def</span> <span class="nf">write_staticmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write_figs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write binary SFINCS staticmaps.</span>
<span class="sd">        NOTE: This will only write the bathymetry, mask and indices data,</span>
<span class="sd">        not the geographic information</span>
<span class="sd">        If write_gis, write staticmaps to gis geotif as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Model opened in read-only&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Derive indices from mask.&quot;</span><span class="p">)</span>
        <span class="c1"># bin files index of sfincs is transposed compared to numpy 2D arrays</span>
        <span class="n">msk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">msk_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">msk</span><span class="p">[</span><span class="n">msk</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;u1&quot;</span><span class="p">)</span>
        <span class="c1"># the index number file of sfincs starts with the length of the index numbers,</span>
        <span class="c1"># add that below</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">msk</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># one-based index</span>
        <span class="n">indices_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)),</span> <span class="n">indices</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;u4&quot;</span><span class="p">)</span>
        <span class="c1"># write to file</span>
        <span class="n">fn_msk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;mskfile&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fn_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;indexfile&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">msk_</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="n">fn_msk</span><span class="p">)</span>
        <span class="n">indices_</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="n">fn_ind</span><span class="p">)</span>

        <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dep&quot;</span><span class="p">:</span> <span class="s2">&quot;f4&quot;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">sfincs_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sfincs_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAPS</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="n">fn_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fn_out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fn_out</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">sfincs_name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">staticmaps</span><span class="p">[</span><span class="n">sfincs_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">data_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">msk</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sfincs_name</span><span class="p">,</span> <span class="s2">&quot;f4&quot;</span><span class="p">))</span>
            <span class="n">data_</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="n">fn_out</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Write GIS raster files to &#39;gis&#39; subfolder&quot;</span><span class="p">)</span>
            <span class="n">ds_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticmaps</span>
            <span class="n">ds_out</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">to_mapstack</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">staticgeoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;geopandas.GeoDataFrame representation of all model geometries&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticgeoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_staticgeoms</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticgeoms</span>

<div class="viewcode-block" id="SfincsModel.read_staticgeoms"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.read_staticgeoms.html#hydromt_sfincs.sfincs.SfincsModel.read_staticgeoms">[docs]</a>    <span class="k">def</span> <span class="nf">read_staticgeoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read bnd/src/obs SFINCS xy files</span>
<span class="sd">        If other geojson files are present gis folder, read those as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_staticgeoms</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># fresh start in read-only mode</span>
        <span class="c1"># read _GEOMS model files</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">sfincs_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">open_vector</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>
                <span class="n">gdf</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># start index at one</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">sfincs_name</span><span class="p">)</span>
        <span class="c1"># read additional geojson files from gis directory</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">,</span> <span class="s2">&quot;*.geojson&quot;</span><span class="p">)):</span>
            <span class="n">sfincs_name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.geojson&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sfincs_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">open_vector</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">sfincs_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write_staticgeoms"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.write_staticgeoms.html#hydromt_sfincs.sfincs.SfincsModel.write_staticgeoms">[docs]</a>    <span class="k">def</span> <span class="nf">write_staticgeoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write bnd/src/obs to SFINCS xy files</span>
<span class="sd">        If write_gis, write all staticgeoms to geojson files in gis subfolder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Model opened in read-only mode&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staticgeoms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Write staticgeom files&quot;</span><span class="p">)</span>
            <span class="c1"># NOTE: this only works for point vector file</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">gdf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">sfincs_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                    <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">hydromt</span><span class="o">.</span><span class="n">write_xy</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%8.2f</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gis</span><span class="p">:</span>
                    <span class="n">fn_gis</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;gis&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">.geojson&quot;</span><span class="p">)</span>
                    <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">fn_gis</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.read_forcing"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.read_forcing.html#hydromt_sfincs.sfincs.SfincsModel.read_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">read_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read bzs/dis forcing timeseries and netampr gridded forcing&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="c1"># start fresh in read-only mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">sfincs_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_1DFORCING</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">staticgeoms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">gdf</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2"> not found at </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="c1"># read timeseries</span>
                <span class="n">tref</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tref&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">_read_timeseries</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">tref</span><span class="p">)</span>
                <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">)</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">GeoDataArray</span><span class="o">.</span><span class="n">from_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">sfincs_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">sfincs_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_2DFORCING</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2"> not found at </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="c1"># NOTE: assume single variable per nc file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">sfincs_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SfincsModel.write_forcing"><a class="viewcode-back" href="../../generated/hydromt_sfincs.sfincs.SfincsModel.write_forcing.html#hydromt_sfincs.sfincs.SfincsModel.write_forcing">[docs]</a>    <span class="k">def</span> <span class="nf">write_forcing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;write bzs/dis 1D forcing and netampr 2D forcing files&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Model opened in read-only mode&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Write forcing files&quot;</span><span class="p">)</span>
            <span class="n">tref</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tref&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">sfincs_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_1DFORCING</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">sfincs_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="p">[</span><span class="n">sfincs_name</span><span class="p">]</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">_write_timeseries</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">tref</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">sfincs_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_2DFORCING</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">sfincs_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">)</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sfincs_name</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># time in minutes</span>
                <span class="n">tref_str</span> <span class="o">=</span> <span class="n">tref</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
                <span class="n">encoding</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">time</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;minutes since </span><span class="si">{</span><span class="n">tref_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="s2">&quot;float64&quot;</span><span class="p">}</span>
                <span class="p">)</span>
                <span class="c1"># write to file and set config key</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="p">[</span><span class="n">sfincs_name</span><span class="p">]</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span></div>
            <span class="c1"># TODO remove here with new ini files</span>
            <span class="c1"># self.plot_forcing()</span>

    <span class="k">def</span> <span class="nf">read_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read states at &lt;root/?/&gt; and parse to dict of xr.DataArray&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span>
        <span class="c1"># raise NotImplementedError()</span>

    <span class="k">def</span> <span class="nf">write_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;write states at &lt;root/?/&gt; in model ready format&quot;&quot;&quot;</span>
        <span class="k">pass</span>
        <span class="c1"># raise NotImplementedError()</span>

    <span class="k">def</span> <span class="nf">read_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read results at &lt;root/?/&gt; and parse to dict of xr.DataArray&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>
        <span class="c1"># raise NotImplementedError()</span>

    <span class="k">def</span> <span class="nf">write_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;write results at &lt;root/?/&gt; in model ready format&quot;&quot;&quot;</span>
        <span class="k">pass</span>
        <span class="c1"># raise NotImplementedError()</span>

    <span class="k">def</span> <span class="nf">_update_forcing_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">da</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; &quot;Set 1D forcing (and remove if da is None) and update config accordingly&quot;&quot;&quot;</span>
        <span class="n">sfincs_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_1DFORCING</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sfincs_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unknown 1D forcing name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span> <span class="k">if</span> <span class="n">da</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: setting data at </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> points.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># save to forcing dict and set in config</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: object should be xarray.DataArray.&quot;</span><span class="p">)</span>
            <span class="c1"># make sure time is on last dim</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index_dim</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">time_dim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># set dummy values if time dim has zero</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: no timeseries data in object, setting dummy values.&quot;</span>
                <span class="p">)</span>
                <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_ts</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">(),</span> <span class="n">name</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># and crs is set (should always be model crs at this stage)</span>
            <span class="k">if</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">crs</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">:</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">())</span>
            <span class="c1"># reset index dim as these get lost later anyway</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">IndexVariable</span><span class="p">(</span>
                <span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index_dim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">da</span><span class="p">[</span><span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">index_dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">sfincs_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_staticgeoms</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>
            <span class="c1"># edit inp file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: updating sfincs.inp.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sname</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_1DFORCING</span><span class="p">[</span><span class="n">name</span><span class="p">]]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sfincs.</span><span class="si">{</span><span class="n">sname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># remove forcing data and sfincs.inp entries</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: removing data.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_forcing</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sname</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_GEOMS</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_1DFORCING</span><span class="p">[</span><span class="n">name</span><span class="p">]]:</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sname</span><span class="si">}</span><span class="s2">file&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> forcing: removing </span><span class="si">{</span><span class="n">sname</span><span class="si">}</span><span class="s2">file from sfincs.inp.&quot;</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sname</span><span class="si">}</span><span class="s2">file&quot;</span><span class="p">)</span>

    <span class="c1">## model configuration</span>

    <span class="k">def</span> <span class="nf">set_crs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SfincsModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_update</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_configread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">configread</span><span class="p">(</span>
            <span class="n">fn</span><span class="p">,</span> <span class="n">abs_path</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cf</span><span class="o">=</span><span class="n">ConfigParserSfincs</span><span class="p">,</span> <span class="n">noheader</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_configwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">hydromt</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">configwrite</span><span class="p">(</span>
            <span class="n">fn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">cf</span><span class="o">=</span><span class="n">ConfigParserSfincs</span><span class="p">,</span> <span class="n">noheader</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_config_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update geospatial head based on staticmaps&quot;&quot;&quot;</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>
        <span class="n">west</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;epsg&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;mmax&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;nmax&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">dy</span><span class="p">)</span>  <span class="c1"># dy is always positive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;x0&quot;</span><span class="p">,</span> <span class="n">west</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="s2">&quot;y0&quot;</span><span class="p">,</span> <span class="n">south</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dummy_ts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">tstart</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstart&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
        <span class="n">tstop</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtfmt</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">]),</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">gdf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">fill_value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">GeoDataArray</span><span class="o">.</span><span class="n">from_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">da</span></div>


<span class="k">def</span> <span class="nf">_read_timeseries</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">tref</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read asc timeseries files such as sfincs.bzs and sfincs.dis</span>
<span class="sd">    index is parsed to datetime format assumming seconds from tref.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tref</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tref should be datetime.datetime.&quot;</span><span class="p">)</span>
    <span class="c1"># header columns start at 1</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">tref</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">_write_timeseries</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">tref</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%7.2f</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write pandas DataFrame to fixed width timeseries files</span>
<span class="sd">    such as sfincs.bzs and sfincs.dis</span>
<span class="sd">    index is in seconds from tref</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tref</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tref should be datetime.datetime.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;df does not contain data.&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="n">tref</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])))</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="n">fmt_lst</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;%</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s2">.1f&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">fmt</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
    <span class="n">fmt_out</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmt_lst</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt_out</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Deltares.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>